<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hostel PMS - Sistema de Gestión para Hostales</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/reservations.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/feedback.js"></script> <!-- Day 8: Feedback Module -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Mobile Fixes CSS - DEV2-09 -->
    <link href="/css/mobile-fixes.css" rel="stylesheet">
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3498db">

    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Almanik PMS">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192x192.png">

    <!-- iOS Splash Screens -->
    <link rel="apple-touch-startup-image" href="/icons/splash-iphone.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/icons/splash-iphone-plus.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/icons/splash-iphone-x.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)">
    <link rel="apple-touch-startup-image" href="/icons/splash-ipad.png" media="(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)">
    <link rel="apple-touch-startup-image" href="/icons/splash-ipad-pro.png" media="(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .app {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            color: #2c3e50;
            padding: 20px;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(52, 152, 219, 0.1), rgba(155, 89, 182, 0.1));
            pointer-events: none;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }

        .logo i {
            font-size: 32px;
            color: #3498db;
            margin-right: 12px;
        }

        .logo h2 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 15px 20px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #2c3e50;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-button:hover::before {
            left: 100%;
        }

        .nav-button.active {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
            transform: translateY(-2px);
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transform: translateX(5px);
        }

        .nav-button i {
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }

        .logout {
            margin-top: auto;
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .dashboard-title {
            color: #2c3e50;
        }

        .dashboard-title h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .dashboard-title p {
            font-size: 16px;
            opacity: 0.8;
        }

        .time-info {
            text-align: right;
            color: #2c3e50;
        }

        .current-time {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .current-date {
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            font-size: 32px;
            padding: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        }

        .stat-icon.occupied {
            color: #e74c3c;
            background: linear-gradient(135deg, #fdeee8, #f8d7da);
        }

        .stat-icon.clean {
            color: #2ecc71;
            background: rgba(46, 204, 113, 0.2);
        }

        .stat-icon.dirty {
            color: #f39c12;
            background: linear-gradient(135deg, #fef3e2, #fce4b8);
        }

        .stat-icon.revenue {
            color: #3498db;
            background: linear-gradient(135deg, #e8f4fd, #d4e6f1);
        }

        .stat-number {
            font-size: 42px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .stat-change {
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }

        .stat-change.positive {
            color: #2ecc71;
        }

        .stat-change.negative {
            color: #e74c3c;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 250px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            color: #2c3e50;
            font-size: 20px;
            font-weight: 600;
        }

        .activity-feed {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 500px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideInRight 0.5s ease;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            color: #2c3e50;
        }

        .activity-icon.checkin {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .activity-icon.checkout {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .activity-icon.sale {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .activity-icon.payment {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .activity-desc {
            color: #7f8c8d;
            font-size: 14px;
        }

        .activity-time {
            color: #bdc3c7;
            font-size: 12px;
        }

        .beds-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .room-section {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .room-section:last-child {
            height: 300px;
        }

        .room-title {
            color: #2c3e50;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .room-title i {
            margin-right: 10px;
            font-size: 20px;
        }

        .bed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .bed-status {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            color: #2c3e50;
            font-weight: 600;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .bed-status:hover {
            transform: scale(1.05);
        }

        .bed-status.occupied {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.3);
        }

        .bed-status.clean {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }

        .bed-status.dirty {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.3);
        }

        .bed-number {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .bed-guest {
            font-size: 11px;
            opacity: 0.9;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #3498db);
            border-radius: 4px;
            transition: width 1s ease;
        }

        .financial-overview {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }

        .financial-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .financial-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 15px;
        }

        .financial-amount {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .financial-label {
            color: #2c3e50;
            font-size: 14px;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 400px;
            text-align: center;
        }

        .login-title {
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            color: #2c3e50;
            font-size: 16px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .login-input::placeholder {
            color: #7f8c8d;
        }

        .login-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
            border-color: #3498db;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: #2c3e50;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .login-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .error-message {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }

        .hidden {
            display: none;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease forwards;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .app {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Reports Analytics Styles */
        .date-btn {
            padding: 8px 16px;
            border: 2px solid #3498db;
            border-radius: 25px;
            background: white;
            color: #3498db;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .date-btn:hover {
            background: #3498db;
            color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .date-btn.report-active {
            background: #3498db;
            color: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .chart-bar {
            border-radius: 4px 4px 0 0;
            display: flex;
            align-items: end;
            justify-content: center;
            color: #2c3e50;
            font-size: 12px;
            font-weight: bold;
            padding-bottom: 5px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .chart-bar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .revenue-bar {
            background: linear-gradient(to top, #2980b9, #3498db);
        }

        .occupancy-bar {
            width: 30px;
            border-radius: 2px 2px 0 0;
        }

        .occupancy-high {
            background: linear-gradient(to top, #1e8449, #27ae60);
        }

        .occupancy-medium {
            background: linear-gradient(to top, #d35400, #f39c12);
        }

        .occupancy-low {
            background: linear-gradient(to top, #c0392b, #e74c3c);
        }

        .top-list-item {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .top-list-item:hover {
            background: #ecf0f1;
        }

        .top-list-item:last-child {
            border-bottom: none;
        }

        .item-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .item-value {
            font-weight: bold;
            padding: 5px 12px;
            border-radius: 20px;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .value-nights {
            background: #27ae60;
        }

        .value-sales {
            background: #e67e22;
        }

        /* Light Theme for all tabs */
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .content-section {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .light-text {
            color: #2c3e50;
        }

        .light-text-secondary {
            color: #7f8c8d;
        }

        /* Mobile Responsive Styles */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            z-index: 999;
            padding: 0 20px;
            align-items: center;
            justify-content: space-between;
        }

        .mobile-logo {
            color: white;
            font-size: 18px;
            font-weight: 700;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 10px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: white;
            margin: 3px 0;
            transition: 0.3s;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(-45deg) translate(-5px, 6px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(45deg) translate(-5px, -6px);
        }

        @media (max-width: 768px) {
            .mobile-header {
                display: flex;
            }

            .hamburger {
                display: flex;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 1000;
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0 !important;
                padding-top: 100px;
            }

            .app {
                flex-direction: column;
            }

            /* Enhanced Mobile Responsiveness */

            /* Fix header date/time alignment */
            .header {
                flex-direction: column !important;
                text-align: center !important;
                gap: 10px !important;
            }

            /* Stack buttons below content on mobile */
            .action-buttons,
            .button-group {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 10px !important;
            }

            .action-buttons button,
            .button-group button {
                width: 100% !important;
                margin: 5px 0 !important;
            }

            /* Cards and content responsive */
            .stat-card,
            .content-card {
                margin: 10px 0 !important;
                padding: 15px !important;
            }

            .card-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            /* Forms responsive */
            .form-row {
                flex-direction: column !important;
                gap: 10px !important;
            }

            .form-row input,
            .form-row select,
            .form-row button {
                width: 100% !important;
                margin: 5px 0 !important;
            }

            /* Tables responsive */
            .data-table {
                font-size: 14px !important;
                overflow-x: auto !important;
            }

            .data-table th,
            .data-table td {
                padding: 8px 4px !important;
                min-width: 80px !important;
            }

            /* Bed grid responsive */
            .bed-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)) !important;
                gap: 10px !important;
            }

            .bed-card {
                min-height: auto !important;
                padding: 10px !important;
            }

            /* Reports responsive */
            .chart-container {
                height: 250px !important;
                margin: 15px 0 !important;
            }

            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)) !important;
                gap: 10px !important;
            }

            /* POS responsive */
            .pos-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .product-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)) !important;
                gap: 10px !important;
            }

            .cart-item {
                flex-direction: column !important;
                align-items: stretch !important;
                text-align: center !important;
            }

            /* Tours responsive */
            .tours-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            .tour-card {
                padding: 15px !important;
            }

            /* Staff responsive */
            .staff-grid {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }

            /* General text responsive */
            h1 {
                font-size: 1.8rem !important;
            }

            h2 {
                font-size: 1.4rem !important;
            }

            h3 {
                font-size: 1.2rem !important;
            }

            /* Padding adjustments */
            .main-content {
                padding: 100px 15px 15px 15px !important;
            }

            /* Fix date/time display */
            #current-time,
            #current-date {
                font-size: 14px !important;
                text-align: center !important;
                display: block !important;
                margin: 5px 0 !important;
            }
        }

        /* ============================================ */
        /* KPI WIDGETS - DEV2-10 */
        /* ============================================ */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .kpi-widget {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .kpi-widget:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .kpi-widget.occupancy { border-left: 4px solid #3498db; }
        .kpi-widget.revenue { border-left: 4px solid #2ecc71; }
        .kpi-widget.checkins { border-left: 4px solid #9b59b6; }
        .kpi-widget.tasks { border-left: 4px solid #f39c12; }

        .kpi-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .kpi-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .kpi-widget.occupancy .kpi-icon { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        .kpi-widget.revenue .kpi-icon { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; }
        .kpi-widget.checkins .kpi-icon { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; }
        .kpi-widget.tasks .kpi-icon { background: linear-gradient(135deg, #f39c12, #d68910); color: white; }

        .kpi-value {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            line-height: 1.1;
        }

        .kpi-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .kpi-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 20px;
            margin-top: 10px;
        }

        .kpi-change.positive {
            background: rgba(46, 204, 113, 0.15);
            color: #27ae60;
        }

        .kpi-change.negative {
            background: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
        }

        .kpi-change.neutral {
            background: rgba(127, 140, 141, 0.15);
            color: #7f8c8d;
        }

        .kpi-link {
            position: absolute;
            bottom: 15px;
            right: 15px;
            font-size: 13px;
            color: #3498db;
            text-decoration: none;
        }

        .kpi-link:hover {
            text-decoration: underline;
        }

        /* Alerts Widget */
        .alerts-widget {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            grid-column: span 2;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .alerts-header h3 {
            font-size: 16px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alerts-header .badge {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-item:hover {
            background: rgba(0, 0, 0, 0.03);
        }

        .alert-item.warning { border-left: 3px solid #f39c12; }
        .alert-item.danger { border-left: 3px solid #e74c3c; }
        .alert-item.info { border-left: 3px solid #3498db; }

        .alert-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .alert-item.warning .alert-icon { background: rgba(243, 156, 18, 0.15); color: #f39c12; }
        .alert-item.danger .alert-icon { background: rgba(231, 76, 60, 0.15); color: #e74c3c; }
        .alert-item.info .alert-icon { background: rgba(52, 152, 219, 0.15); color: #3498db; }

        .alert-text {
            flex: 1;
            font-size: 14px;
            color: #2c3e50;
        }

        .no-alerts {
            text-align: center;
            padding: 20px;
            color: #95a5a6;
        }

        .no-alerts i {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        /* KPI Grid Responsive */
        @media (max-width: 768px) {
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            .alerts-widget {
                grid-column: span 1;
            }
            .kpi-value {
                font-size: 28px;
            }
        }

        /* ============================================
           DEV4 - MEJORAS DE UX Y CONTRASTE
           Tarea 8, 10, 14
           ============================================ */

        /* CSS Variables para colores con mejor contraste WCAG 2.1 */
        :root {
            --color-primary: #2563eb;
            --color-primary-dark: #1d4ed8;
            --color-success: #16a34a;
            --color-success-dark: #15803d;
            --color-danger: #dc2626;
            --color-danger-dark: #b91c1c;
            --color-warning: #d97706;
            --color-warning-dark: #b45309;
            --color-info: #0891b2;
            --color-text-light: #ffffff;
            --color-text-dark: #1f2937;
        }

        /* TAREA 8: Boton X de cerrar modales - MAS VISIBLE */
        .modal-close-btn,
        .fd-modal-close,
        [class*="modal"] .close,
        [class*="modal"] [class*="close"],
        button[onclick*="close"]:not(.nav-button) {
            background: #dc2626 !important;
            color: #ffffff !important;
            width: 40px !important;
            height: 40px !important;
            min-width: 40px !important;
            min-height: 40px !important;
            border-radius: 50% !important;
            font-size: 24px !important;
            font-weight: bold !important;
            border: 2px solid #ffffff !important;
            cursor: pointer !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.2s ease !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3) !important;
            line-height: 1 !important;
        }

        .modal-close-btn:hover,
        .fd-modal-close:hover,
        [class*="modal"] .close:hover,
        [class*="modal"] [class*="close"]:hover,
        button[onclick*="close"]:not(.nav-button):hover {
            background: #b91c1c !important;
            transform: scale(1.1) !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
        }

        /* TAREA 10: Mejora de contraste en botones con gradiente */
        /* Forzar texto blanco en botones de colores */
        button[style*="gradient"],
        .btn-primary,
        .btn-success,
        .btn-danger,
        .btn-warning {
            color: #ffffff !important;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        /* Botones de accion con mejor contraste */
        .action-btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s ease;
            color: #ffffff;
        }

        .action-btn-primary {
            background: var(--color-primary);
        }
        .action-btn-primary:hover {
            background: var(--color-primary-dark);
        }

        .action-btn-success {
            background: var(--color-success);
        }
        .action-btn-success:hover {
            background: var(--color-success-dark);
        }

        .action-btn-danger {
            background: var(--color-danger);
        }
        .action-btn-danger:hover {
            background: var(--color-danger-dark);
        }

        .action-btn-warning {
            background: var(--color-warning);
            color: #1f2937;
        }
        .action-btn-warning:hover {
            background: var(--color-warning-dark);
        }

        /* TAREA 14: Estilos consistentes para modales */
        /* Header de modal con mejor contraste */
        [class*="modal-header"],
        .fd-modal-header {
            position: relative;
        }

        [class*="modal-header"] h2,
        [class*="modal-header"] h3,
        .fd-modal-header h2 {
            color: #ffffff !important;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* Badges de estado con mejor contraste */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.available,
        .status-badge.clean {
            background: #dcfce7;
            color: #15803d;
            border: 1px solid #16a34a;
        }

        .status-badge.occupied {
            background: #fee2e2;
            color: #b91c1c;
            border: 1px solid #dc2626;
        }

        .status-badge.dirty {
            background: #fef3c7;
            color: #b45309;
            border: 1px solid #d97706;
        }

        .status-badge.maintenance {
            background: #e5e7eb;
            color: #374151;
            border: 1px solid #6b7280;
        }

        /* Indicadores clickeables en dashboard */
        .stat-card {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .stat-card:active {
            transform: translateY(-2px);
        }

        /* Labels de campos obligatorios */
        label[for]:has(+ input[required])::after,
        label.required::after {
            content: " *";
            color: #dc2626;
            font-weight: bold;
        }

        /* Campo con error */
        .field-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2) !important;
        }

        /* Mensaje de error */
        .error-message {
            color: #dc2626;
            font-size: 12px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .error-message::before {
            content: "⚠";
        }

        /* Mejora de legibilidad en tablas */
        table th {
            background: #f8fafc;
            color: #1f2937;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
        }

        table td {
            color: #374151;
        }

        table tr:hover td {
            background: #f1f5f9;
        }

        /* Focus visible para accesibilidad */
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible,
        a:focus-visible {
            outline: 3px solid #2563eb;
            outline-offset: 2px;
        }

        /* Tooltips con mejor contraste */
        [title] {
            position: relative;
        }

        /* Scroll suave */
        html {
            scroll-behavior: smooth;
        }

        /* ============================================
           FIN DEV4 - MEJORAS DE UX Y CONTRASTE
           ============================================ */

    </style>
</head>

<body>
    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="login-container">
        <div class="login-form">
            <div class="login-title">
                <i class="fas fa-hotel" style="margin-right: 10px;"></i>
                Hostal PMS
            </div>
            <div id="login-error" class="error-message hidden"></div>
            <form id="login-form">
                <input type="text" id="username" class="login-input" placeholder="Usuario" value="admin" required>
                <input type="password" id="password" class="login-input" placeholder="Contraseña" value="admin123"
                    required>
                <button type="submit" id="login-btn" class="login-button">
                    INGRESAR AL SISTEMA
                </button>
            </form>
            <div style="margin-top: 20px; color: #7f8c8d; font-size: 12px;">
                <p>Demo: admin / admin123</p>
                <p>Sistema de gestión para hostales</p>
            </div>
        </div>
    </div>

    <!-- MAIN APPLICATION -->
    <div id="main-app" class="app hidden">
        <!-- MOBILE HEADER -->
        <div class="mobile-header">
            <div class="mobile-logo">
                <i class="fas fa-hotel"></i> HOSTEL PMS
            </div>
            <div class="hamburger" onclick="toggleSidebar()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-hotel"></i>
                <h2>HOSTEL PMS</h2>
            </div>

            <button class="nav-button active" onclick="showView('dashboard')">
                <i class="fas fa-chart-pie"></i>Tablero
            </button>

            <button class="nav-button" onclick="showView('beds')">
                <i class="fas fa-bed"></i>Camas
            </button>

            <button class="nav-button" onclick="showView('guests')">
                <i class="fas fa-users"></i>Huéspedes
            </button>

            <button class="nav-button" onclick="showView('pos')">
                <i class="fas fa-cash-register"></i>Ventas
            </button>

            <button class="nav-button" onclick="showView('staff')">
                <i class="fas fa-user-tie"></i>Personal
            </button>

            <button class="nav-button" onclick="showView('cash')">
                <i class="fas fa-coins"></i>Caja
            </button>

            <button class="nav-button" onclick="showView('reports')">
                <i class="fas fa-chart-bar"></i>Reportes
            </button>

            <button class="nav-button" onclick="showView('tours')">
                <i class="fas fa-map-marked-alt"></i>Paseos
            </button>

            <button class="nav-button" onclick="window.location.href='/reviews-dashboard.html'">
                <i class="fas fa-star"></i>Reviews
            </button>

            <button class="nav-button" onclick="window.location.href='/whatsapp-chat.html'">
                <i class="fab fa-whatsapp"></i>WhatsApp
            </button>

            <button class="nav-button" onclick="window.location.href='/executive-dashboard.html'">
                <i class="fas fa-chart-pie"></i>Ejecutivo
            </button>

            <button class="nav-button" onclick="showView('users')" id="users-nav" style="display: none;">
                <i class="fas fa-user-cog"></i>Usuarios
            </button>

            <button class="nav-button logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>Salir
            </button>
        </div>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- DASHBOARD VIEW -->
            <div id="dashboard-view" class="fade-in-up">
                <!-- HEADER -->
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h1>¡Bienvenido, Administrador!</h1>
                        <p>Aquí está lo que está pasando en tu hostal hoy</p>
                    </div>
                    <div class="time-info">
                        <div class="current-time" id="current-time">10:42 AM</div>
                        <div class="current-date" id="current-date">Miércoles, 2 Oct, 2024</div>
                    </div>
                </div>

                <!-- STATS GRID -->
                <div class="stats-grid">
                    <div class="stat-card" onclick="showBedsFiltered('occupied')" title="Ver camas ocupadas">
                        <div class="stat-header">
                            <div>
                                <div class="stat-number" id="occupied-count">12</div>
                                <div class="stat-label">Camas Ocupadas</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i> +2 desde ayer
                                </div>
                            </div>
                            <div class="stat-icon occupied">
                                <i class="fas fa-bed"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="occupied-progress" style="width: 75%"></div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="showBedsFiltered('clean')" title="Ver camas disponibles">
                        <div class="stat-header">
                            <div>
                                <div class="stat-number" id="clean-count">8</div>
                                <div class="stat-label">Camas Disponibles</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-check"></i> Listas para huéspedes
                                </div>
                            </div>
                            <div class="stat-icon clean">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="clean-progress" style="width: 40%"></div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="showBedsFiltered('dirty')" title="Ver camas por limpiar">
                        <div class="stat-header">
                            <div>
                                <div class="stat-number" id="dirty-count">3</div>
                                <div class="stat-label">Camas por Limpiar</div>
                                <div class="stat-change negative">
                                    <i class="fas fa-exclamation"></i> Necesitan limpieza
                                </div>
                            </div>
                            <div class="stat-icon dirty">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="dirty-progress" style="width: 15%"></div>
                        </div>
                    </div>

                    <div class="stat-card" onclick="showView('cash')" title="Ver caja">
                        <div class="stat-header">
                            <div>
                                <div class="stat-number" id="revenue-amount">$122.000</div>
                                <div class="stat-label">Ingresos de Hoy</div>
                                <div class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i> +15% vs ayer
                                </div>
                            </div>
                            <div class="stat-icon revenue">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 85%"></div>
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- KPI WIDGETS - DEV2-10 -->
                <!-- ============================================ -->
                <div class="kpi-grid" id="kpi-widgets">
                    <!-- Occupancy Widget -->
                    <div class="kpi-widget occupancy" onclick="showView('beds')">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-value" id="kpi-occupancy-rate">--%</div>
                                <div class="kpi-label">Ocupación Hoy</div>
                            </div>
                            <div class="kpi-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                        </div>
                        <div class="kpi-change neutral" id="kpi-occupancy-change">
                            <i class="fas fa-minus"></i> vs ayer
                        </div>
                        <span class="kpi-link">Ver camas →</span>
                    </div>

                    <!-- Revenue Widget -->
                    <div class="kpi-widget revenue" onclick="showView('cash')">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-value" id="kpi-revenue-today">$0</div>
                                <div class="kpi-label">Revenue Hoy</div>
                            </div>
                            <div class="kpi-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                        <div class="kpi-change neutral" id="kpi-revenue-change">
                            <i class="fas fa-minus"></i> vs ayer
                        </div>
                        <span class="kpi-link">Ver caja →</span>
                    </div>

                    <!-- Check-ins Widget -->
                    <div class="kpi-widget checkins" onclick="showView('guests')">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-value" id="kpi-checkins-count">0</div>
                                <div class="kpi-label">Check-ins Pendientes</div>
                            </div>
                            <div class="kpi-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                        </div>
                        <div id="kpi-checkins-list" style="margin-top: 10px; font-size: 13px; color: #7f8c8d;"></div>
                        <span class="kpi-link">Ver lista →</span>
                    </div>

                    <!-- Tasks Widget -->
                    <div class="kpi-widget tasks" onclick="window.location.href='/tasks.html'">
                        <div class="kpi-header">
                            <div>
                                <div class="kpi-value" id="kpi-tasks-count">0</div>
                                <div class="kpi-label">Tareas Pendientes</div>
                            </div>
                            <div class="kpi-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                        </div>
                        <div id="kpi-tasks-list" style="margin-top: 10px; font-size: 13px; color: #7f8c8d;"></div>
                        <span class="kpi-link">Ver tareas →</span>
                    </div>

                    <!-- Alerts Widget (full width) -->
                    <div class="alerts-widget" id="alerts-widget">
                        <div class="alerts-header">
                            <h3>
                                <i class="fas fa-bell"></i> Alertas Activas
                                <span class="badge" id="alerts-count">0</span>
                            </h3>
                        </div>
                        <div id="alerts-list">
                            <div class="no-alerts">
                                <i class="fas fa-check-circle"></i>
                                No hay alertas activas
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- FRONT DESK PANEL - ACCIONES RÁPIDAS 2AM -->
                <!-- ============================================ -->
                <div id="front-desk-panel" class="front-desk-panel" style="margin-bottom: 30px;">
                    <!-- Header con disponibilidad -->
                    <div class="fd-header" style="background: linear-gradient(135deg, #2c3e50, #34495e); border-radius: 15px 15px 0 0; padding: 20px; color: white; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 48px; font-weight: 700;" id="fd-available-count">-</div>
                            <div>
                                <div style="font-size: 18px; font-weight: 600;">CAMAS DISPONIBLES</div>
                                <div style="opacity: 0.8;" id="fd-min-price">Desde $-/noche</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="fd-search" placeholder="🔍 Buscar reserva, huésped o documento..."
                                   style="padding: 12px 20px; border: none; border-radius: 25px; width: 300px; font-size: 14px; background: rgba(255,255,255,0.9);">
                        </div>
                    </div>

                    <!-- Botones de acción rápida - DEV2-11 Quick Actions -->
                    <div class="fd-actions" style="background: white; padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; border-left: 1px solid #eee; border-right: 1px solid #eee;">
                        <button onclick="openQuickCheckinModal()" class="fd-action-btn fd-checkin" title="Ctrl+1" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(39,174,96,0.3); position: relative;">
                            <i class="fas fa-user-plus" style="font-size: 24px;"></i>
                            CHECK-IN
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">Ctrl+1</span>
                        </button>
                        <button onclick="openQuickPaymentModal()" class="fd-action-btn fd-payment" title="Ctrl+2" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #3498db, #2980b9); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(52,152,219,0.3); position: relative;">
                            <i class="fas fa-dollar-sign" style="font-size: 24px;"></i>
                            COBRAR
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">Ctrl+2</span>
                        </button>
                        <button onclick="openQuickCheckoutModal()" class="fd-action-btn fd-checkout" title="Ctrl+3" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(231,76,60,0.3); position: relative;">
                            <i class="fas fa-sign-out-alt" style="font-size: 24px;"></i>
                            CHECK-OUT
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">Ctrl+3</span>
                        </button>
                        <button onclick="openQuickReservationModal()" class="fd-action-btn fd-reservation" title="Ctrl+4" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #f39c12, #d68910); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(243,156,18,0.3); position: relative;">
                            <i class="fas fa-calendar-plus" style="font-size: 24px;"></i>
                            RESERVA
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">Ctrl+4</span>
                        </button>
                        <button onclick="showView('pos')" class="fd-action-btn fd-pos" title="Ctrl+5" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(155,89,182,0.3); position: relative;">
                            <i class="fas fa-shopping-cart" style="font-size: 24px;"></i>
                            VENTA POS
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">Ctrl+5</span>
                        </button>
                        <button onclick="refreshFrontDeskStatus()" class="fd-action-btn fd-refresh" title="F5" style="padding: 20px 15px; border: none; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 8px; background: linear-gradient(135deg, #34495e, #2c3e50); color: white; font-size: 14px; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 15px rgba(52,73,94,0.3); position: relative;">
                            <i class="fas fa-sync-alt" style="font-size: 24px;"></i>
                            ACTUALIZAR
                            <span style="position: absolute; top: 5px; right: 8px; font-size: 10px; opacity: 0.7;">F5</span>
                        </button>
                    </div>
                    <!-- Shortcuts help - DEV2-11 -->
                    <div style="background: #f8f9fa; padding: 10px 20px; border-left: 1px solid #eee; border-right: 1px solid #eee; font-size: 12px; color: #7f8c8d; display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Ctrl+1</kbd> Check-in</span>
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Ctrl+2</kbd> Cobrar</span>
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Ctrl+3</kbd> Check-out</span>
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Ctrl+4</kbd> Reserva</span>
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Ctrl+5</kbd> POS</span>
                        <span><kbd style="background: #ecf0f1; padding: 2px 6px; border-radius: 4px; font-family: monospace;">Esc</kbd> Cerrar</span>
                    </div>

                    <!-- Alertas y llegadas pendientes -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0; border: 1px solid #eee; border-top: none; border-radius: 0 0 15px 15px; overflow: hidden;">
                        <!-- Llegadas pendientes -->
                        <div id="fd-pending-arrivals" style="background: #f8f9fa; padding: 15px; border-right: 1px solid #eee;">
                            <h4 style="margin: 0 0 10px 0; color: #2c3e50; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-plane-arrival" style="color: #27ae60;"></i>
                                Llegadas Pendientes
                                <span id="fd-arrivals-count" style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">0</span>
                            </h4>
                            <div id="fd-arrivals-list" style="max-height: 150px; overflow-y: auto;">
                                <p style="color: #7f8c8d; font-size: 14px;">Cargando...</p>
                            </div>
                        </div>
                        <!-- Alertas -->
                        <div id="fd-alerts" style="background: #fff5f5; padding: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #2c3e50; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exclamation-triangle" style="color: #e74c3c;"></i>
                                Alertas
                                <span id="fd-alerts-count" style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px;">0</span>
                            </h4>
                            <div id="fd-alerts-list" style="max-height: 150px; overflow-y: auto;">
                                <p style="color: #7f8c8d; font-size: 14px;">Sin alertas</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ESTILOS RESPONSIVOS PARA MODALES -->
                <style>
                    .fd-modal-overlay {
                        display: none;
                        position: fixed;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0,0,0,0.7);
                        z-index: 9999;
                        overflow-y: auto;
                        padding: 20px;
                        box-sizing: border-box;
                    }
                    .fd-modal-overlay.active {
                        display: flex;
                        align-items: flex-start;
                        justify-content: center;
                    }
                    .fd-modal {
                        background: white;
                        border-radius: 16px;
                        width: 100%;
                        max-width: 480px;
                        margin: auto;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                        animation: modalSlideIn 0.3s ease;
                    }
                    @keyframes modalSlideIn {
                        from { opacity: 0; transform: translateY(-20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    .fd-modal-header {
                        padding: 16px 20px;
                        border-radius: 16px 16px 0 0;
                        color: white;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        position: sticky;
                        top: 0;
                        z-index: 10;
                    }
                    .fd-modal-header h2 {
                        margin: 0;
                        font-size: 18px;
                        display: flex;
                        align-items: center;
                        gap: 10px;
                    }
                    .fd-modal-close {
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        font-size: 20px;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.2s;
                    }
                    .fd-modal-close:hover {
                        background: rgba(255,255,255,0.3);
                    }
                    .fd-modal-body {
                        padding: 20px;
                    }
                    .fd-form-group {
                        margin-bottom: 16px;
                    }
                    .fd-form-group label {
                        display: block;
                        margin-bottom: 6px;
                        font-weight: 600;
                        color: #2c3e50;
                        font-size: 14px;
                    }
                    .fd-input {
                        width: 100%;
                        padding: 12px;
                        border: 2px solid #e0e0e0;
                        border-radius: 10px;
                        font-size: 16px;
                        transition: border-color 0.2s;
                        box-sizing: border-box;
                    }
                    .fd-input:focus {
                        outline: none;
                        border-color: #3498db;
                    }
                    .fd-row {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 12px;
                    }
                    @media (max-width: 480px) {
                        .fd-row {
                            grid-template-columns: 1fr;
                        }
                        .fd-modal {
                            margin: 10px;
                            border-radius: 12px;
                        }
                        .fd-modal-header {
                            border-radius: 12px 12px 0 0;
                            padding: 14px 16px;
                        }
                        .fd-modal-body {
                            padding: 16px;
                        }
                    }
                    .fd-divider {
                        border: none;
                        border-top: 1px solid #eee;
                        margin: 16px 0;
                    }
                    .fd-total-box {
                        background: linear-gradient(135deg, #f8f9fa, #ecf0f1);
                        padding: 16px;
                        border-radius: 12px;
                        margin-bottom: 16px;
                    }
                    .fd-total-row {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    .fd-total-amount {
                        font-size: 24px;
                        font-weight: 700;
                        color: #27ae60;
                    }
                    .fd-payment-options {
                        display: flex;
                        gap: 8px;
                        flex-wrap: wrap;
                    }
                    .fd-payment-option {
                        flex: 1;
                        min-width: 90px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 6px;
                        padding: 10px 12px;
                        background: white;
                        border: 2px solid #e0e0e0;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 13px;
                        transition: all 0.2s;
                    }
                    .fd-payment-option:has(input:checked) {
                        border-color: #3498db;
                        background: #ebf5fb;
                    }
                    .fd-payment-option input {
                        display: none;
                    }
                    .fd-submit-btn {
                        width: 100%;
                        padding: 16px;
                        border: none;
                        border-radius: 10px;
                        font-size: 16px;
                        font-weight: 700;
                        color: white;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                        transition: transform 0.2s, box-shadow 0.2s;
                    }
                    .fd-submit-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    }
                    .fd-submit-btn:active {
                        transform: translateY(0);
                    }
                    .fd-submit-btn.green { background: linear-gradient(135deg, #27ae60, #2ecc71); }
                    .fd-submit-btn.blue { background: linear-gradient(135deg, #3498db, #2980b9); }
                    .fd-submit-btn.red { background: linear-gradient(135deg, #e74c3c, #c0392b); }
                    .fd-info-box {
                        background: #f8f9fa;
                        padding: 12px;
                        border-radius: 10px;
                        margin-bottom: 16px;
                    }
                </style>

                <!-- MODAL: CHECK-IN RÁPIDO -->
                <div id="quick-checkin-modal" class="fd-modal-overlay">
                    <div class="fd-modal">
                        <div class="fd-modal-header" style="background: linear-gradient(135deg, #27ae60, #2ecc71);">
                            <h2><i class="fas fa-user-plus"></i> Check-in Rápido</h2>
                            <button class="fd-modal-close" onclick="closeQuickCheckinModal()">&times;</button>
                        </div>
                        <form id="quick-checkin-form" class="fd-modal-body">
                            <!-- Indicador de estado del huésped -->
                            <div id="qc-guest-status" style="display: none; padding: 10px 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <i id="qc-status-icon" class="fas fa-user"></i>
                                    <span id="qc-status-text">-</span>
                                </div>
                                <div id="qc-guest-history" style="font-size: 12px; margin-top: 4px; opacity: 0.8;"></div>
                            </div>

                            <div class="fd-form-group">
                                <label>Documento de identidad * <small style="font-weight: normal; color: #7f8c8d;">(busca automáticamente)</small></label>
                                <input type="text" id="qc-guest-document" class="fd-input" required placeholder="1052384756" autocomplete="off">
                            </div>
                            <div class="fd-form-group">
                                <label>Nombre completo *</label>
                                <input type="text" id="qc-guest-name" class="fd-input" required placeholder="Juan García" autocomplete="off">
                            </div>
                            <div class="fd-row">
                                <div class="fd-form-group">
                                    <label>Teléfono</label>
                                    <input type="tel" id="qc-guest-phone" class="fd-input" placeholder="+57 300 123 4567">
                                </div>
                                <div class="fd-form-group">
                                    <label>Nacionalidad</label>
                                    <input type="text" id="qc-guest-nationality" class="fd-input" value="Colombia">
                                </div>
                            </div>

                            <hr class="fd-divider">

                            <div class="fd-form-group">
                                <label>Seleccionar cama *</label>
                                <select id="qc-bed-select" class="fd-input" required>
                                    <option value="">Cargando camas...</option>
                                </select>
                            </div>
                            <div class="fd-row">
                                <div class="fd-form-group">
                                    <label>Noches</label>
                                    <input type="number" id="qc-nights" class="fd-input" value="1" min="1" max="30" onchange="updateQuickCheckinTotal()">
                                </div>
                                <div class="fd-form-group">
                                    <label>Check-out</label>
                                    <input type="date" id="qc-checkout-date" class="fd-input" readonly style="background: #f5f5f5;">
                                </div>
                            </div>

                            <hr class="fd-divider">

                            <div class="fd-total-box">
                                <div class="fd-total-row" style="margin-bottom: 12px;">
                                    <span style="font-size: 16px; color: #2c3e50;">TOTAL:</span>
                                    <span id="qc-total" class="fd-total-amount">$0</span>
                                </div>
                                <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #2c3e50;">Método de pago</label>
                                <div class="fd-payment-options">
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qc-payment" value="transfer" checked>
                                        <i class="fas fa-university" style="color: #9b59b6;"></i> Transferencia
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qc-payment" value="cash">
                                        <i class="fas fa-money-bill-wave" style="color: #27ae60;"></i> Efectivo
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qc-payment" value="card">
                                        <i class="fas fa-credit-card" style="color: #3498db;"></i> Tarjeta
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qc-payment" value="pending">
                                        <i class="fas fa-clock" style="color: #f39c12;"></i> Pendiente
                                    </label>
                                </div>
                            </div>

                            <button type="submit" id="qc-submit-btn" class="fd-submit-btn green">
                                <i class="fas fa-check-circle"></i> CONFIRMAR CHECK-IN
                            </button>
                        </form>
                    </div>
                </div>

                <!-- MODAL: COBRAR PAGO -->
                <div id="quick-payment-modal" class="fd-modal-overlay">
                    <div class="fd-modal">
                        <div class="fd-modal-header" style="background: linear-gradient(135deg, #3498db, #2980b9);">
                            <h2><i class="fas fa-dollar-sign"></i> Cobrar Pago</h2>
                            <button class="fd-modal-close" onclick="closeQuickPaymentModal()">&times;</button>
                        </div>
                        <form id="quick-payment-form" class="fd-modal-body">
                            <div class="fd-form-group">
                                <label>Seleccionar huésped</label>
                                <select id="qp-bed-select" class="fd-input" onchange="loadGuestAccountForPayment()">
                                    <option value="">Seleccionar cama...</option>
                                </select>
                            </div>
                            <div id="qp-guest-info" class="fd-info-box" style="display: none;">
                                <div style="font-weight: 600;" id="qp-guest-name">-</div>
                                <div style="color: #e74c3c; font-size: 14px; margin-top: 4px;" id="qp-guest-balance">Saldo: $-</div>
                            </div>
                            <div class="fd-form-group">
                                <label>Monto a cobrar</label>
                                <input type="number" id="qp-amount" class="fd-input" min="0" step="1000" placeholder="0" style="font-size: 24px; text-align: center; font-weight: 700;">
                            </div>
                            <div class="fd-form-group">
                                <label>Método</label>
                                <div class="fd-payment-options">
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qp-method" value="transfer" checked>
                                        <i class="fas fa-university" style="color: #9b59b6;"></i> Transferencia
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qp-method" value="cash">
                                        <i class="fas fa-money-bill-wave" style="color: #27ae60;"></i> Efectivo
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qp-method" value="card">
                                        <i class="fas fa-credit-card" style="color: #3498db;"></i> Tarjeta
                                    </label>
                                </div>
                            </div>
                            <button type="submit" class="fd-submit-btn blue">
                                <i class="fas fa-check"></i> REGISTRAR PAGO
                            </button>
                        </form>
                    </div>
                </div>

                <!-- MODAL: CHECK-OUT RÁPIDO -->
                <div id="quick-checkout-modal" class="fd-modal-overlay">
                    <div class="fd-modal">
                        <div class="fd-modal-header" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                            <h2><i class="fas fa-sign-out-alt"></i> Check-out</h2>
                            <button class="fd-modal-close" onclick="closeQuickCheckoutModal()">&times;</button>
                        </div>
                        <form id="quick-checkout-form" class="fd-modal-body">
                            <div class="fd-form-group">
                                <label>Seleccionar cama ocupada</label>
                                <select id="qco-bed-select" class="fd-input" onchange="loadGuestForCheckout()">
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div id="qco-guest-info" class="fd-info-box" style="display: none;">
                                <div style="font-weight: 600; margin-bottom: 8px;" id="qco-guest-name">-</div>
                                <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                    <span>Total estadía:</span>
                                    <span id="qco-total">$-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 14px;">
                                    <span>Pagado:</span>
                                    <span id="qco-paid">$-</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 16px; margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd;">
                                    <span>Saldo pendiente:</span>
                                    <span id="qco-balance" style="color: #e74c3c;">$-</span>
                                </div>
                            </div>
                            <div id="qco-payment-section" style="display: none;">
                                <div class="fd-form-group">
                                    <label>Pago final</label>
                                    <input type="number" id="qco-payment-amount" class="fd-input" min="0" step="1000" value="0">
                                </div>
                                <div class="fd-payment-options" style="margin-bottom: 16px;">
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qco-method" value="transfer" checked> 🏦 Transferencia
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qco-method" value="cash"> 💵 Efectivo
                                    </label>
                                    <label class="fd-payment-option">
                                        <input type="radio" name="qco-method" value="card"> 💳 Tarjeta
                                    </label>
                                </div>
                            </div>
                            <div class="fd-form-group">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: normal;">
                                    <input type="checkbox" id="qco-mark-clean" style="width: 18px; height: 18px;">
                                    Marcar cama como limpia
                                </label>
                            </div>
                            <button type="submit" class="fd-submit-btn red">
                                <i class="fas fa-check"></i> CONFIRMAR CHECK-OUT
                            </button>
                        </form>
                    </div>
                </div>

                <!-- PANEL OPERATIVO: CHECK-INS/CHECK-OUTS DEL DIA -->
                <div id="operations-panel" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <!-- Check-outs Hoy -->
                    <div style="background: linear-gradient(135deg, rgba(231, 76, 60, 0.15), rgba(192, 57, 43, 0.1)); border-radius: 15px; padding: 20px; border: 1px solid rgba(231, 76, 60, 0.3);">
                        <h3 style="color: #e74c3c; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-sign-out-alt"></i>
                            Check-outs Hoy
                            <span id="checkout-count" style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 14px;">0</span>
                        </h3>
                        <div id="checkouts-list" style="max-height: 200px; overflow-y: auto;">
                            <p style="color: #95a5a6; text-align: center;">Cargando...</p>
                        </div>
                    </div>

                    <!-- Check-ins Hoy -->
                    <div style="background: linear-gradient(135deg, rgba(46, 204, 113, 0.15), rgba(39, 174, 96, 0.1)); border-radius: 15px; padding: 20px; border: 1px solid rgba(46, 204, 113, 0.3);">
                        <h3 style="color: #27ae60; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-sign-in-alt"></i>
                            Check-ins Esperados
                            <span id="checkin-count" style="background: #27ae60; color: white; padding: 2px 8px; border-radius: 10px; font-size: 14px;">0</span>
                        </h3>
                        <div id="checkins-list" style="max-height: 200px; overflow-y: auto;">
                            <p style="color: #95a5a6; text-align: center;">Cargando...</p>
                        </div>
                    </div>

                    <!-- Preview Mañana -->
                    <div style="background: linear-gradient(135deg, rgba(241, 196, 15, 0.15), rgba(243, 156, 18, 0.1)); border-radius: 15px; padding: 20px; border: 1px solid rgba(241, 196, 15, 0.3);">
                        <h3 style="color: #f39c12; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-calendar-day"></i>
                            Check-outs Mañana
                            <span id="tomorrow-count" style="background: #f39c12; color: white; padding: 2px 8px; border-radius: 10px; font-size: 14px;">0</span>
                        </h3>
                        <div id="tomorrow-list" style="max-height: 200px; overflow-y: auto;">
                            <p style="color: #95a5a6; text-align: center;">Cargando...</p>
                        </div>
                    </div>
                </div>

                <!-- FINANCIAL OVERVIEW -->
                <div class="financial-overview">
                    <h3 class="chart-title" style="margin-bottom: 20px;">
                        <i class="fas fa-chart-line" style="margin-right: 10px;"></i>
                        Resumen Financiero
                    </h3>
                    <div class="financial-grid">
                        <div class="financial-item">
                            <div class="financial-amount">$2.450.000</div>
                            <div class="financial-label">Ingresos Semanales</div>
                        </div>
                        <div class="financial-item">
                            <div class="financial-amount" style="color: #e74c3c;">$1.230.000</div>
                            <div class="financial-label">Gastos Semanales</div>
                        </div>
                        <div class="financial-item">
                            <div class="financial-amount" style="color: #f39c12;">$1.220.000</div>
                            <div class="financial-label">Ganancia Neta</div>
                        </div>
                        <div class="financial-item">
                            <div class="financial-amount" style="color: #9b59b6;" id="occupancy-rate">89%</div>
                            <div class="financial-label">Tasa de Ocupación</div>
                        </div>
                    </div>
                </div>

                <!-- MAIN CONTENT GRID -->
                <div class="content-grid">
                    <!-- OCCUPANCY CHART -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">
                                <i class="fas fa-chart-area" style="margin-right: 10px;"></i>
                                Tendencias de Ocupación (7 días)
                            </h3>
                        </div>
                        <canvas id="occupancyChart" width="400" height="150"></canvas>
                    </div>

                    <!-- ACTIVITY FEED -->
                    <div class="activity-feed">
                        <h3 class="chart-title" style="margin-bottom: 20px;">
                            <i class="fas fa-clock" style="margin-right: 10px;"></i>
                            Actividad Reciente
                        </h3>

                        <div id="activity-list">
                            <!-- Activities will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- BEDS OVERVIEW -->
                <div class="beds-overview">
                    <!-- DORM ROOMS -->
                    <div class="room-section">
                        <div class="room-title">
                            <i class="fas fa-door-open"></i>
                            Habitaciones Compartidas
                        </div>
                        <div class="bed-grid" id="dorm-beds">
                            <!-- Beds will be loaded here -->
                        </div>
                    </div>

                    <!-- PRIVATE ROOMS -->
                    <div class="room-section">
                        <div class="room-title">
                            <i class="fas fa-key"></i>
                            Habitaciones Privadas
                        </div>
                        <div class="bed-grid" id="private-beds">
                            <!-- Beds will be loaded here -->
                        </div>
                    </div>

                    <!-- REVENUE BREAKDOWN -->
                    <div class="room-section">
                        <div class="room-title">
                            <i class="fas fa-chart-pie"></i>
                            Desglose de Ingresos
                        </div>
                        <canvas id="revenueChart" width="250" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Other views (placeholder) -->
            <div id="beds-view" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #2c3e50; margin: 0;">🛏️ Gestión de Camas</h1>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="showAddBedModal()"
                            style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Nueva Cama
                        </button>
                        <button onclick="refreshBeds()"
                            style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-sync"></i> Actualizar
                        </button>
                    </div>
                </div>

                <!-- Resumen de estado -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div
                        style="background: linear-gradient(135deg, #e8f5e8, #d4ecd4); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #27ae60;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="clean-beds-count">0</div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Disponibles</div>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #fdeee8, #f8d7da); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #e74c3c;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="occupied-beds-count">0
                        </div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Ocupadas</div>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #fef3e2, #fce4b8); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #f39c12;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="dirty-beds-count">0</div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Por Limpiar</div>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #e8f4fd, #d4e6f1); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #3498db;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="total-beds-count">0</div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Total</div>
                    </div>
                </div>

                <!-- Habitaciones organizadas -->
                <div id="rooms-container">
                    <!-- Las habitaciones se cargarán aquí dinámicamente -->
                </div>
            </div>
            <div id="guests-view" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #2c3e50; margin: 0;">👥 Gestión de Huéspedes</h1>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="showAddGuestModal()"
                            style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Nuevo Huésped
                        </button>
                        <button onclick="refreshGuests()"
                            style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-sync"></i> Actualizar
                        </button>
                    </div>
                </div>

                <!-- Estadísticas de huéspedes -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 30px;">
                    <div
                        style="background: linear-gradient(135deg, #e8f4fd, #d4e6f1); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #3498db;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="total-guests-count">0</div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Total Huéspedes</div>
                    </div>
                    <div
                        style="background: linear-gradient(135deg, #e8f5e8, #d4ecd4); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #27ae60;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="staying-guests-count">0
                        </div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Hospedados Ahora</div>
                    </div>
                    <div
                        style="background: rgba(155, 89, 182, 0.2); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #9b59b6;">
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="active-bookings-count">0
                        </div>
                        <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Reservas Activas</div>
                    </div>
                </div>

                <!-- Búsqueda avanzada -->
                <div
                    style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin: 0 0 15px 0;">🔍 Búsqueda de Huéspedes</h3>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="guest-search"
                            placeholder="Buscar por nombre, documento, email o teléfono..."
                            style="flex: 1; min-width: 300px; padding: 12px; border: none; border-radius: 8px; background: rgba(255,255,255,0.9);"
                            onkeypress="if(event.key==='Enter') searchGuests()">
                        <button onclick="searchGuests()"
                            style="padding: 12px 20px; background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                        <button onclick="clearSearchAndLoadAll()"
                            style="padding: 12px 20px; background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                            <i class="fas fa-times"></i> Limpiar
                        </button>
                    </div>
                </div>

                <!-- Lista de Huéspedes -->
                <div id="guests-container">
                    <!-- Lista de huéspedes se carga aquí -->
                </div>
            </div>
            <div id="pos-view" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #2c3e50; margin: 0;">🛒 Sistema de Ventas (POS)</h1>
                    <div style="color: #2c3e50; font-size: 18px;">
                        Total: $<span id="cart-total">0.00</span>
                    </div>
                </div>

                <div class="pos-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <!-- Productos -->
                    <div>
                        <h2 style="color: #2c3e50; margin-bottom: 15px;">📦 Productos Disponibles</h2>
                        <div id="products-grid" class="product-grid"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                            <!-- Productos se cargan aquí -->
                        </div>
                    </div>

                    <!-- Carrito -->
                    <div
                        style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 style="color: #2c3e50; margin: 0;">🛍️ Carrito de Compras</h2>
                            <button onclick="clearCart()"
                                style="padding: 8px 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                🗑️ Limpiar
                            </button>
                        </div>

                        <div id="cart-items" style="margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                            <!-- Items del carrito -->
                        </div>

                        <div style="border-top: 1px solid rgba(255,255,255,0.3); padding-top: 15px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <span style="color: #2c3e50; font-size: 18px; font-weight: bold;">Total:</span>
                                <span style="color: #27ae60; font-size: 24px; font-weight: bold;">$<span
                                        id="cart-total">0</span></span>
                            </div>

                            <select id="payment-method"
                                style="width: 100%; padding: 12px; margin-bottom: 15px; border: none; border-radius: 8px; background: white; color: #2c3e50; font-size: 14px;">
                                <option value="transfer">🏦 Transferencia</option>
                                <option value="cash">💵 Efectivo</option>
                                <option value="card">💳 Tarjeta</option>
                                <option value="room">🛏️ Cargar a Habitación</option>
                            </select>

                            <button onclick="processSale()"
                                style="width: 100%; padding: 15px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s ease;">
                                <i class="fas fa-cash-register"></i> Procesar Venta
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="staff-view" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #2c3e50; margin: 0;">👨‍💼 Gestión de Personal</h1>
                    <button onclick="showAddStaffModal()"
                        style="padding: 10px 20px; background: #9b59b6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-plus"></i> Nuevo Empleado
                    </button>
                </div>

                <!-- Resumen de turnos del día -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div
                        style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">⏰ Personal en Turno</h3>
                        <div id="current-shift-list">
                            <p style="color: #7f8c8d; font-style: italic;">Cargando...</p>
                        </div>
                    </div>

                    <div
                        style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; border-radius: 10px;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">📊 Estadísticas de Personal</h3>
                        <div id="staff-stats-summary">
                            <p style="color: #7f8c8d; font-style: italic;">Cargando...</p>
                        </div>
                    </div>
                </div>

                <!-- Lista de empleados -->
                <div
                    style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px;">
                    <h2 style="color: #2c3e50; margin-bottom: 15px;">📋 Lista de Empleados</h2>
                    <div id="staff-list">
                        <!-- Lista de staff se carga aquí -->
                    </div>
                </div>
            </div>
            <div id="cash-view" class="hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h1 style="color: #2c3e50; margin: 0;">💰 Gestión de Caja</h1>
                    <button onclick="showCashMovementModal()"
                        style="padding: 10px 20px; background: #f39c12; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-plus"></i> Nuevo Movimiento
                    </button>
                </div>

                <!-- Resumen de caja -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div
                        style="background: linear-gradient(135deg, #e8f5e8, #d4ecd4); padding: 20px; border-radius: 10px; border: 2px solid #27ae60;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">💵 Efectivo en Caja</h3>
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">$1,245.50</div>
                    </div>

                    <div
                        style="background: linear-gradient(135deg, #e8f4fd, #d4e6f1); padding: 20px; border-radius: 10px; border: 2px solid #3498db;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">💳 Pagos con Tarjeta</h3>
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">$890.00</div>
                    </div>

                    <div
                        style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border: 2px solid #9b59b6;">
                        <h3 style="color: #2c3e50; margin-bottom: 10px;">📊 Total del Día</h3>
                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">$2,135.50</div>
                    </div>
                </div>

                <!-- Movimientos recientes -->
                <div
                    style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px;">
                    <h2 style="color: #2c3e50; margin-bottom: 15px;">📋 Movimientos del Día</h2>
                    <div id="cash-movements-list">
                        <!-- Movimientos se cargan aquí -->
                    </div>
                </div>

                <!-- Modal de Nuevo Movimiento de Caja -->
                <div id="cash-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                    <div style="background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 style="color: #2c3e50; margin: 0;">💰 Nuevo Movimiento</h2>
                            <button onclick="closeCashModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                        </div>
                        <form id="cash-form" onsubmit="submitCashMovement(event)">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Tipo de Movimiento:</label>
                                <select id="cash-type" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                                    <option value="income">💵 Ingreso</option>
                                    <option value="expense">💸 Egreso</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Categoría:</label>
                                <select id="cash-category" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                                    <option value="accommodation">🛏️ Hospedaje</option>
                                    <option value="product_sale">🛒 Venta de Productos</option>
                                    <option value="tour_commission">🎫 Comisión de Tours</option>
                                    <option value="service">🔧 Servicios</option>
                                    <option value="supplies">📦 Suministros</option>
                                    <option value="utilities">💡 Servicios Públicos</option>
                                    <option value="salary">👤 Salarios</option>
                                    <option value="other">📋 Otro</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Monto ($):</label>
                                <input type="number" id="cash-amount" step="0.01" min="0.01" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="0.00">
                            </div>
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Método de Pago:</label>
                                <select id="cash-method" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                                    <option value="transfer">🏦 Transferencia</option>
                                    <option value="cash">💵 Efectivo</option>
                                    <option value="card">💳 Tarjeta</option>
                                </select>
                            </div>
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Descripción:</label>
                                <textarea id="cash-description" rows="3" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; resize: vertical;" placeholder="Descripción del movimiento..."></textarea>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button type="button" onclick="closeCashModal()" style="flex: 1; padding: 12px; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Cancelar</button>
                                <button type="submit" style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div id="reports-view" class="hidden">
                <!-- HEADER -->
                <div style="text-align: center; color: #2c3e50; margin-bottom: 30px;">
                    <h1 style="font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">📈
                        Reports & Analytics</h1>
                    <p>Sistema completo de análisis para Hostel PMS</p>
                </div>

                <!-- FILTROS Y CONFIGURACIÓN -->
                <div
                    style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">🔧 Configuración de Reportes</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block;">Período de
                            Análisis:</label>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                            <button class="date-btn" onclick="selectReportPeriod(this, 7)">7 días</button>
                            <button class="date-btn report-active" onclick="selectReportPeriod(this, 30)">30
                                días</button>
                            <button class="date-btn" onclick="selectReportPeriod(this, 90)">3 meses</button>
                            <button class="date-btn" onclick="selectReportPeriod(this, 180)">6 meses</button>
                            <button class="date-btn" onclick="selectReportPeriod(this, 365)">1 año</button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <label style="font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block;">Fecha
                                Inicio:</label>
                            <input type="date" id="reportStartDate"
                                style="padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; width: 100%;">
                        </div>
                        <div>
                            <label style="font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block;">Fecha
                                Fin:</label>
                            <input type="date" id="reportEndDate"
                                style="padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; width: 100%;">
                        </div>
                        <div>
                            <label style="font-weight: bold; color: #2c3e50; margin-bottom: 8px; display: block;">Tipo
                                de Reporte:</label>
                            <select id="reportType"
                                style="padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; width: 100%;">
                                <option value="overview" selected>📊 Resumen General</option>
                                <option value="revenue">💰 Análisis Financiero</option>
                                <option value="occupancy">🛏️ Análisis de Ocupación</option>
                                <option value="guests">👥 Análisis de Huéspedes</option>
                                <option value="pos">🛒 Análisis de Ventas POS</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;">
                        <button onclick="generateAnalyticsReport()"
                            style="padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: #2c3e50;">
                            🔍 Generar Reporte
                        </button>
                        <button onclick="exportAnalyticsReport()"
                            style="padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #2c3e50;">
                            📥 Exportar Datos
                        </button>
                        <button onclick="refreshReports()"
                            style="padding: 12px 24px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50;">
                            <i class="fas fa-sync"></i> Actualizar
                        </button>
                    </div>
                </div>

                <!-- CONTENIDO DEL REPORTE -->
                <div id="reportContent">
                    <!-- KPIs PRINCIPALES -->
                    <div
                        style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h3 style="color: #2c3e50;">📊 KPIs Principales</h3>
                            <div id="reportPeriodBadge"
                                style="display: inline-block; background: linear-gradient(135deg, #667eea, #764ba2); color: #2c3e50; padding: 8px 20px; border-radius: 25px; font-weight: bold; font-size: 0.9rem; margin-top: 10px;">
                                Últimos 30 días
                            </div>
                        </div>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                            <div id="kpiRevenue"
                                style="padding: 25px; border-radius: 12px; text-align: center; background: linear-gradient(135deg, #e8f5e8, #d4ecd4); border: 2px solid #27ae60; color: #27ae60;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 8px;">$0</div>
                                <div style="font-size: 1rem; font-weight: bold; margin-bottom: 5px;">Ingresos Totales
                                </div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">Promedio diario: $0</div>
                            </div>

                            <div id="kpiOccupancy"
                                style="padding: 25px; border-radius: 12px; text-align: center; background: linear-gradient(135deg, #e8f4fd, #d4e6f1); border: 2px solid #3498db; color: #3498db;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 8px;">0%</div>
                                <div style="font-size: 1rem; font-weight: bold; margin-bottom: 5px;">Ocupación Promedio
                                </div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">0 noches vendidas</div>
                            </div>

                            <div id="kpiGuests"
                                style="padding: 25px; border-radius: 12px; text-align: center; background: linear-gradient(135deg, #fef3e2, #fce4b8); border: 2px solid #f39c12; color: #f39c12;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 8px;">0</div>
                                <div style="font-size: 1rem; font-weight: bold; margin-bottom: 5px;">Huéspedes Únicos
                                </div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">0 huéspedes recurrentes</div>
                            </div>

                            <div id="kpiRate"
                                style="padding: 25px; border-radius: 12px; text-align: center; background: linear-gradient(135deg, #fdf2f8, #f5e6ed); border: 2px solid #e91e63; color: #e91e63;">
                                <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 8px;">$0</div>
                                <div style="font-size: 1rem; font-weight: bold; margin-bottom: 5px;">Tarifa Promedio
                                </div>
                                <div style="font-size: 0.9rem; opacity: 0.8;">ADR (Average Daily Rate)</div>
                            </div>
                        </div>
                    </div>

                    <!-- TENDENCIAS Y GRÁFICOS -->
                    <div
                        style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                        <h3 style="color: #2c3e50; margin-bottom: 25px;">📈 Tendencias del Período</h3>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 30px;">
                            <div
                                style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">💰 Ingresos por Semana</h4>
                                <div id="revenueChart"
                                    style="height: 200px; display: flex; align-items: end; gap: 10px; margin-bottom: 10px;">
                                    <!-- Chart bars will be generated here -->
                                </div>
                                <div style="color: #7f8c8d; font-size: 12px; text-align: center;">
                                    Últimas 5 semanas
                                </div>
                            </div>

                            <div
                                style="background: #f8f9fa; padding: 20px; border-radius: 12px; border: 1px solid #dee2e6;">
                                <h4 style="color: #2c3e50; margin-bottom: 15px;">🛏️ Ocupación Diaria (última semana)
                                </h4>
                                <div id="occupancyChart"
                                    style="height: 200px; display: flex; align-items: end; gap: 10px; margin-bottom: 10px;">
                                    <!-- Chart bars will be generated here -->
                                </div>
                                <div style="color: #7f8c8d; font-size: 12px; text-align: center;">
                                    Verde: >80% | Amarillo: 60-80% | Rojo: <60% </div>
                                </div>
                            </div>
                        </div>

                        <!-- TOP PERFORMERS -->
                        <div
                            style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <h3 style="color: #2c3e50; margin-bottom: 25px;">🏆 Top Performers</h3>

                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                                <div
                                    style="background: #f8f9fa; border-radius: 12px; overflow: hidden; border: 1px solid #dee2e6;">
                                    <div
                                        style="background: linear-gradient(135deg, #2c3e50, #34495e); color: #2c3e50; padding: 20px; font-weight: bold;">
                                        👥 Top Huéspedes (por noches)
                                    </div>
                                    <div id="topGuests">
                                        <!-- Top guests will be loaded here -->
                                    </div>
                                </div>

                                <div
                                    style="background: #f8f9fa; border-radius: 12px; overflow: hidden; border: 1px solid #dee2e6;">
                                    <div
                                        style="background: linear-gradient(135deg, #2c3e50, #34495e); color: #2c3e50; padding: 20px; font-weight: bold;">
                                        🛒 Productos Más Vendidos
                                    </div>
                                    <div id="topProducts">
                                        <!-- Top products will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ANÁLISIS ADICIONAL -->
                        <div
                            style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.2);">
                            <h3 style="color: #2c3e50; margin-bottom: 20px;">📊 Análisis Adicional</h3>

                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                                <div id="weekendOccupancy"
                                    style="padding: 20px; background: #e8f5e8; border-radius: 10px; border: 2px solid #27ae60;">
                                    <div style="color: #27ae60; font-size: 1.5rem; font-weight: bold;">0%</div>
                                    <div style="color: #2c3e50; font-weight: bold;">Tasa de Ocupación de Fines de Semana
                                    </div>
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Rendimiento de fines de semana</div>
                                </div>

                                <div id="avgStay"
                                    style="padding: 20px; background: #fef3e2; border-radius: 10px; border: 2px solid #f39c12;">
                                    <div style="color: #f39c12; font-size: 1.5rem; font-weight: bold;">0 días</div>
                                    <div style="color: #2c3e50; font-weight: bold;">Estancia Promedio</div>
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Duración media de hospedaje</div>
                                </div>

                                <div id="returningGuests"
                                    style="padding: 20px; background: #e8f4fd; border-radius: 10px; border: 2px solid #3498db;">
                                    <div style="color: #3498db; font-size: 1.5rem; font-weight: bold;">0%</div>
                                    <div style="color: #2c3e50; font-weight: bold;">Tasa de Huéspedes Recurrentes</div>
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">Nivel de fidelización</div>
                                </div>

                                <div id="posRevenue"
                                    style="padding: 20px; background: #fdf2f8; border-radius: 10px; border: 2px solid #e91e63;">
                                    <div style="color: #e91e63; font-size: 1.5rem; font-weight: bold;">$0</div>
                                    <div style="color: #2c3e50; font-weight: bold;">Ingresos POS</div>
                                    <div style="color: #7f8c8d; font-size: 0.9rem;">0% del total</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            <div id="tours-view" class="hidden">
                <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin: 0;">🚶 Gestión de Paseos</h1>
                        <button onclick="showAddTourModal()"
                            style="padding: 10px 20px; background: #9b59b6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Nuevo Paseo
                        </button>
                    </div>

                    <!-- Estadísticas de comisiones -->
                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div
                            style="background: linear-gradient(135deg, #e8f5e8, #d4ecd4); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #27ae60;">
                            <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="total-tours-count">0
                            </div>
                            <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Tours Disponibles</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, #e8f4fd, #d4e6f1); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #3498db;">
                            <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="total-clicks-count">0
                            </div>
                            <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Clicks Totales</div>
                        </div>
                        <div
                            style="background: linear-gradient(135deg, #fef3e2, #fce4b8); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #f39c12;">
                            <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="total-commissions">$0
                            </div>
                            <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Comisiones Totales</div>
                        </div>
                        <div
                            style="background: rgba(155, 89, 182, 0.2); padding: 15px; border-radius: 8px; text-align: center; border: 2px solid #9b59b6;">
                            <div style="color: #2c3e50; font-size: 24px; font-weight: bold;" id="conversion-rate">0%
                            </div>
                            <div style="color: #2c3e50; font-size: 14px; font-weight: 600;">Tasa de Conversión</div>
                        </div>
                    </div>

                    <!-- Todos los paseos disponibles -->
                    <div
                        style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px;">
                        <h2 style="color: #2c3e50; margin-bottom: 15px;">🗺️ Catálogo de Paseos</h2>
                        <div id="all-tours" class="tours-grid"
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                            <!-- Catálogo de paseos -->
                        </div>
                    </div>

                    <!-- Reservas de paseos -->
                    <div
                        style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px; margin-top: 20px;">
                        <h2 style="color: #2c3e50; margin-bottom: 15px;">📋 Reservas de Paseos</h2>
                        <div id="tour-bookings">
                            <!-- Reservas de paseos se cargan aquí -->
                        </div>
                    </div>

                    <!-- Modal de Nuevo Paseo -->
                    <div id="tour-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
                        <div style="background: white; border-radius: 15px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h2 style="color: #2c3e50; margin: 0;" id="tour-modal-title">🚶 Nuevo Paseo</h2>
                                <button onclick="closeTourModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #7f8c8d;">&times;</button>
                            </div>
                            <form id="tour-form" onsubmit="submitTour(event)">
                                <input type="hidden" id="tour-id">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Nombre del Paseo:</label>
                                    <input type="text" id="tour-name" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="City Tour, Beach Day, etc.">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Descripción:</label>
                                    <textarea id="tour-description" rows="3" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; resize: vertical;" placeholder="Descripción del paseo..."></textarea>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                    <div>
                                        <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Precio ($):</label>
                                        <input type="number" id="tour-price" step="0.01" min="0" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="0.00">
                                    </div>
                                    <div>
                                        <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Comisión (%):</label>
                                        <input type="number" id="tour-commission" step="1" min="0" max="100" required style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="15">
                                    </div>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Proveedor:</label>
                                    <input type="text" id="tour-provider" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="Nombre del proveedor">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; font-weight: bold; color: #2c3e50; margin-bottom: 5px;">Duración:</label>
                                    <input type="text" id="tour-duration" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;" placeholder="4 horas, Día completo, etc.">
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button type="button" onclick="closeTourModal()" style="flex: 1; padding: 12px; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Cancelar</button>
                                    <button type="submit" style="flex: 1; padding: 12px; background: #9b59b6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">Guardar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            <!-- Users View -->
            <div id="users-view" class="hidden">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h1 style="color: #2c3e50; margin: 0;">👥 Gestión de Usuarios</h1>
                <button onclick="showAddUserModal()" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-plus"></i> Nuevo Usuario
                </button>
            </div>

            <!-- Users List -->
            <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 20px;">
                <h2 style="color: #2c3e50; margin-bottom: 15px;">📋 Lista de Usuarios</h2>
                <div id="users-list" style="overflow-x: auto;">
                    <!-- Users table will be loaded here -->
                </div>
            </div>
        </div>
        </div> <!-- End of main-content -->

        <!-- Modal para gestión de camas -->
        <div id="bed-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 550px; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="closeBedModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ecf0f1; font-size: 24px; cursor: pointer;">×</button>

                <h2 id="bed-modal-title" style="color: #ecf0f1; margin-bottom: 20px;">Nueva Cama</h2>

                <!-- Info del huésped actual (solo si está ocupada) -->
                <div id="bed-guest-info" style="display: none; background: rgba(52,152,219,0.2); border: 1px solid #3498db; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="color: #3498db; margin: 0 0 10px 0;">👤 Huésped Actual</h4>
                    <p id="bed-guest-name" style="color: #ecf0f1; margin: 5px 0;"></p>
                    <p id="bed-guest-doc" style="color: #bdc3c7; margin: 5px 0; font-size: 12px;"></p>
                </div>

                <form id="bed-form" style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #ecf0f1; display: block; margin-bottom: 5px;">Nombre:</label>
                            <input type="text" id="bed-name" placeholder="Ej: 1-1"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px; box-sizing: border-box;" required>
                        </div>
                        <div>
                            <label style="color: #ecf0f1; display: block; margin-bottom: 5px;">Precio ($):</label>
                            <input type="number" id="bed-price" placeholder="25.00" step="0.01" min="0"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px; box-sizing: border-box;" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #ecf0f1; display: block; margin-bottom: 5px;">Habitación:</label>
                            <select id="bed-room" style="width: 100%; padding: 10px; border: none; border-radius: 5px; box-sizing: border-box;" required>
                                <option value="">Seleccionar</option>
                                <option value="Habitacion 1">Habitacion 1</option>
                                <option value="Habitacion 2">Habitacion 2</option>
                                <option value="Habitacion 3">Habitacion 3</option>
                                <option value="Habitacion 4">Habitacion 4</option>
                                <option value="Priv 1">Priv 1</option>
                                <option value="Priv 2">Priv 2</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: #ecf0f1; display: block; margin-bottom: 5px;">Estado:</label>
                            <select id="bed-status" style="width: 100%; padding: 10px; border: none; border-radius: 5px; box-sizing: border-box;">
                                <option value="clean">Disponible</option>
                                <option value="dirty">Por Limpiar</option>
                                <option value="occupied">Ocupada</option>
                                <option value="reserved">Reservada</option>
                                <option value="maintenance">Mantenimiento</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label style="color: #ecf0f1; display: block; margin-bottom: 5px;">Notas:</label>
                        <textarea id="bed-notes" placeholder="Observaciones sobre esta cama..."
                            style="width: 100%; padding: 10px; border: none; border-radius: 5px; box-sizing: border-box; min-height: 60px; resize: vertical;"></textarea>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button type="button" onclick="closeBedModal()"
                            style="flex: 1; padding: 12px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            Cancelar
                        </button>
                        <button type="submit"
                            style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            💾 Guardar Cambios
                        </button>
                    </div>

                    <!-- Botón eliminar (solo cuando se edita) -->
                    <div id="bed-delete-section" style="display: none; margin-top: 10px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <button type="button" onclick="deleteBedFromModal()"
                            style="width: 100%; padding: 12px; background: #c0392b; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            🗑️ Eliminar Cama
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para seleccionar huésped al hacer check-in -->
        <div id="guest-selector-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1100; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; position: relative; max-height: 80vh; overflow-y: auto;">
                <button onclick="closeGuestSelectorModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ecf0f1; font-size: 24px; cursor: pointer;">×</button>

                <h2 style="color: #ecf0f1; margin-bottom: 10px;">👤 Seleccionar Huésped</h2>
                <p id="guest-selector-bed-info" style="color: #bdc3c7; margin-bottom: 20px; font-size: 14px;">Para la cama: <strong></strong></p>

                <!-- Lista de huéspedes disponibles -->
                <div id="guest-selector-list" style="max-height: 300px; overflow-y: auto; margin-bottom: 20px;">
                    <!-- Se llena dinámicamente -->
                </div>

                <!-- Botón para registrar nuevo huésped -->
                <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 15px;">
                    <button type="button" onclick="registerNewGuestAndReturn()"
                        style="width: 100%; padding: 15px; background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px;">
                        ➕ Registrar Nuevo Huésped
                    </button>
                    <p style="color: #95a5a6; font-size: 12px; text-align: center; margin-top: 10px;">
                        Se abrirá el formulario de registro. Después podrás asignarlo a esta cama.
                    </p>
                </div>
            </div>
        </div>

        <!-- Modal para gestión de huéspedes -->
        <div id="guest-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="closeGuestModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #2c3e50; font-size: 24px; cursor: pointer;">×</button>

                <h2 id="guest-modal-title" style="color: #2c3e50; margin-bottom: 20px;">Nuevo Huésped</h2>

                <form id="guest-form" style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Nombre Completo:</label>
                            <input type="text" id="guest-name" placeholder="Ej: Juan Carlos Pérez"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Documento de
                                Identidad:</label>
                            <input type="text" id="guest-document" placeholder="Ej: 1012345678"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Email:</label>
                            <input type="email" id="guest-email" placeholder="nombre@email.com"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Teléfono:</label>
                            <input type="tel" id="guest-phone" placeholder="+57 310 234 5678"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="closeGuestModal()"
                            style="flex: 1; padding: 12px; background: #95a5a6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button type="submit"
                            style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para detalles del huésped -->
        <div id="guest-details-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 700px; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="closeGuestDetailsModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #2c3e50; font-size: 24px; cursor: pointer;">×</button>

                <h2 style="color: #2c3e50; margin-bottom: 20px;">📋 Detalles del Huésped</h2>

                <div id="guest-details-content">
                    <!-- Contenido del huésped se carga aquí -->
                </div>
            </div>
        </div>

        <!-- Modal para gestión de productos -->
        <div id="product-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; position: relative;">
                <button onclick="closeProductModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #2c3e50; font-size: 24px; cursor: pointer;">×</button>

                <h2 id="product-modal-title" style="color: #2c3e50; margin-bottom: 20px;">Nuevo Producto</h2>

                <form id="product-form" style="display: grid; gap: 15px;">
                    <div>
                        <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Nombre del Producto:</label>
                        <input type="text" id="product-name" placeholder="Ej: Café Colombiano"
                            style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Precio:</label>
                            <input type="number" id="product-price" placeholder="2.50" step="0.50"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Stock:</label>
                            <input type="number" id="product-stock" placeholder="50"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>
                    </div>

                    <div>
                        <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Categoría:</label>
                        <select id="product-category"
                            style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                            <option value="">Seleccionar categoría</option>
                            <option value="Bebidas">Bebidas</option>
                            <option value="Comida">Comida</option>
                            <option value="Snacks">Snacks</option>
                            <option value="Otros">Otros</option>
                        </select>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="closeProductModal()"
                            style="flex: 1; padding: 12px; background: #95a5a6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button type="submit"
                            style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para gestión de personal -->
        <div id="staff-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 600px; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="closeStaffModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #2c3e50; font-size: 24px; cursor: pointer;">×</button>

                <h2 id="staff-modal-title" style="color: #2c3e50; margin-bottom: 20px;">Nuevo Empleado</h2>

                <form id="staff-form" style="display: grid; gap: 15px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Nombre Completo:</label>
                            <input type="text" id="staff-name" placeholder="Ej: Juan Carlos Pérez"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Cargo:</label>
                            <select id="staff-position"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                                <option value="">Seleccionar cargo</option>
                                <option value="Recepcionista">Recepcionista</option>
                                <option value="Limpieza">Limpieza</option>
                                <option value="Seguridad">Seguridad</option>
                                <option value="Mantenimiento">Mantenimiento</option>
                                <option value="Gerente">Gerente</option>
                                <option value="Contador">Contador</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Teléfono:</label>
                            <input type="tel" id="staff-phone" placeholder="+57 310 234 5678"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Email:</label>
                            <input type="email" id="staff-email" placeholder="empleado@almanik.com"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>
                    </div>

                    <!-- Checkbox Voluntario -->
                    <div style="background: linear-gradient(135deg, #f39c12, #e67e22); padding: 15px; border-radius: 10px; margin: 5px 0;">
                        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; color: white;">
                            <input type="checkbox" id="staff-is-volunteer" onchange="toggleVolunteerMode(this.checked)"
                                style="width: 22px; height: 22px; cursor: pointer; accent-color: #27ae60;">
                            <div>
                                <span style="font-weight: bold; font-size: 16px;">Es Voluntario (Work Exchange)</span>
                                <p style="margin: 3px 0 0 0; font-size: 12px; opacity: 0.9;">Los voluntarios no reciben salario, trabajan a cambio de alojamiento</p>
                            </div>
                        </label>
                    </div>

                    <div id="staff-salary-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Salario (COP):</label>
                            <input type="number" id="staff-salary" placeholder="1200000"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Horario:</label>
                            <input type="text" id="staff-schedule" placeholder="Ej: Mañana: 6:00-14:00"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="closeStaffModal()"
                            style="flex: 1; padding: 12px; background: #95a5a6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button type="submit"
                            style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal para gestión de tours -->
        <div id="tour-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;">
            <div
                style="background: linear-gradient(135deg, #2c3e50, #34495e); padding: 30px; border-radius: 15px; width: 90%; max-width: 700px; position: relative; max-height: 90vh; overflow-y: auto;">
                <button onclick="closeTourModal()"
                    style="position: absolute; top: 15px; right: 15px; background: none; border: none; color: #2c3e50; font-size: 24px; cursor: pointer;">×</button>

                <h2 id="tour-modal-title" style="color: #2c3e50; margin-bottom: 20px;">Nuevo Tour</h2>

                <form id="tour-form" style="display: grid; gap: 15px;">
                    <div>
                        <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Nombre del Tour:</label>
                        <input type="text" id="tour-name" placeholder="Ej: City Tour Medellín"
                            style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                    </div>

                    <div>
                        <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Descripción:</label>
                        <textarea id="tour-description" placeholder="Describe el tour completo..."
                            style="width: 100%; padding: 10px; border: none; border-radius: 5px; height: 100px;"
                            required></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Precio (COP):</label>
                            <input type="number" id="tour-price" placeholder="65000"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Duración:</label>
                            <input type="text" id="tour-duration" placeholder="6 horas"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Comisión (%):</label>
                            <input type="number" id="tour-commission" placeholder="15" min="0" max="50"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">Proveedor:</label>
                            <input type="text" id="tour-provider" placeholder="Ej: TurMedellín"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>

                        <div>
                            <label style="color: #2c3e50; display: block; margin-bottom: 5px;">URL de Reserva:</label>
                            <input type="url" id="tour-url" placeholder="https://turismo-medellin.com/city-tour"
                                style="width: 100%; padding: 10px; border: none; border-radius: 5px;" required>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="closeTourModal()"
                            style="flex: 1; padding: 12px; background: #95a5a6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button type="submit"
                            style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            // Global variables
            let sessionId = localStorage.getItem('sessionId');
            let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
            const API_BASE = '/api';
            let bedsDataCache = {}; // Cache bed data for access in onclick handlers

            // Role-based permission system
            const ROLE_PERMISSIONS = {
                'administrador': {
                    modules: ['dashboard', 'beds', 'guests', 'pos', 'staff', 'cash', 'reports', 'tours', 'users'],
                    actions: ['create', 'read', 'update', 'delete']
                },
                'recepcionista': {
                    modules: ['dashboard', 'beds', 'guests', 'pos', 'reports'],
                    actions: ['create', 'read', 'update']
                },
                'voluntario': {
                    modules: ['dashboard', 'guests', 'pos', 'tours'],
                    actions: ['read']
                }
            };

            // Check if user has permission for module
            function hasModuleAccess(module) {
                if (!currentUser.role) return false;
                return ROLE_PERMISSIONS[currentUser.role]?.modules.includes(module) || false;
            }

            // Check if user has action permission
            function hasActionPermission(action) {
                if (!currentUser.role) return false;
                return ROLE_PERMISSIONS[currentUser.role]?.actions.includes(action) || false;
            }

            // Setup UI based on user role
            function setupRoleBasedUI() {
                if (!currentUser.role) return;

                // Hide/show navigation buttons based on role
                const navButtons = {
                    'dashboard': document.querySelector('button[onclick="showView(\'dashboard\')"]'),
                    'beds': document.querySelector('button[onclick="showView(\'beds\')"]'),
                    'guests': document.querySelector('button[onclick="showView(\'guests\')"]'),
                    'pos': document.querySelector('button[onclick="showView(\'pos\')"]'),
                    'staff': document.querySelector('button[onclick="showView(\'staff\')"]'),
                    'cash': document.querySelector('button[onclick="showView(\'cash\')"]'),
                    'reports': document.querySelector('button[onclick="showView(\'reports\')"]'),
                    'tours': document.querySelector('button[onclick="showView(\'tours\')"]'),
                    'users': document.getElementById('users-nav')
                };

                // Show/hide buttons based on permissions
                Object.keys(navButtons).forEach(module => {
                    const button = navButtons[module];
                    if (button) {
                        button.style.display = hasModuleAccess(module) ? 'flex' : 'none';
                    }
                });

                // Update user info in header
                updateUserHeader();
            }

            // Update user info display
            function updateUserHeader() {
                const userInfo = document.getElementById('user-info');
                if (userInfo && currentUser.name) {
                    userInfo.innerHTML = `
                    <i class="fas fa-user-circle"></i>
                    <span>${currentUser.name}</span>
                    <small style="opacity: 0.7;">${currentUser.role}</small>
                `;
                }
            }

            // Mobile menu toggle function
            function toggleSidebar() {
                const sidebar = document.querySelector('.sidebar');
                const hamburger = document.querySelector('.hamburger');

                sidebar.classList.toggle('active');
                hamburger.classList.toggle('active');

                // Close sidebar when clicking outside on mobile
                if (sidebar.classList.contains('active')) {
                    document.addEventListener('click', closeSidebarOnOutsideClick);
                } else {
                    document.removeEventListener('click', closeSidebarOnOutsideClick);
                }
            }

            function closeSidebarOnOutsideClick(event) {
                const sidebar = document.querySelector('.sidebar');
                const hamburger = document.querySelector('.hamburger');

                if (!sidebar.contains(event.target) && !hamburger.contains(event.target)) {
                    sidebar.classList.remove('active');
                    hamburger.classList.remove('active');
                    document.removeEventListener('click', closeSidebarOnOutsideClick);
                }
            }

            // Initialize application
            document.addEventListener('DOMContentLoaded', function () {
                if (sessionId) {
                    showMainApp();
                } else {
                    showLoginScreen();
                }
            });

            // Authentication
            function showLoginScreen() {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }

            function showMainApp() {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                loadDashboardData();
                updateTime();
                setInterval(updateTime, 1000);
                initCharts();
            }

            function logout() {
                sessionId = null;
                localStorage.removeItem('sessionId');
                showLoginScreen();
            }

            // Login form handling
            document.getElementById('login-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const loginBtn = document.getElementById('login-btn');
                const errorDiv = document.getElementById('login-error');

                loginBtn.disabled = true;
                loginBtn.textContent = 'INGRESANDO...';
                errorDiv.classList.add('hidden');

                try {
                    const response = await fetch(`${API_BASE}/login`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    const data = await response.json();

                    if (data.success) {
                        sessionId = data.sessionId;
                        localStorage.setItem('sessionId', sessionId);
                        showMainApp();
                    } else {
                        errorDiv.textContent = data.message || 'Error de autenticación';
                        errorDiv.classList.remove('hidden');
                    }
                } catch (err) {
                    errorDiv.textContent = 'Error de conexión. Verifique que el servidor esté ejecutándose.';
                    errorDiv.classList.remove('hidden');
                }

                loginBtn.disabled = false;
                loginBtn.textContent = 'INGRESAR AL SISTEMA';
            });

            // API call helper - supports GET, POST, PUT, DELETE
            async function apiCall(endpoint, method = 'GET', data = null) {
                try {
                    const options = {
                        method: method,
                        headers: {
                            'session-id': sessionId,
                            'Content-Type': 'application/json'
                        }
                    };

                    // Add body for non-GET requests
                    if (data && method !== 'GET') {
                        options.body = JSON.stringify(data);
                    }

                    const response = await fetch(`${API_BASE}${endpoint}`, options);

                    if (response.status === 401) {
                        logout();
                        return null;
                    }

                    // Handle empty responses
                    const text = await response.text();
                    if (!text) {
                        return { success: response.ok };
                    }

                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('Invalid JSON response:', text);
                        throw new Error('Respuesta inválida del servidor');
                    }
                } catch (err) {
                    console.error('API call failed:', err);
                    throw err;
                }
            }

            // Load dashboard data
            async function loadDashboardData() {
                const [bedsData, dashboardData, todayData, kpiData] = await Promise.all([
                    apiCall('/beds'),
                    apiCall('/dashboard'),
                    apiCall('/dashboard/today'),
                    apiCall('/dashboard/kpi')
                ]);

                if (bedsData) {
                    updateBedStats(bedsData);
                    renderBeds(bedsData);
                }

                if (dashboardData) {
                    updateRevenue(dashboardData);
                }

                // Cargar panel operativo
                if (todayData) {
                    renderOperationsPanel(todayData);
                }

                // Cargar KPI widgets (DEV2-10)
                if (kpiData) {
                    renderKPIWidgets(kpiData);
                }

                loadRecentActivity();
            }

            // ============================================
            // KPI WIDGETS RENDERER - DEV2-10
            // ============================================
            function renderKPIWidgets(data) {
                // Occupancy Widget
                const occupancyEl = document.getElementById('kpi-occupancy-rate');
                const occupancyChangeEl = document.getElementById('kpi-occupancy-change');
                if (occupancyEl && data.occupancy) {
                    occupancyEl.textContent = `${data.occupancy.rate}%`;

                    const change = data.occupancy.vs_yesterday;
                    if (change > 0) {
                        occupancyChangeEl.className = 'kpi-change positive';
                        occupancyChangeEl.innerHTML = `<i class="fas fa-arrow-up"></i> +${change}% vs ayer`;
                    } else if (change < 0) {
                        occupancyChangeEl.className = 'kpi-change negative';
                        occupancyChangeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${change}% vs ayer`;
                    } else {
                        occupancyChangeEl.className = 'kpi-change neutral';
                        occupancyChangeEl.innerHTML = `<i class="fas fa-minus"></i> igual que ayer`;
                    }
                }

                // Revenue Widget
                const revenueEl = document.getElementById('kpi-revenue-today');
                const revenueChangeEl = document.getElementById('kpi-revenue-change');
                if (revenueEl && data.revenue) {
                    revenueEl.textContent = data.revenue.formatted;

                    const change = data.revenue.vs_yesterday;
                    if (change > 0) {
                        revenueChangeEl.className = 'kpi-change positive';
                        revenueChangeEl.innerHTML = `<i class="fas fa-arrow-up"></i> +${change}% vs ayer`;
                    } else if (change < 0) {
                        revenueChangeEl.className = 'kpi-change negative';
                        revenueChangeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${change}% vs ayer`;
                    } else {
                        revenueChangeEl.className = 'kpi-change neutral';
                        revenueChangeEl.innerHTML = `<i class="fas fa-minus"></i> igual que ayer`;
                    }
                }

                // Check-ins Widget
                const checkinsCountEl = document.getElementById('kpi-checkins-count');
                const checkinsListEl = document.getElementById('kpi-checkins-list');
                if (checkinsCountEl && data.checkins) {
                    checkinsCountEl.textContent = data.checkins.count;

                    if (checkinsListEl && data.checkins.items.length > 0) {
                        const names = data.checkins.items.slice(0, 3).map(c => c.guest_name.split(' ')[0]);
                        checkinsListEl.textContent = names.join(', ') + (data.checkins.count > 3 ? '...' : '');
                    } else if (checkinsListEl) {
                        checkinsListEl.textContent = 'Sin llegadas hoy';
                    }
                }

                // Tasks Widget
                const tasksCountEl = document.getElementById('kpi-tasks-count');
                const tasksListEl = document.getElementById('kpi-tasks-list');
                if (tasksCountEl && data.tasks) {
                    tasksCountEl.textContent = data.tasks.count;

                    if (tasksListEl && data.tasks.items.length > 0) {
                        const titles = data.tasks.items.slice(0, 2).map(t => t.title);
                        tasksListEl.textContent = titles.join(', ') + (data.tasks.count > 2 ? '...' : '');
                    } else if (tasksListEl) {
                        tasksListEl.textContent = 'Todo al día';
                    }
                }

                // Alerts Widget
                const alertsCountEl = document.getElementById('alerts-count');
                const alertsListEl = document.getElementById('alerts-list');
                if (alertsCountEl && data.alerts) {
                    alertsCountEl.textContent = data.alerts.count;

                    if (data.alerts.count === 0) {
                        alertsListEl.innerHTML = `
                            <div class="no-alerts">
                                <i class="fas fa-check-circle"></i>
                                No hay alertas activas
                            </div>
                        `;
                    } else {
                        alertsListEl.innerHTML = data.alerts.items.map(alert => `
                            <div class="alert-item ${alert.type}" onclick="handleAlertClick('${alert.action}', ${alert.booking_id || 'null'})">
                                <div class="alert-icon">
                                    <i class="fas ${alert.icon}"></i>
                                </div>
                                <div class="alert-text">${alert.message}</div>
                                <i class="fas fa-chevron-right" style="color: #bdc3c7;"></i>
                            </div>
                        `).join('');
                    }
                }
            }

            // Handle alert click
            function handleAlertClick(action, bookingId) {
                if (action === 'beds') {
                    showView('beds');
                } else if (action === 'guests') {
                    showView('guests');
                } else if (action === 'cash') {
                    showView('cash');
                }
            }

            // Renderizar panel operativo
            function renderOperationsPanel(data) {
                // Check-outs hoy
                const checkoutsList = document.getElementById('checkouts-list');
                const checkoutCount = document.getElementById('checkout-count');
                if (checkoutsList && data.checkouts_today) {
                    checkoutCount.textContent = data.checkouts_today.length;
                    if (data.checkouts_today.length === 0) {
                        checkoutsList.innerHTML = '<p style="color: #95a5a6; text-align: center; padding: 20px;">No hay check-outs programados para hoy</p>';
                    } else {
                        checkoutsList.innerHTML = data.checkouts_today.map(co => `
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong style="color: #ecf0f1;">👤 ${co.guest_name}</strong>
                                        <p style="color: #95a5a6; margin: 3px 0 0 0; font-size: 12px;">🛏️ ${co.bed_name} (${co.room})</p>
                                    </div>
                                    ${co.amount_due > 0 ? `
                                        <span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 5px; font-size: 12px;">
                                            Debe: $${co.amount_due}
                                        </span>
                                    ` : `
                                        <span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 5px; font-size: 12px;">
                                            PAGADO
                                        </span>
                                    `}
                                </div>
                            </div>
                        `).join('');
                    }
                }

                // Check-ins esperados
                const checkinsList = document.getElementById('checkins-list');
                const checkinCount = document.getElementById('checkin-count');
                if (checkinsList && data.checkins_today) {
                    checkinCount.textContent = data.checkins_today.length;
                    if (data.checkins_today.length === 0) {
                        checkinsList.innerHTML = '<p style="color: #95a5a6; text-align: center; padding: 20px;">No hay check-ins esperados para hoy</p>';
                    } else {
                        checkinsList.innerHTML = data.checkins_today.map(ci => `
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                <div>
                                    <strong style="color: #ecf0f1;">👤 ${ci.guest_name}</strong>
                                    <p style="color: #95a5a6; margin: 3px 0 0 0; font-size: 12px;">
                                        🛏️ ${ci.bed_name} | ${ci.nights} noches | $${ci.total}
                                    </p>
                                </div>
                            </div>
                        `).join('');
                    }
                }

                // Check-outs mañana
                const tomorrowList = document.getElementById('tomorrow-list');
                const tomorrowCount = document.getElementById('tomorrow-count');
                if (tomorrowList && data.checkouts_tomorrow) {
                    tomorrowCount.textContent = data.checkouts_tomorrow.length;
                    if (data.checkouts_tomorrow.length === 0) {
                        tomorrowList.innerHTML = '<p style="color: #95a5a6; text-align: center; padding: 20px;">No hay check-outs programados para mañana</p>';
                    } else {
                        tomorrowList.innerHTML = data.checkouts_tomorrow.map(co => `
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 8px;">
                                <div>
                                    <strong style="color: #ecf0f1;">👤 ${co.guest_name}</strong>
                                    <p style="color: #95a5a6; margin: 3px 0 0 0; font-size: 12px;">🛏️ ${co.bed_name} (${co.room})</p>
                                </div>
                            </div>
                        `).join('');
                    }
                }
            }

            // Update bed statistics
            function updateBedStats(beds) {
                const occupied = beds.filter(b => b.status === 'occupied').length;
                const clean = beds.filter(b => b.status === 'clean').length;
                const dirty = beds.filter(b => b.status === 'dirty').length;
                const total = beds.length;

                document.getElementById('occupied-count').textContent = occupied;
                document.getElementById('clean-count').textContent = clean;
                document.getElementById('dirty-count').textContent = dirty;

                // Update progress bars
                const occupancyRate = Math.round((occupied / total) * 100);
                const cleanRate = Math.round((clean / total) * 100);
                const dirtyRate = Math.round((dirty / total) * 100);

                document.getElementById('occupied-progress').style.width = `${occupancyRate}%`;
                document.getElementById('clean-progress').style.width = `${cleanRate}%`;
                document.getElementById('dirty-progress').style.width = `${dirtyRate}%`;
                document.getElementById('occupancy-rate').textContent = `${occupancyRate}%`;
            }

            // Update revenue
            function updateRevenue(data) {
                if (data.todayRevenue !== undefined) {
                    const formatted = new Intl.NumberFormat('es-CO').format(data.todayRevenue * 1000);
                    document.getElementById('revenue-amount').textContent = `$${formatted}`;
                }
            }

            // Render beds
            function renderBeds(beds) {
                const dormBeds = beds.filter(b => b.name.includes('A') || b.name.includes('B'));
                const privateBeds = beds.filter(b => b.name.includes('PR') || b.name.includes('Private'));

                renderBedGrid('dorm-beds', dormBeds);
                renderBedGrid('private-beds', privateBeds);
            }

            function renderBedGrid(containerId, beds) {
                const container = document.getElementById(containerId);
                container.innerHTML = '';

                beds.forEach(bed => {
                    const bedElement = document.createElement('div');
                    bedElement.className = `bed-status ${bed.status}`;
                    bedElement.innerHTML = `
                    <div class="bed-number">${bed.name}</div>
                    <div class="bed-guest">${bed.guest_name || 'Disponible'}</div>
                `;

                    bedElement.addEventListener('click', () => {
                        let message = '';
                        if (bed.status === 'clean') {
                            message = `Cama ${bed.name} disponible para check-in`;
                        } else if (bed.status === 'occupied') {
                            message = `Cama ${bed.name} - Huésped: ${bed.guest_name}`;
                        } else if (bed.status === 'dirty') {
                            message = `Cama ${bed.name} necesita limpieza`;
                        }
                        alert(message);
                    });

                    container.appendChild(bedElement);
                });
            }

            // Load recent activity - shows real activity when available
            async function loadRecentActivity() {
                const container = document.getElementById('activity-list');

                try {
                    // Try to load real activity from API
                    const response = await apiCall('/activity/recent');

                    if (response && response.length > 0) {
                        container.innerHTML = '';
                        response.forEach(activity => {
                            const activityElement = document.createElement('div');
                            activityElement.className = 'activity-item';
                            activityElement.innerHTML = `
                                <div class="activity-icon ${activity.action_type || 'default'}">
                                    <i class="fas fa-${getActivityIcon(activity.action_type)}"></i>
                                </div>
                                <div class="activity-content">
                                    <div class="activity-title">${activity.module || 'Sistema'}</div>
                                    <div class="activity-desc">${activity.description}</div>
                                    <div class="activity-time">${formatTimeAgo(activity.created_at)}</div>
                                </div>
                            `;
                            container.appendChild(activityElement);
                        });
                    } else {
                        showNoActivityMessage(container);
                    }
                } catch (error) {
                    // If API doesn't exist yet, show helpful message
                    showNoActivityMessage(container);
                }
            }

            function showNoActivityMessage(container) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #95a5a6;">
                        <i class="fas fa-history" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p style="margin: 0;">La actividad se mostrará aquí</p>
                        <p style="font-size: 12px; margin-top: 5px;">Check-ins, pagos y ventas recientes</p>
                    </div>
                `;
            }

            function getActivityIcon(actionType) {
                const icons = {
                    'checkin': 'user-plus',
                    'checkout': 'user-minus',
                    'payment': 'credit-card',
                    'sale': 'shopping-cart',
                    'create': 'plus-circle',
                    'update': 'edit',
                    'delete': 'trash',
                    'complete': 'check-circle'
                };
                return icons[actionType] || 'clock';
            }

            function formatTimeAgo(dateStr) {
                if (!dateStr) return '';
                const date = new Date(dateStr);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);

                if (diffMins < 1) return 'hace un momento';
                if (diffMins < 60) return `hace ${diffMins} min`;
                if (diffHours < 24) return `hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
                return `hace ${diffDays} día${diffDays > 1 ? 's' : ''}`;
            }

            // Update time
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('es-CO', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                const dateString = now.toLocaleDateString('es-CO', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                document.getElementById('current-time').textContent = timeString;
                document.getElementById('current-date').textContent = dateString;
            }

            // Variable global para filtro de camas desde dashboard
            let currentBedFilter = null;

            // Función para mostrar camas con filtro desde dashboard
            function showBedsFiltered(filterType) {
                currentBedFilter = filterType;
                showView('beds');
            }

            // Limpiar filtro de camas
            function clearBedFilter() {
                currentBedFilter = null;
                refreshBeds();
            }

            // Navigation
            function showView(viewName) {
                // Close mobile sidebar when navigation item is clicked
                const sidebar = document.querySelector('.sidebar');
                const hamburger = document.querySelector('.hamburger');
                if (sidebar && hamburger) {
                    sidebar.classList.remove('active');
                    hamburger.classList.remove('active');
                    document.removeEventListener('click', closeSidebarOnOutsideClick);
                }

                // Hide all views
                document.querySelectorAll('[id$="-view"]').forEach(view => {
                    view.classList.add('hidden');
                });

                // Show selected view
                const targetView = document.getElementById(viewName + '-view');
                if (targetView) {
                    targetView.classList.remove('hidden');
                } else {
                    console.error('View not found:', viewName + '-view');
                    return;
                }

                // Update navigation buttons
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Find and activate the button that was clicked
                const clickedButton = document.querySelector(`button[onclick*="showView('${viewName}')"]`);
                if (clickedButton) {
                    clickedButton.classList.add('active');
                }

                // Handle specific view actions
                if (viewName === 'beds') {
                    checkPreselectedGuest();
                } else if (viewName === 'guests') {
                    refreshGuests();
                } else if (viewName === 'pos') {
                    loadProducts();
                } else if (viewName === 'staff') {
                    loadStaffViewData();
                } else if (viewName === 'tours') {
                    loadTours();
                } else if (viewName === 'users') {
                    loadUsers();
                }
            }

            // Initialize charts
            function initCharts() {
                // Occupancy Chart
                const occupancyCtx = document.getElementById('occupancyChart').getContext('2d');
                new Chart(occupancyCtx, {
                    type: 'line',
                    data: {
                        labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
                        datasets: [{
                            label: 'Tasa de Ocupación (%)',
                            data: [65, 78, 82, 89, 95, 92, 87],
                            borderColor: 'rgba(46, 204, 113, 1)',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: 'rgba(46, 204, 113, 1)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        aspectRatio: 2.5,
                        plugins: {
                            legend: {
                                labels: {
                                    color: 'white',
                                    font: { size: 14 }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.8)',
                                    font: { size: 12 }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            x: {
                                ticks: {
                                    color: 'rgba(255, 255, 255, 0.8)',
                                    font: { size: 12 }
                                },
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });

                // Revenue Chart
                const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                new Chart(revenueCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Alojamiento', 'Ventas POS', 'Tours', 'Lavandería'],
                        datasets: [{
                            data: [1850000, 400000, 200000, 100000],
                            backgroundColor: [
                                'rgba(52, 152, 219, 0.8)',
                                'rgba(46, 204, 113, 0.8)',
                                'rgba(243, 156, 18, 0.8)',
                                'rgba(155, 89, 182, 0.8)'
                            ],
                            borderColor: [
                                'rgba(52, 152, 219, 1)',
                                'rgba(46, 204, 113, 1)',
                                'rgba(243, 156, 18, 1)',
                                'rgba(155, 89, 182, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        aspectRatio: 1,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: 'white',
                                    font: { size: 12 },
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }

            // ============= CAMAS FUNCTIONALITY =============
            let currentEditingBed = null;

            async function refreshBeds() {
                try {
                    const response = await apiCall('/beds/by-room');
                    if (response) {
                        renderBedsByRoom(response);
                        updateBedsSummary(response);
                    }
                } catch (error) {
                    console.error('Error loading beds:', error);
                }
            }

            function renderBedsByRoom(bedsByRoom) {
                const container = document.getElementById('rooms-container');
                container.innerHTML = '';

                // Cache all bed data for access in onclick handlers
                bedsDataCache = {};
                Object.values(bedsByRoom).forEach(beds => {
                    beds.forEach(bed => {
                        bedsDataCache[bed.id] = bed;
                    });
                });

                // Mostrar indicador de filtro activo si hay uno
                if (currentBedFilter) {
                    const filterLabels = {
                        'occupied': 'Ocupadas',
                        'clean': 'Disponibles',
                        'dirty': 'Por Limpiar',
                        'maintenance': 'Mantenimiento',
                        'reserved': 'Reservadas'
                    };
                    const filterDiv = document.createElement('div');
                    filterDiv.style.cssText = 'background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(52,152,219,0.3);';
                    filterDiv.innerHTML = `
                        <span><i class="fas fa-filter"></i> Filtrando: <strong>${filterLabels[currentBedFilter] || currentBedFilter}</strong></span>
                        <button onclick="clearBedFilter()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            <i class="fas fa-times"></i> Quitar filtro
                        </button>
                    `;
                    container.appendChild(filterDiv);
                }

                // Helper para formatear fechas
                const formatDate = (dateStr) => {
                    if (!dateStr) return '';
                    const date = new Date(dateStr);
                    const day = date.getDate();
                    const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
                    return `${day} ${months[date.getMonth()]}`;
                };

                // Helper para verificar si checkout es hoy o mañana
                const getCheckoutAlert = (checkOut) => {
                    if (!checkOut) return '';
                    const todayDate = new Date();
                    const tomorrowDate = new Date();
                    tomorrowDate.setDate(tomorrowDate.getDate() + 1);
                    const today = formatDateToInput(todayDate);
                    const tomorrow = formatDateToInput(tomorrowDate);
                    if (checkOut === today) return '<span style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px;">HOY</span>';
                    if (checkOut === tomorrow) return '<span style="background: #f39c12; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-left: 5px;">MAÑANA</span>';
                    return '';
                };

                Object.keys(bedsByRoom).forEach(roomName => {
                    // Aplicar filtro si está activo
                    let beds = bedsByRoom[roomName];
                    if (currentBedFilter) {
                        beds = beds.filter(bed => bed.status === currentBedFilter);
                    }

                    // Saltar habitación si no tiene camas que mostrar
                    if (beds.length === 0) return;

                    const roomDiv = document.createElement('div');
                    roomDiv.style.marginBottom = '30px';

                    const roomIcon = roomName.includes('Priv') ? '🚪' : '🏠';

                    roomDiv.innerHTML = `
                    <h2 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        ${roomIcon} ${roomName}
                        <span style="font-size: 14px; background: rgba(255,255,255,0.95); box-shadow: 0 4px 16px rgba(0,0,0,0.05); padding: 5px 10px; border-radius: 15px;">
                            ${beds.length} camas
                        </span>
                    </h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;">
                        ${beds.map(bed => `
                            <div style="
                                background: ${getBedCardBackground(bed.status)};
                                border-radius: 15px;
                                padding: 20px;
                                border: 2px solid ${getBedColor(bed.status)};
                                box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                                backdrop-filter: blur(10px);
                                transition: all 0.3s ease;
                                position: relative;
                                overflow: hidden;
                            " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 35px rgba(0,0,0,0.4)'"
                               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'">
                                <!-- Status indicator -->
                                <div style="position: absolute; top: 15px; right: 15px; width: 12px; height: 12px; border-radius: 50%; background: ${getBedColor(bed.status)}; box-shadow: 0 0 10px ${getBedColor(bed.status)};"></div>

                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <h3 style="color: #2c3e50; margin: 0; font-size: 18px; font-weight: bold;">🛏️ ${bed.name}</h3>
                                    <button onclick="showEditBedModal(${bed.id})" style="background: linear-gradient(135deg, #fef3e2, #fce4b8); border: 1px solid #f39c12; color: #f39c12; cursor: pointer; font-size: 14px; padding: 6px 8px; border-radius: 8px; transition: all 0.3s ease;" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>

                                <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: 8px;">
                                    <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 12px;">⚡</span>
                                        Estado: <strong style="color: ${getBedColor(bed.status)}; text-shadow: 0 0 5px ${getBedColor(bed.status)};">${getBedStatusText(bed.status)}</strong>
                                    </p>

                                    ${bed.status === 'occupied' && bed.guest_name ? `
                                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 12px;">👤</span>
                                                <strong style="color: #3498db;">${bed.guest_name}</strong>
                                            </p>
                                            ${bed.check_in && bed.check_out ? `
                                                <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                                    <span style="font-size: 12px;">📅</span>
                                                    ${formatDate(bed.check_in)} → ${formatDate(bed.check_out)} ${getCheckoutAlert(bed.check_out)}
                                                </p>
                                            ` : ''}
                                            ${bed.booking_total ? `
                                                <div style="display: flex; justify-content: space-between; margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
                                                    <span style="color: #95a5a6; font-size: 12px;">Total: $${bed.booking_total}</span>
                                                    ${bed.amount_due > 0 ? `
                                                        <span style="color: #e74c3c; font-size: 12px; font-weight: bold;">Debe: $${bed.amount_due}</span>
                                                    ` : `
                                                        <span style="color: #27ae60; font-size: 12px; font-weight: bold;">PAGADO</span>
                                                    `}
                                                </div>
                                            ` : ''}
                                        </div>
                                    ` : ''}

                                    ${bed.status === 'reserved' && bed.reserved_guest_name ? `
                                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);">
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 12px;">📅</span>
                                                Reservada para: <strong style="color: #9b59b6;">${bed.reserved_guest_name}</strong>
                                            </p>
                                        </div>
                                    ` : ''}

                                    ${bed.status === 'clean' ? `
                                        <p style="color: #27ae60; margin: 10px 0 5px 0; display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                            <span style="font-size: 12px;">✅</span>
                                            Disponible | $${bed.price}/noche
                                        </p>
                                        ${bed.notes ? `
                                            <p style="color: #7f8c8d; margin: 5px 0; display: flex; align-items: flex-start; gap: 8px; font-size: 12px;" title="${bed.notes.replace(/"/g, '&quot;')}">
                                                <span style="font-size: 12px;">📝</span>
                                                <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px;">${bed.notes.length > 50 ? bed.notes.substring(0, 50) + '...' : bed.notes}</span>
                                            </p>
                                        ` : ''}
                                    ` : ''}

                                    ${bed.status === 'dirty' ? `
                                        <p style="color: #f39c12; margin: 10px 0 5px 0; display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                            <span style="font-size: 12px;">🧹</span>
                                            Necesita limpieza
                                        </p>
                                    ` : ''}

                                    ${bed.status === 'maintenance' ? `
                                        <p style="color: #7f8c8d; margin: 10px 0 5px 0; display: flex; align-items: center; gap: 8px; font-size: 13px;">
                                            <span style="font-size: 12px;">🔧</span>
                                            En mantenimiento
                                        </p>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                    container.appendChild(roomDiv);
                });
            }

            function updateBedsSummary(bedsByRoom) {
                let totalBeds = 0;
                let cleanBeds = 0;
                let occupiedBeds = 0;
                let dirtyBeds = 0;

                Object.values(bedsByRoom).forEach(beds => {
                    beds.forEach(bed => {
                        totalBeds++;
                        if (bed.status === 'clean') cleanBeds++;
                        else if (bed.status === 'occupied') occupiedBeds++;
                        else if (bed.status === 'dirty') dirtyBeds++;
                    });
                });

                document.getElementById('total-beds-count').textContent = totalBeds;
                document.getElementById('clean-beds-count').textContent = cleanBeds;
                document.getElementById('occupied-beds-count').textContent = occupiedBeds;
                document.getElementById('dirty-beds-count').textContent = dirtyBeds;
            }

            function getBedColor(status) {
                switch (status) {
                    case 'clean': return '#27ae60';
                    case 'occupied': return '#e74c3c';
                    case 'dirty': return '#f39c12';
                    case 'reserved': return '#9b59b6';
                    case 'maintenance': return '#7f8c8d';
                    default: return '#95a5a6';
                }
            }

            function getBedCardBackground(status) {
                switch (status) {
                    case 'clean': return 'linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.1))';
                    case 'occupied': return 'linear-gradient(135deg, rgba(231, 76, 60, 0.2), rgba(192, 57, 43, 0.1))';
                    case 'dirty': return 'linear-gradient(135deg, rgba(243, 156, 18, 0.2), rgba(230, 126, 34, 0.1))';
                    case 'reserved': return 'linear-gradient(135deg, rgba(155, 89, 182, 0.2), rgba(142, 68, 173, 0.1))';
                    case 'maintenance': return 'linear-gradient(135deg, rgba(127, 140, 141, 0.2), rgba(149, 165, 166, 0.1))';
                    default: return 'linear-gradient(135deg, rgba(149, 165, 166, 0.2), rgba(127, 140, 141, 0.1))';
                }
            }

            function getBedStatusText(status) {
                switch (status) {
                    case 'clean': return 'Disponible';
                    case 'occupied': return 'Ocupada';
                    case 'dirty': return 'Por Limpiar';
                    case 'reserved': return 'Reservada';
                    case 'maintenance': return 'Mantenimiento';
                    default: return 'Desconocido';
                }
            }

            function getBedActions(bed) {
                let actions = [];

                const buttonBaseStyle = "padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-transform: uppercase; letter-spacing: 0.3px;";
                const smallButtonStyle = "padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-size: 10px; transition: all 0.3s ease;";

                // Primary actions based on status
                if (bed.status === 'clean') {
                    const selectedGuestId = localStorage.getItem('selectedGuestForCheckin');
                    actions.push(`
                    <button onclick="startCheckin(${bed.id}, ${selectedGuestId || 'null'})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #3498db, #2980b9); color: white;"
                            title="Hacer Check-in">
                        🏨 Check-in
                    </button>
                    <button onclick="showReserveModal(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white;"
                            title="Reservar cama">
                        📅 Reservar
                    </button>
                `);
                } else if (bed.status === 'dirty') {
                    actions.push(`
                    <button onclick="markBedClean(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #27ae60, #229954); color: white;"
                            title="Marcar como limpia">
                        ✨ Limpia
                    </button>
                `);
                } else if (bed.status === 'occupied') {
                    actions.push(`
                    <button onclick="startCheckout(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;"
                            title="Hacer Check-out">
                        🚪 Check-out
                    </button>
                    <button onclick="showTransferModal(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #1abc9c, #16a085); color: white;"
                            title="Cambiar a otra cama">
                        🔄 Cambiar
                    </button>
                    <button onclick="markBedDirty(${bed.id})"
                            style="${smallButtonStyle} background: #f39c12; color: white;"
                            title="Marcar para limpieza">
                        🧹
                    </button>
                `);
                } else if (bed.status === 'reserved') {
                    actions.push(`
                    <button onclick="confirmReservation(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #3498db, #2980b9); color: white;"
                            title="Confirmar Check-in">
                        🏨 Check-in
                    </button>
                    <button onclick="cancelReservation(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;"
                            title="Cancelar reserva">
                        ❌ Cancelar
                    </button>
                `);
                } else if (bed.status === 'maintenance') {
                    actions.push(`
                    <button onclick="endMaintenance(${bed.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #27ae60, #229954); color: white;"
                            title="Finalizar mantenimiento">
                        ✅ Listo
                    </button>
                `);
                }

                // Secondary actions row
                actions.push(`</div><div style="display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px;">`);

                // History button (always)
                actions.push(`
                    <button onclick="showBedHistory(${bed.id})"
                            style="${smallButtonStyle} background: #34495e; color: white;"
                            title="Ver historial">
                        📋
                    </button>
                `);

                // Notes button (always)
                actions.push(`
                    <button onclick="showBedNotes(${bed.id})"
                            style="${smallButtonStyle} background: ${bed.notes ? '#3498db' : '#bdc3c7'}; color: white;"
                            title="${bed.notes ? 'Ver/Editar notas' : 'Agregar nota'}">
                        📝
                    </button>
                `);

                // Maintenance button (if not occupied or in maintenance)
                if (bed.status !== 'occupied' && bed.status !== 'maintenance') {
                    actions.push(`
                    <button onclick="showMaintenanceModal(${bed.id})"
                            style="${smallButtonStyle} background: #7f8c8d; color: white;"
                            title="Poner en mantenimiento">
                        🔧
                    </button>
                `);
                }

                // Delete button (if not occupied)
                if (bed.status !== 'occupied') {
                    actions.push(`
                    <button onclick="deleteBed(${bed.id})"
                            style="${smallButtonStyle} background: #e74c3c; color: white;"
                            title="Eliminar cama">
                        🗑️
                    </button>
                `);
                }

                return actions.join('');
            }

            // ============= MODAL FUNCTIONALITY =============
            function showAddBedModal() {
                currentEditingBed = null;
                document.getElementById('bed-modal-title').textContent = 'Nueva Cama';
                document.getElementById('bed-form').reset();
                document.getElementById('bed-notes').value = '';
                document.getElementById('bed-guest-info').style.display = 'none';
                document.getElementById('bed-delete-section').style.display = 'none';
                document.getElementById('bed-modal').style.display = 'flex';
            }

            async function showEditBedModal(bedId) {
                try {
                    const beds = await apiCall('/beds');
                    const bed = beds.find(b => b.id === bedId);

                    if (bed) {
                        currentEditingBed = bed;
                        document.getElementById('bed-modal-title').textContent = `Gestionar Cama ${bed.name}`;
                        document.getElementById('bed-name').value = bed.name;
                        document.getElementById('bed-room').value = bed.room || '';
                        document.getElementById('bed-price').value = bed.price;
                        document.getElementById('bed-status').value = bed.status;
                        document.getElementById('bed-notes').value = bed.notes || '';

                        // Show/hide guest info
                        const guestInfoDiv = document.getElementById('bed-guest-info');
                        if (bed.status === 'occupied' && bed.guest_name) {
                            document.getElementById('bed-guest-name').textContent = bed.guest_name;
                            document.getElementById('bed-guest-doc').textContent = `Doc: ${bed.guest_document || 'N/A'}`;
                            guestInfoDiv.style.display = 'block';
                        } else {
                            guestInfoDiv.style.display = 'none';
                        }

                        // Solo admin puede eliminar camas
                        const isAdmin = currentUser.role === 'administrador';
                        document.getElementById('bed-delete-section').style.display = isAdmin ? 'block' : 'none';

                        document.getElementById('bed-modal').style.display = 'flex';
                    }
                } catch (error) {
                    alert('Error al cargar datos de la cama');
                }
            }

            async function deleteBedFromModal() {
                if (currentEditingBed && confirm(`¿Eliminar la cama ${currentEditingBed.name}? Esta acción no se puede deshacer.`)) {
                    try {
                        await apiCall(`/beds/${currentEditingBed.id}`, 'DELETE');
                        alert('Cama eliminada');
                        closeBedModal();
                        refreshBeds();
                    } catch (error) {
                        alert('Error: ' + (error.message || 'Error desconocido'));
                    }
                }
            }

            function closeBedModal() {
                document.getElementById('bed-modal').style.display = 'none';
                currentEditingBed = null;
            }

            // Variable para guardar la cama pendiente de asignar huésped
            let pendingCheckinBedId = null;
            let pendingBedFormData = null;

            // Detectar cambio de estado en el dropdown
            document.getElementById('bed-status').addEventListener('change', function(e) {
                const newStatus = e.target.value;
                const guestRequiredStates = ['occupied', 'reserved'];

                // Si cambia a un estado que requiere huésped Y la cama no tiene huésped asignado
                if (currentEditingBed && guestRequiredStates.includes(newStatus)) {
                    // Verificar si ya tiene un huésped asignado
                    if (!currentEditingBed.guest_id) {
                        // IMPORTANTE: Guardar referencia ANTES de cerrar el modal
                        // porque closeBedModal() pone currentEditingBed = null
                        const bedToProcess = { ...currentEditingBed };
                        pendingCheckinBedId = bedToProcess.id;
                        closeBedModal();
                        showGuestSelectorModal(bedToProcess, newStatus);
                    }
                }
            });

            // Form handler - versión simple sin interceptar
            document.getElementById('bed-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = {
                    name: document.getElementById('bed-name').value,
                    room: document.getElementById('bed-room').value,
                    price: parseFloat(document.getElementById('bed-price').value),
                    status: document.getElementById('bed-status').value,
                    notes: document.getElementById('bed-notes').value || null
                };

                try {
                    if (currentEditingBed) {
                        await apiCall(`/beds/${currentEditingBed.id}`, 'PUT', formData);
                    } else {
                        await apiCall('/beds', 'POST', formData);
                    }

                    closeBedModal();
                    refreshBeds();
                } catch (error) {
                    alert('Error al guardar la cama: ' + (error.message || 'Error desconocido'));
                }
            });

            // ============= GUEST SELECTOR MODAL =============
            let pendingBedStatus = 'occupied'; // 'occupied' o 'reserved'

            async function showGuestSelectorModal(bed, targetStatus = 'occupied') {
                pendingCheckinBedId = bed.id;
                pendingBedStatus = targetStatus;

                // Actualizar título según el tipo de acción
                const isReservation = targetStatus === 'reserved';
                const modalTitle = isReservation ? '📅 Seleccionar Huésped para Reserva' : '👤 Seleccionar Huésped para Check-in';
                document.querySelector('#guest-selector-modal h2').textContent = modalTitle;

                // Actualizar info de la cama
                document.querySelector('#guest-selector-bed-info strong').textContent = bed.name;

                // Cargar huéspedes disponibles (sin cama asignada)
                try {
                    const guests = await apiCall('/guests');
                    const availableGuests = guests.filter(g => !g.current_bed_name);

                    const listContainer = document.getElementById('guest-selector-list');

                    if (availableGuests.length === 0) {
                        listContainer.innerHTML = `
                            <div style="text-align: center; padding: 30px; color: #95a5a6;">
                                <p style="font-size: 48px; margin-bottom: 10px;">📭</p>
                                <p>No hay huéspedes disponibles</p>
                                <p style="font-size: 12px;">Registra un nuevo huésped para asignarlo a esta cama</p>
                            </div>
                        `;
                    } else {
                        listContainer.innerHTML = availableGuests.map(guest => `
                            <div onclick="selectGuestForCheckin(${guest.id}, '${guest.name.replace(/'/g, "\\'")}')"
                                 style="padding: 15px; background: rgba(255,255,255,0.1); border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s;"
                                 onmouseover="this.style.background='rgba(52, 152, 219, 0.3)'"
                                 onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <p style="color: #ecf0f1; font-weight: bold; margin: 0;">👤 ${guest.name}</p>
                                        <p style="color: #95a5a6; font-size: 12px; margin: 5px 0 0 0;">Doc: ${guest.document || 'N/A'}</p>
                                    </div>
                                    <span style="color: #3498db; font-size: 20px;">→</span>
                                </div>
                            </div>
                        `).join('');
                    }

                    document.getElementById('guest-selector-modal').style.display = 'flex';
                } catch (error) {
                    alert('Error al cargar huéspedes: ' + error.message);
                }
            }

            function closeGuestSelectorModal() {
                document.getElementById('guest-selector-modal').style.display = 'none';
                pendingCheckinBedId = null;
                pendingBedFormData = null;
                refreshBeds();
            }

            async function selectGuestForCheckin(guestId, guestName) {
                if (!pendingCheckinBedId) {
                    alert('Error: No hay cama seleccionada');
                    return;
                }

                try {
                    // Usar endpoint según el tipo de acción
                    if (pendingBedStatus === 'reserved') {
                        // Para reservas: usar endpoint de reserve
                        await apiCall(`/beds/${pendingCheckinBedId}/reserve`, 'POST', {
                            guest_id: guestId,
                            reserved_until: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0] // 7 días por defecto
                        });
                    } else {
                        // Para ocupar: usar endpoint de checkin
                        await apiCall(`/beds/${pendingCheckinBedId}/checkin`, 'POST', { guestId: guestId });
                    }

                    closeGuestSelectorModal();
                    refreshBeds();
                } catch (error) {
                    alert('Error: ' + (error.message || 'Error desconocido'));
                }
            }

            function registerNewGuestAndReturn() {
                // Guardar el ID de la cama pendiente en sessionStorage para recuperarlo después
                if (pendingCheckinBedId) {
                    sessionStorage.setItem('pendingCheckinBedId', pendingCheckinBedId);
                }

                // Cerrar el modal del selector
                document.getElementById('guest-selector-modal').style.display = 'none';

                // Ir a la vista de huéspedes y abrir el modal de registro
                showView('guests');

                // Pequeño delay para asegurar que la vista se cargue
                setTimeout(() => {
                    showAddGuestModal();
                    // No alert - el modal ya indica claramente la acción
                }, 300);
            }

            // Guest form handling
            document.getElementById('guest-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = {
                    name: document.getElementById('guest-name').value,
                    document: document.getElementById('guest-document').value,
                    email: document.getElementById('guest-email').value,
                    phone: document.getElementById('guest-phone').value
                };

                try {
                    const guestId = this.getAttribute('data-guest-id');
                    if (guestId) {
                        // Editar huésped existente
                        await apiCall(`/guests/${guestId}`, 'PUT', formData);
                    } else {
                        // Crear nuevo huésped
                        await apiCall('/guests', 'POST', formData);
                    }

                    closeGuestModal();
                    refreshGuests();
                } catch (error) {
                    console.error('Error saving guest:', error);
                    alert('Error al guardar el huésped: ' + (error.message || 'Error desconocido'));
                }
            });

            // Product form handling
            document.getElementById('product-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = {
                    name: document.getElementById('product-name').value,
                    price: parseFloat(document.getElementById('product-price').value),
                    category: document.getElementById('product-category').value,
                    stock: parseInt(document.getElementById('product-stock').value)
                };

                try {
                    const productId = this.getAttribute('data-product-id');
                    if (productId) {
                        // Edit existing product
                        await apiCall(`/products/${productId}`, 'PUT', formData);
                    } else {
                        // Create new product
                        await apiCall('/products', 'POST', formData);
                    }

                    closeProductModal();
                    loadProducts();
                } catch (error) {
                    console.error('Error saving product:', error);
                    alert('Error al guardar el producto: ' + (error.message || 'Error desconocido'));
                }
            });

            // Staff form handling
            document.getElementById('staff-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const isVolunteer = document.getElementById('staff-is-volunteer').checked;
                const formData = {
                    name: document.getElementById('staff-name').value,
                    position: document.getElementById('staff-position').value,
                    phone: document.getElementById('staff-phone').value,
                    email: document.getElementById('staff-email').value,
                    salary: isVolunteer ? null : (parseFloat(document.getElementById('staff-salary').value) || null),
                    schedule: document.getElementById('staff-schedule').value,
                    is_volunteer: isVolunteer
                };

                try {
                    const staffId = this.getAttribute('data-staff-id');
                    if (staffId) {
                        // Edit existing staff member
                        await apiCall(`/staff/${staffId}`, 'PUT', formData);
                        showNotification('Empleado actualizado exitosamente', 'success');
                    } else {
                        // Create new staff member
                        await apiCall('/staff', 'POST', formData);
                        showNotification('Empleado creado exitosamente', 'success');
                    }

                    closeStaffModal();
                    loadStaff();
                } catch (error) {
                    console.error('Error saving staff:', error);
                    showNotification('Error al guardar el empleado: ' + (error.message || 'Error desconocido'), 'error');
                }
            });

            // Tour form handling
            document.getElementById('tour-form').addEventListener('submit', async function (e) {
                e.preventDefault();

                const formData = {
                    name: document.getElementById('tour-name').value,
                    description: document.getElementById('tour-description').value,
                    price: parseFloat(document.getElementById('tour-price').value),
                    duration: document.getElementById('tour-duration').value,
                    provider: document.getElementById('tour-provider').value,
                    commission_rate: parseFloat(document.getElementById('tour-commission').value),
                    booking_url: document.getElementById('tour-url').value,
                    images: [] // For now, empty array. Could be enhanced to handle image uploads
                };

                try {
                    const tourId = this.getAttribute('data-tour-id');
                    if (tourId) {
                        // Edit existing tour
                        await apiCall(`/tours/${tourId}`, 'PUT', formData);
                        showNotification('Tour actualizado exitosamente', 'success');
                    } else {
                        // Create new tour
                        await apiCall('/tours', 'POST', formData);
                        showNotification('Tour creado exitosamente', 'success');
                    }

                    closeTourModal();
                    loadTours();
                } catch (error) {
                    console.error('Error saving tour:', error);
                    showNotification('Error al guardar el tour', 'error');
                }
            });

            async function deleteBed(bedId) {
                if (confirm('¿Estás seguro de que quieres eliminar esta cama?')) {
                    try {
                        await apiCall(`/beds/${bedId}`, 'DELETE');
                        showNotification('Cama eliminada exitosamente', 'success');
                        refreshBeds();
                    } catch (error) {
                        showNotification('Error al eliminar la cama', 'error');
                    }
                }
            }

            // ============= ADVANCED BED MANAGEMENT =============

            // Mark bed as clean (available)
            async function markBedClean(bedId) {
                try {
                    await apiCall(`/beds/${bedId}/mark-clean`, 'PUT', { notes: 'Marked clean by user' });
                    refreshBeds();
                    showNotification('Cama marcada como disponible', 'success');
                } catch (error) {
                    alert('Error al actualizar la cama: ' + (error.message || 'Error desconocido'));
                }
            }

            // Legacy function for compatibility
            async function markClean(bedId) {
                await markBedClean(bedId);
            }

            // Mark bed as dirty (needs cleaning)
            async function markBedDirty(bedId) {
                console.log('🧹 markBedDirty called with:', bedId);
                alert('Marcando cama para limpieza: ' + bedId);
                if (confirm('¿Marcar esta cama como "necesita limpieza"?')) {
                    try {
                        await apiCall(`/beds/${bedId}/mark-dirty`, 'PUT', { notes: 'Marked dirty by user' });
                        refreshBeds();
                        showNotification('Cama marcada para limpieza', 'warning');
                    } catch (error) {
                        alert('Error al actualizar la cama: ' + (error.message || 'Error desconocido'));
                    }
                }
            }

            // Show maintenance modal
            function showMaintenanceModal(bedId) {
                const reason = prompt('Razón del mantenimiento:');
                if (reason !== null) {
                    putBedInMaintenance(bedId, reason);
                }
            }

            // Put bed in maintenance
            async function putBedInMaintenance(bedId, reason) {
                try {
                    await apiCall(`/beds/${bedId}/maintenance`, 'PUT', { reason: reason || 'Mantenimiento general' });
                    refreshBeds();
                    showNotification('Cama en mantenimiento', 'info');
                } catch (error) {
                    alert('Error: ' + (error.message || 'Error desconocido'));
                }
            }

            // End maintenance
            async function endMaintenance(bedId) {
                try {
                    await apiCall(`/beds/${bedId}/mark-clean`, 'PUT', { notes: 'Maintenance completed' });
                    refreshBeds();
                    showNotification('Mantenimiento finalizado', 'success');
                } catch (error) {
                    alert('Error: ' + (error.message || 'Error desconocido'));
                }
            }

            // Show reserve modal
            async function showReserveModal(bedId) {
                try {
                    const guests = await apiCall('/guests');
                    const availableGuests = guests.filter(g => !g.current_bed_id);

                    if (availableGuests.length === 0) {
                        alert('No hay huéspedes disponibles para reservar. Primero registra un huésped.');
                        return;
                    }

                    const guestOptions = availableGuests.map((g, i) => `${i + 1}. ${g.name} (${g.document})`).join('\n');
                    const selection = prompt(`Selecciona un huésped para la reserva:\n\n${guestOptions}\n\nIngresa el número:`);

                    if (selection !== null) {
                        const index = parseInt(selection) - 1;
                        if (index >= 0 && index < availableGuests.length) {
                            const untilDate = prompt('¿Hasta qué fecha? (YYYY-MM-DD)\nDeja vacío para reserva indefinida:');
                            await reserveBed(bedId, availableGuests[index].id, untilDate);
                        } else {
                            alert('Selección inválida');
                        }
                    }
                } catch (error) {
                    alert('Error al cargar huéspedes: ' + (error.message || 'Error desconocido'));
                }
            }

            // Reserve bed
            async function reserveBed(bedId, guestId, reservedUntil) {
                try {
                    await apiCall(`/beds/${bedId}/reserve`, 'POST', {
                        guest_id: guestId,
                        reserved_until: reservedUntil || null
                    });
                    refreshBeds();
                    showNotification('Cama reservada exitosamente', 'success');
                } catch (error) {
                    alert('Error al reservar: ' + (error.message || 'Error desconocido'));
                }
            }

            // Confirm reservation (convert to check-in)
            async function confirmReservation(bedId) {
                try {
                    const beds = await apiCall('/beds');
                    const bed = beds.find(b => b.id === bedId);

                    if (bed && bed.reserved_for_guest_id) {
                        await apiCall(`/beds/${bedId}/checkin`, 'POST', { guestId: bed.reserved_for_guest_id });
                        refreshBeds();
                        showNotification('Check-in realizado exitosamente', 'success');
                    } else {
                        alert('No hay huésped asociado a esta reserva');
                    }
                } catch (error) {
                    alert('Error al confirmar reserva: ' + (error.message || 'Error desconocido'));
                }
            }

            // Cancel reservation
            async function cancelReservation(bedId) {
                if (confirm('¿Cancelar esta reserva?')) {
                    try {
                        await apiCall(`/beds/${bedId}/reserve`, 'DELETE', { notes: 'Reservation cancelled by user' });
                        refreshBeds();
                        showNotification('Reserva cancelada', 'info');
                    } catch (error) {
                        alert('Error al cancelar: ' + (error.message || 'Error desconocido'));
                    }
                }
            }

            // Show transfer modal
            async function showTransferModal(fromBedId) {
                console.log('🔄 showTransferModal called with:', fromBedId);
                alert('Abriendo modal de transferencia para cama: ' + fromBedId);
                try {
                    const bedsByRoom = await apiCall('/beds/by-room');
                    let availableBeds = [];

                    Object.values(bedsByRoom).forEach(beds => {
                        beds.forEach(bed => {
                            if ((bed.status === 'clean' || bed.status === 'reserved') && bed.id !== fromBedId) {
                                availableBeds.push(bed);
                            }
                        });
                    });

                    if (availableBeds.length === 0) {
                        alert('No hay camas disponibles para transferir');
                        return;
                    }

                    const bedOptions = availableBeds.map((b, i) => `${i + 1}. ${b.name} (${b.room || 'Sin habitación'}) - $${b.price}`).join('\n');
                    const selection = prompt(`Selecciona la cama destino:\n\n${bedOptions}\n\nIngresa el número:`);

                    if (selection !== null) {
                        const index = parseInt(selection) - 1;
                        if (index >= 0 && index < availableBeds.length) {
                            await transferGuest(fromBedId, availableBeds[index].id);
                        } else {
                            alert('Selección inválida');
                        }
                    }
                } catch (error) {
                    alert('Error al cargar camas: ' + (error.message || 'Error desconocido'));
                }
            }

            // Transfer guest between beds
            async function transferGuest(fromBedId, toBedId) {
                try {
                    const result = await apiCall('/beds/transfer', 'POST', {
                        from_bed_id: fromBedId,
                        to_bed_id: toBedId,
                        notes: 'Guest transfer'
                    });
                    refreshBeds();
                    showNotification(`Huésped transferido a ${result.to_bed}`, 'success');
                } catch (error) {
                    alert('Error al transferir: ' + (error.message || 'Error desconocido'));
                }
            }

            // Show bed history
            async function showBedHistory(bedId) {
                try {
                    const response = await apiCall(`/beds/${bedId}/history`);
                    const { bed, history } = response;

                    let historyHtml = `
                        <div style="max-height: 400px; overflow-y: auto;">
                            <h3 style="margin-bottom: 15px;">Historial de ${bed.name}</h3>
                            <p style="color: #666; margin-bottom: 15px;">Estado actual: <strong style="color: ${getBedColor(bed.status)}">${getBedStatusText(bed.status)}</strong></p>
                    `;

                    if (history.length === 0) {
                        historyHtml += '<p style="color: #999; text-align: center;">No hay historial disponible</p>';
                    } else {
                        historyHtml += '<div style="border-left: 3px solid #3498db; padding-left: 15px;">';
                        history.forEach(entry => {
                            const date = new Date(entry.created_at).toLocaleString();
                            const actionText = getActionText(entry.action);
                            historyHtml += `
                                <div style="margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                                    <div style="font-weight: bold; color: #2c3e50;">${actionText}</div>
                                    <div style="font-size: 12px; color: #666;">${date}</div>
                                    ${entry.guest_name ? `<div style="font-size: 12px; color: #3498db;">Huésped: ${entry.guest_name}</div>` : ''}
                                    ${entry.notes ? `<div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">${entry.notes}</div>` : ''}
                                </div>
                            `;
                        });
                        historyHtml += '</div>';
                    }

                    historyHtml += '</div>';

                    // Show in a simple alert-like modal
                    const modal = document.createElement('div');
                    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;';
                    modal.innerHTML = `
                        <div style="background: white; border-radius: 15px; padding: 25px; max-width: 500px; width: 90%; max-height: 80vh; overflow: hidden;">
                            ${historyHtml}
                            <button onclick="this.closest('div').parentElement.remove()" style="margin-top: 15px; width: 100%; padding: 12px; background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                Cerrar
                            </button>
                        </div>
                    `;
                    document.body.appendChild(modal);
                } catch (error) {
                    alert('Error al cargar historial: ' + (error.message || 'Error desconocido'));
                }
            }

            // Get action text in Spanish
            function getActionText(action) {
                const actions = {
                    'checkin': '🏨 Check-in',
                    'checkout': '🚪 Check-out',
                    'cleaned': '✨ Limpieza completada',
                    'marked_dirty': '🧹 Marcada para limpieza',
                    'maintenance_start': '🔧 Inicio de mantenimiento',
                    'maintenance_end': '✅ Fin de mantenimiento',
                    'reserved': '📅 Reservada',
                    'reservation_cancelled': '❌ Reserva cancelada',
                    'transfer_in': '➡️ Transferencia entrada',
                    'transfer_out': '⬅️ Transferencia salida',
                    'notes_updated': '📝 Notas actualizadas',
                    'note': '📝 Nota agregada'
                };
                return actions[action] || action;
            }

            // Show bed notes
            function showBedNotes(bedId) {
                console.log('📝 showBedNotes called with:', bedId);
                alert('Mostrando notas para cama: ' + bedId);
                const bed = bedsDataCache[bedId];
                const currentNotes = bed ? bed.notes : '';
                const notes = prompt('Notas/Observaciones de la cama:', currentNotes || '');
                if (notes !== null) {
                    updateBedNotes(bedId, notes);
                }
            }

            // Update bed notes
            async function updateBedNotes(bedId, notes) {
                try {
                    await apiCall(`/beds/${bedId}/notes`, 'PUT', { notes });
                    refreshBeds();
                    showNotification('Notas actualizadas', 'success');
                } catch (error) {
                    alert('Error al actualizar notas: ' + (error.message || 'Error desconocido'));
                }
            }

            // Show notification
            function showNotification(message, type = 'info') {
                const colors = {
                    success: '#27ae60',
                    error: '#e74c3c',
                    warning: '#f39c12',
                    info: '#3498db'
                };

                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${colors[type] || colors.info};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
                    z-index: 10001;
                    animation: slideIn 0.3s ease;
                    font-weight: bold;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // ============= HUÉSPEDES FUNCTIONALITY =============
            let currentEditingGuest = null;

            async function refreshGuests() {
                try {
                    const [guestsResponse, statsResponse] = await Promise.all([
                        apiCall('/guests'),
                        apiCall('/guests/stats')
                    ]);

                    if (guestsResponse) {
                        renderGuestsList(guestsResponse);
                    }

                    if (statsResponse) {
                        updateGuestsStats(statsResponse);
                    }
                } catch (error) {
                    console.error('Error loading guests:', error);
                }
            }

            async function searchGuests() {
                const query = document.getElementById('guest-search').value.trim();

                // Si no hay búsqueda, cargar todos
                if (!query) {
                    await refreshGuests();
                    return;
                }

                try {
                    const response = await apiCall(`/guests/search?q=${encodeURIComponent(query)}`);
                    if (response) {
                        renderGuestsList(response);
                    }
                } catch (error) {
                    console.error('Error searching guests:', error);
                }
            }

            async function clearSearchAndLoadAll() {
                document.getElementById('guest-search').value = '';
                await refreshGuests();
            }

            function updateGuestsStats(stats) {
                document.getElementById('total-guests-count').textContent = stats.total_guests || 0;
                document.getElementById('staying-guests-count').textContent = stats.currently_staying || 0;
                document.getElementById('active-bookings-count').textContent = stats.active_bookings || 0;
            }

            function renderGuestsList(guests) {
                const container = document.getElementById('guests-container');

                if (!guests || guests.length === 0) {
                    container.innerHTML = `
                    <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 40px; text-align: center;">
                        <h3 style="color: #2c3e50; margin: 0 0 10px 0;">👥 No se encontraron huéspedes</h3>
                        <p style="color: #7f8c8d;">Intenta con otro término de búsqueda o agrega un nuevo huésped</p>
                    </div>
                `;
                    return;
                }

                container.innerHTML = `
                <div style="display: grid; gap: 20px;">
                    ${guests.map(guest => `
                        <div style="
                            background: ${getGuestCardBackground(guest)};
                            border-radius: 15px;
                            padding: 20px;
                            border: 2px solid ${getGuestBorderColor(guest)};
                            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                            backdrop-filter: blur(10px);
                            transition: all 0.3s ease;
                            position: relative;
                            overflow: hidden;
                        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 12px 35px rgba(0,0,0,0.4)'"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'">

                            <!-- Status indicator -->
                            <div style="position: absolute; top: 15px; right: 15px; width: 12px; height: 12px; border-radius: 50%; background: ${getGuestStatusColor(guest)}; box-shadow: 0 0 10px ${getGuestStatusColor(guest)};"></div>

                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center;">
                                <div>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                        <h3 style="color: #2c3e50; margin: 0; font-size: 20px; font-weight: bold;">👤 ${guest.name}</h3>
                                        ${guest.current_bed_name ? `<span style="background: linear-gradient(135deg, #e8f5e8, #d4ecd4); color: #27ae60; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">🛏️ ${guest.current_bed_name}</span>` : ''}
                                    </div>

                                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">🆔</span>
                                                <strong>Documento:</strong> ${guest.document}
                                            </p>
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">📧</span>
                                                <strong>Email:</strong> ${guest.email || 'No registrado'}
                                            </p>
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">📱</span>
                                                <strong>Teléfono:</strong> ${guest.phone || 'No registrado'}
                                            </p>
                                            ${guest.check_in ? `
                                                <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                    <span style="font-size: 14px;">📅</span>
                                                    <strong>Check-in:</strong> <span style="color: #3498db;">${new Date(guest.check_in).toLocaleDateString()}</span>
                                                </p>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>

                                <div style="display: flex; flex-direction: column; gap: 10px; align-items: end;">
                                    ${getGuestActions(guest)}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            }

            function getGuestCardBackground(guest) {
                if (guest.current_bed_name) {
                    return 'linear-gradient(135deg, rgba(39, 174, 96, 0.2), rgba(46, 204, 113, 0.1))';
                } else {
                    return 'linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.1))';
                }
            }

            function getGuestBorderColor(guest) {
                return guest.current_bed_name ? '#27ae60' : '#3498db';
            }

            function getGuestStatusColor(guest) {
                return guest.current_bed_name ? '#27ae60' : '#3498db';
            }

            function getGuestActions(guest) {
                const buttonBaseStyle = "padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); text-transform: uppercase; letter-spacing: 0.5px; min-width: 120px;";

                let actions = [];

                // Botón de ver detalles
                actions.push(`
                <button onclick="showGuestDetails(${guest.id})"
                        style="${buttonBaseStyle} background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #2c3e50;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(155, 89, 182, 0.4)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                    📋 Detalles
                </button>
            `);

                // Botón de editar
                actions.push(`
                <button onclick="showEditGuestModal(${guest.id})"
                        style="${buttonBaseStyle} background: linear-gradient(135deg, #f39c12, #e67e22); color: #2c3e50;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(243, 156, 18, 0.4)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                    ✏️ Editar
                </button>
            `);

                // Botón condicional según estado
                if (guest.current_bed_name) {
                    actions.push(`
                    <button onclick="startCheckout(${guest.current_bed_id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #e74c3c, #c0392b); color: #2c3e50;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(231, 76, 60, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                        🚪 Check-out
                    </button>
                `);
                } else {
                    actions.push(`
                    <button onclick="startCheckinFromGuestsView(${guest.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                        🏨 Check-in
                    </button>
                `);
                }

                // Botón de eliminar (solo si no está hospedado)
                if (!guest.current_bed_name) {
                    actions.push(`
                    <button onclick="deleteGuest(${guest.id})"
                            style="${buttonBaseStyle} background: linear-gradient(135deg, #e67e22, #d35400); color: #2c3e50; padding: 10px 12px; min-width: auto;"
                            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(230, 126, 34, 0.4)'"
                            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'"
                            title="Eliminar Huésped">
                        🗑️
                    </button>
                `);
                }

                return actions.join('');
            }

            // ============= POS FUNCTIONALITY =============
            let cart = [];
            let products = [];

            async function loadProducts() {
                try {
                    const response = await apiCall('/products');
                    if (response) {
                        products = response;
                        renderProducts(response);
                    }
                } catch (error) {
                    console.error('Error loading products:', error);
                }
            }

            function renderProducts(products) {
                const container = document.getElementById('products-grid');

                if (!products || products.length === 0) {
                    container.innerHTML = `
                    <div style="grid-column: 1/-1; background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 40px; text-align: center;">
                        <h3 style="color: #2c3e50; margin: 0 0 10px 0;">📦 No hay productos disponibles</h3>
                        <p style="color: #7f8c8d;">Agrega productos para comenzar a vender</p>
                        <button onclick="showAddProductModal()" style="margin-top: 15px; padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Agregar Producto
                        </button>
                    </div>
                `;
                    return;
                }

                // Group products by category
                const categories = {};
                products.forEach(product => {
                    if (!categories[product.category]) {
                        categories[product.category] = [];
                    }
                    categories[product.category].push(product);
                });

                let html = `
                <div style="grid-column: 1/-1; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin: 0;">📦 Productos Disponibles</h3>
                    <button onclick="showAddProductModal()" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-plus"></i> Nuevo Producto
                    </button>
                </div>
            `;

                Object.keys(categories).forEach(category => {
                    html += `
                    <div style="grid-column: 1/-1; color: #2c3e50; font-size: 18px; font-weight: bold; margin: 20px 0 10px 0; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 5px;">
                        ${getCategoryIcon(category)} ${category}
                    </div>
                `;

                    categories[category].forEach(product => {
                        const isOutOfStock = product.stock <= 0;
                        const isLowStock = product.stock <= 5 && product.stock > 0;
                        html += `
                        <div style="
                            background: ${isOutOfStock ? 'rgba(231, 76, 60, 0.2)' : isLowStock ? 'rgba(243, 156, 18, 0.2)' : 'linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05))'};
                            border-radius: 12px;
                            padding: 20px;
                            text-align: center;
                            border: 2px solid ${isOutOfStock ? '#e74c3c' : isLowStock ? '#f39c12' : 'rgba(255,255,255,0.2)'};
                            position: relative;
                            transition: all 0.3s ease;
                            ${isOutOfStock ? 'filter: grayscale(50%);' : ''}
                        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            ${isOutOfStock ? '<div style="position: absolute; top: 10px; right: 10px; background: #e74c3c; color: white; padding: 5px 8px; border-radius: 5px; font-size: 10px; font-weight: bold;">AGOTADO</div>' : ''}
                            ${isLowStock ? '<div style="position: absolute; top: 10px; right: 10px; background: #f39c12; color: white; padding: 5px 8px; border-radius: 5px; font-size: 10px; font-weight: bold;">POCO STOCK</div>' : ''}
                            <h3 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 16px;">${product.name}</h3>
                            <p style="color: ${isOutOfStock ? '#e74c3c' : '#27ae60'}; font-size: 20px; font-weight: bold; margin: 10px 0;">$${product.price.toLocaleString()}</p>
                            <p style="color: #7f8c8d; font-size: 12px; margin: 5px 0;">Stock: ${product.stock}</p>
                            <div style="display: flex; gap: 5px; margin-top: 15px;">
                                <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})"
                                        ${isOutOfStock ? 'disabled' : ''}
                                        style="flex: 1; padding: 8px; background: ${isOutOfStock ? '#95a5a6' : '#27ae60'}; color: #2c3e50; border: none; border-radius: 5px; cursor: ${isOutOfStock ? 'not-allowed' : 'pointer'}; font-size: 12px;">
                                    ${isOutOfStock ? '❌ Agotado' : '🛒 Agregar'}
                                </button>
                                <button onclick="showEditProductModal(${product.id})" style="padding: 8px 12px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                    ✏️
                                </button>
                                <button onclick="deleteProduct(${product.id})" style="padding: 8px 12px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 12px;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    `;
                    });
                });

                container.innerHTML = html;
            }

            function getCategoryIcon(category) {
                const icons = {
                    'Bebidas': '🥤',
                    'Comida': '🍽️',
                    'Snacks': '🍿',
                    'Otros': '📦'
                };
                return icons[category] || '📦';
            }

            function addToCart(id, name, price) {
                const product = products.find(p => p.id === id);
                if (!product || product.stock <= 0) {
                    alert('Producto agotado');
                    return;
                }

                const existingItem = cart.find(item => item.id === id);
                if (existingItem) {
                    if (existingItem.quantity >= product.stock) {
                        alert(`Solo hay ${product.stock} unidades disponibles`);
                        return;
                    }
                    existingItem.quantity += 1;
                } else {
                    cart.push({ id, name, price, quantity: 1, stock: product.stock });
                }
                updateCartDisplay();
            }

            function updateCartDisplay() {
                const container = document.getElementById('cart-items');
                const totalElement = document.getElementById('cart-total');

                if (cart.length === 0) {
                    container.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p style="color: #7f8c8d;">🛒 Carrito vacío</p>
                        <p style="color: #bdc3c7; font-size: 12px;">Agrega productos para comenzar</p>
                    </div>
                `;
                    totalElement.textContent = '0';
                    return;
                }

                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                container.innerHTML = cart.map(item => `
                <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 12px;
                    background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                    border-radius: 8px;
                    margin-bottom: 8px;
                    border: 1px solid rgba(255,255,255,0.2);
                ">
                    <div style="flex: 1;">
                        <div style="color: #2c3e50; font-weight: bold; font-size: 14px;">${item.name}</div>
                        <div style="color: #7f8c8d; font-size: 11px;">$${item.price.toLocaleString()} c/u</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <button onclick="removeFromCart(${item.id})" style="background: #e74c3c; color: white; border: none; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; font-size: 12px;">−</button>
                        <span style="color: #2c3e50; font-weight: bold; min-width: 20px; text-align: center;">${item.quantity}</span>
                        <button onclick="addToCart(${item.id}, '${item.name}', ${item.price})" style="background: #27ae60; color: white; border: none; border-radius: 4px; width: 24px; height: 24px; cursor: pointer; font-size: 12px;">+</button>
                        <div style="color: #27ae60; font-weight: bold; min-width: 60px; text-align: right; font-size: 13px;">$${(item.price * item.quantity).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');

                totalElement.textContent = total.toLocaleString();
            }

            function removeFromCart(id) {
                const itemIndex = cart.findIndex(item => item.id === id);
                if (itemIndex > -1) {
                    cart[itemIndex].quantity -= 1;
                    if (cart[itemIndex].quantity === 0) {
                        cart.splice(itemIndex, 1);
                    }
                    updateCartDisplay();
                }
            }

            function clearCart() {
                cart = [];
                updateCartDisplay();
            }

            async function processSale() {
                if (cart.length === 0) {
                    alert('El carrito está vacío');
                    return;
                }

                const paymentMethod = document.getElementById('payment-method').value;
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                try {
                    await apiCall('/pos/sale', 'POST', {
                        items: cart,
                        payment_method: paymentMethod,
                        total: total
                    });

                    cart = [];
                    updateCartDisplay();
                    loadProducts(); // Refresh to update stock
                } catch (error) {
                    console.error('Error processing sale:', error);
                    alert('Error al procesar la venta');
                }
            }

            function getPaymentMethodName(method) {
                const methods = {
                    'cash': 'Efectivo',
                    'card': 'Tarjeta',
                    'room': 'Cargar a Habitación'
                };
                return methods[method] || method;
            }

            // Product management functions
            function showAddProductModal() {
                document.getElementById('product-modal-title').textContent = 'Nuevo Producto';
                document.getElementById('product-form').reset();
                document.getElementById('product-form').removeAttribute('data-product-id');
                document.getElementById('product-modal').style.display = 'flex';
            }

            function showEditProductModal(productId) {
                const product = products.find(p => p.id === productId);
                if (!product) return;

                document.getElementById('product-modal-title').textContent = 'Editar Producto';
                document.getElementById('product-form').setAttribute('data-product-id', productId);

                document.getElementById('product-name').value = product.name;
                document.getElementById('product-price').value = product.price;
                document.getElementById('product-stock').value = product.stock;
                document.getElementById('product-category').value = product.category;

                document.getElementById('product-modal').style.display = 'flex';
            }

            function closeProductModal() {
                document.getElementById('product-modal').style.display = 'none';
                document.getElementById('product-form').reset();
            }

            async function deleteProduct(productId) {
                if (confirm('¿Estás seguro de que deseas eliminar este producto?')) {
                    try {
                        await apiCall(`/products/${productId}`, 'DELETE');
                        loadProducts();
                    } catch (error) {
                        console.error('Error deleting product:', error);
                        alert('Error al eliminar el producto');
                    }
                }
            }

            // ============= GUESTS FUNCTIONALITY =============
            function showAddGuestModal() {
                document.getElementById('guest-modal-title').textContent = 'Nuevo Huésped';
                document.getElementById('guest-form').reset();
                document.getElementById('guest-form').removeAttribute('data-guest-id');
                document.getElementById('guest-modal').style.display = 'flex';
            }

            function showEditGuestModal(guestId) {
                document.getElementById('guest-modal-title').textContent = 'Editar Huésped';
                document.getElementById('guest-form').setAttribute('data-guest-id', guestId);
                loadGuestForEdit(guestId);
                document.getElementById('guest-modal').style.display = 'flex';
            }

            async function loadGuestForEdit(guestId) {
                try {
                    const guest = await apiCall(`/guests/${guestId}`);
                    if (guest) {
                        document.getElementById('guest-name').value = guest.name || '';
                        document.getElementById('guest-document').value = guest.document || '';
                        document.getElementById('guest-email').value = guest.email || '';
                        document.getElementById('guest-phone').value = guest.phone || '';
                    }
                } catch (error) {
                    console.error('Error loading guest:', error);
                    alert('Error al cargar los datos del huésped');
                }
            }

            function closeGuestModal() {
                document.getElementById('guest-modal').style.display = 'none';
                document.getElementById('guest-form').reset();
            }

            function showGuestDetails(guestId) {
                loadGuestDetails(guestId);
                document.getElementById('guest-details-modal').style.display = 'flex';
            }

            async function loadGuestDetails(guestId) {
                try {
                    const guest = await apiCall(`/guests/${guestId}`);
                    if (guest) {
                        const content = document.getElementById('guest-details-content');
                        content.innerHTML = `
                        <div style="display: grid; gap: 20px;">
                            <!-- Información personal -->
                            <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; border-radius: 10px;">
                                <h3 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center;">
                                    <i class="fas fa-user" style="margin-right: 10px;"></i>
                                    Información Personal
                                </h3>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="color: #2c3e50; font-size: 12px; display: block;">Nombre Completo:</label>
                                        <div style="color: #2c3e50; font-weight: bold; font-size: 16px;">${guest.name}</div>
                                    </div>
                                    <div>
                                        <label style="color: #2c3e50; font-size: 12px; display: block;">Documento:</label>
                                        <div style="color: #2c3e50; font-weight: bold; font-size: 16px;">${guest.document}</div>
                                    </div>
                                    <div>
                                        <label style="color: #2c3e50; font-size: 12px; display: block;">Email:</label>
                                        <div style="color: #2c3e50; font-weight: bold; font-size: 16px;">${guest.email || 'No registrado'}</div>
                                    </div>
                                    <div>
                                        <label style="color: #2c3e50; font-size: 12px; display: block;">Teléfono:</label>
                                        <div style="color: #2c3e50; font-weight: bold; font-size: 16px;">${guest.phone || 'No registrado'}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Estadísticas -->
                            <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; border-radius: 10px;">
                                <h3 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center;">
                                    <i class="fas fa-chart-bar" style="margin-right: 10px;"></i>
                                    Estadísticas de Hospedaje
                                </h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px;">
                                    <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #e8f4fd, #d4e6f1); border-radius: 8px;">
                                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">0</div>
                                        <div style="color: #2c3e50; font-size: 12px;">Visitas</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #e8f5e8, #d4ecd4); border-radius: 8px;">
                                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">0</div>
                                        <div style="color: #2c3e50; font-size: 12px;">Noches</div>
                                    </div>
                                    <div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #fef3e2, #fce4b8); border-radius: 8px;">
                                        <div style="color: #2c3e50; font-size: 24px; font-weight: bold;">$0</div>
                                        <div style="color: #2c3e50; font-size: 12px;">Gastado</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Historial de reservas -->
                            <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); padding: 20px; border-radius: 10px;">
                                <h3 style="color: #2c3e50; margin-bottom: 15px; display: flex; align-items: center;">
                                    <i class="fas fa-history" style="margin-right: 10px;"></i>
                                    Historial de Reservas
                                </h3>
                                <div style="color: #2c3e50; text-align: center; padding: 20px;">
                                    <i class="fas fa-calendar-alt" style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;"></i>
                                    <p>No hay reservas registradas para este huésped</p>
                                </div>
                            </div>

                            <!-- Acciones -->
                            <div style="display: flex; gap: 10px;">
                                <button onclick="showEditGuestModal(${guest.id}); closeGuestDetailsModal();" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button onclick="confirmDeleteGuest(${guest.id})" style="flex: 1; padding: 12px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;">
                                    <i class="fas fa-trash"></i> Eliminar
                                </button>
                            </div>
                        </div>
                    `;
                    }
                } catch (error) {
                    console.error('Error loading guest details:', error);
                    alert('Error al cargar los detalles del huésped');
                }
            }

            function closeGuestDetailsModal() {
                document.getElementById('guest-details-modal').style.display = 'none';
            }

            async function deleteGuest(guestId) {
                try {
                    const result = await apiCall(`/guests/${guestId}`, 'DELETE');
                    if (result) {
                        closeGuestDetailsModal();
                        await refreshGuests();
                    }
                } catch (error) {
                    console.error('Error deleting guest:', error);
                    alert('Error al eliminar el huésped');
                }
            }

            function confirmDeleteGuest(guestId) {
                if (confirm('¿Estás seguro de que deseas eliminar este huésped? Esta acción no se puede deshacer.')) {
                    deleteGuest(guestId);
                }
            }

            // ============= GENERAL FUNCTIONALITY =============

            // ============= STAFF FUNCTIONALITY =============
            let staff = [];

            // Load current shift and stats when staff view is shown
            async function loadStaffViewData() {
                await loadCurrentShift();
                await loadStaffStatsSummary();
                await loadStaff();
            }

            async function loadCurrentShift() {
                const container = document.getElementById('current-shift-list');
                if (!container) return;

                try {
                    const response = await apiCall('/staff/attendance/today');
                    if (response && response.success && response.on_duty && response.on_duty.length > 0) {
                        container.innerHTML = response.on_duty.map(item => `
                            <p style="color: #2c3e50; margin: 5px 0;">
                                <span style="color: #27ae60;">●</span> ${item.staff_name || 'Sin nombre'}
                                <span style="color: #7f8c8d; font-size: 12px;">(${item.role || 'Sin rol'})</span>
                            </p>
                        `).join('');
                    } else {
                        container.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">No hay personal en turno actualmente</p>';
                    }
                } catch (error) {
                    console.error('Error loading current shift:', error);
                    container.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">No hay personal en turno</p>';
                }
            }

            async function loadStaffStatsSummary() {
                const container = document.getElementById('staff-stats-summary');
                if (!container) return;

                try {
                    const response = await apiCall('/staff/stats');
                    if (response && response.success && response.stats) {
                        const stats = response.stats;
                        container.innerHTML = `
                            <p style="color: #2c3e50; margin: 5px 0;"><strong>${stats.total_active || 0}</strong> empleados activos</p>
                            <p style="color: #2c3e50; margin: 5px 0;"><strong>${stats.on_duty_today || 0}</strong> en turno hoy</p>
                            <p style="color: #2c3e50; margin: 5px 0;"><strong>${stats.volunteers || 0}</strong> voluntarios</p>
                        `;
                    } else {
                        container.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">Sin datos disponibles</p>';
                    }
                } catch (error) {
                    console.error('Error loading staff stats:', error);
                    container.innerHTML = '<p style="color: #7f8c8d; font-style: italic;">Sin datos disponibles</p>';
                }
            }

            async function loadStaff() {
                try {
                    const response = await apiCall('/staff');
                    if (response) {
                        // Handle both formats: array directly or {success, staff: [...]}
                        const staffData = Array.isArray(response) ? response : (response.staff || []);
                        staff = staffData;
                        renderStaffList(staffData);
                    }
                } catch (error) {
                    console.error('Error loading staff:', error);
                }
            }

            function renderStaffList(staffList) {
                const container = document.getElementById('staff-list');

                if (!staffList || staffList.length === 0) {
                    container.innerHTML = `
                    <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 40px; text-align: center;">
                        <h3 style="color: #2c3e50; margin: 0 0 10px 0;">👨‍💼 No hay empleados registrados</h3>
                        <p style="color: #7f8c8d;">Agrega empleados para gestionar el personal</p>
                        <button onclick="showAddStaffModal()" style="margin-top: 15px; padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Agregar Empleado
                        </button>
                    </div>
                `;
                    return;
                }

                // Group staff by position
                const positions = {};
                staffList.forEach(member => {
                    if (!positions[member.position]) {
                        positions[member.position] = [];
                    }
                    positions[member.position].push(member);
                });

                let html = '';
                Object.keys(positions).forEach(position => {
                    html += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 15px; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 5px;">
                            ${getPositionIcon(position)} ${position}s
                        </h3>
                        <div style="display: grid; gap: 15px;">
                `;

                    positions[position].forEach(member => {
                        html += `
                        <div style="
                            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                            border-radius: 12px;
                            padding: 20px;
                            border: 2px solid rgba(255,255,255,0.2);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.3)'"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">

                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center;">
                                <div>
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap;">
                                        <h4 style="color: #2c3e50; margin: 0; font-size: 18px; font-weight: bold;">${member.name}</h4>
                                        <span style="background: linear-gradient(135deg, #e8f4fd, #d4e6f1); color: #3498db; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold;">${member.position}</span>
                                        ${member.is_volunteer ? `<span style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;">🤝 Voluntario</span>` : ''}
                                    </div>

                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;">
                                        ${member.phone ? `
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">📱</span>
                                                <strong>Teléfono:</strong> ${member.phone}
                                            </p>
                                        ` : ''}
                                        ${member.email ? `
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">📧</span>
                                                <strong>Email:</strong> ${member.email}
                                            </p>
                                        ` : ''}
                                        ${member.salary ? `
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">💰</span>
                                                <strong>Salario:</strong> $${member.salary.toLocaleString()}
                                            </p>
                                        ` : ''}
                                        ${member.schedule ? `
                                            <p style="color: #2c3e50; margin: 5px 0; display: flex; align-items: center; gap: 8px;">
                                                <span style="font-size: 14px;">⏰</span>
                                                <strong>Horario:</strong> ${member.schedule}
                                            </p>
                                        ` : ''}
                                    </div>
                                </div>

                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <button onclick="showEditStaffModal(${member.id})" style="padding: 8px 16px; background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold;">
                                        ✏️ Editar
                                    </button>
                                    <button onclick="deleteStaff(${member.id})" style="padding: 8px 16px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: bold;">
                                        🗑️ Eliminar
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    });

                    html += `
                        </div>
                    </div>
                `;
                });

                container.innerHTML = html;
            }

            function getPositionIcon(position) {
                const icons = {
                    'Recepcionista': '🏨',
                    'Limpieza': '🧹',
                    'Seguridad': '🛡️',
                    'Mantenimiento': '🔧',
                    'Gerente': '👔',
                    'Contador': '📊'
                };
                return icons[position] || '👤';
            }

            function showAddStaffModal() {
                document.getElementById('staff-modal-title').textContent = 'Nuevo Empleado';
                document.getElementById('staff-form').reset();
                document.getElementById('staff-form').removeAttribute('data-staff-id');
                // Reset volunteer mode for new staff
                toggleVolunteerMode(false);
                document.getElementById('staff-modal').style.display = 'flex';
            }

            function showEditStaffModal(staffId) {
                const member = staff.find(s => s.id === staffId);
                if (!member) return;

                document.getElementById('staff-modal-title').textContent = 'Editar Empleado';
                document.getElementById('staff-form').setAttribute('data-staff-id', staffId);

                document.getElementById('staff-name').value = member.name;
                document.getElementById('staff-position').value = member.position;
                document.getElementById('staff-phone').value = member.phone || '';
                document.getElementById('staff-email').value = member.email || '';
                document.getElementById('staff-salary').value = member.salary || '';
                document.getElementById('staff-schedule').value = member.schedule || '';

                // Load volunteer status and toggle salary visibility
                const isVolunteer = member.is_volunteer || false;
                toggleVolunteerMode(isVolunteer);

                document.getElementById('staff-modal').style.display = 'flex';
            }

            function closeStaffModal() {
                document.getElementById('staff-modal').style.display = 'none';
                document.getElementById('staff-form').reset();
                // Reset volunteer mode when closing
                toggleVolunteerMode(false);
            }

            function toggleVolunteerMode(isVolunteer) {
                const salaryContainer = document.getElementById('staff-salary-container');
                const salaryInput = document.getElementById('staff-salary');
                const checkbox = document.getElementById('staff-is-volunteer');

                if (isVolunteer) {
                    salaryContainer.style.display = 'none';
                    salaryInput.value = '';
                    salaryInput.required = false;
                } else {
                    salaryContainer.style.display = 'grid';
                    salaryInput.required = false;
                }

                // Sync checkbox state
                if (checkbox) {
                    checkbox.checked = isVolunteer;
                }
            }

            async function deleteStaff(staffId) {
                if (confirm('¿Estás seguro de que deseas eliminar este empleado?')) {
                    try {
                        await apiCall(`/staff/${staffId}`, 'DELETE');
                        showNotification('Empleado eliminado exitosamente', 'success');
                        loadStaff();
                    } catch (error) {
                        console.error('Error deleting staff:', error);
                        showNotification('Error al eliminar el empleado', 'error');
                    }
                }
            }

            // ============= USERS FUNCTIONALITY =============
            async function loadUsers() {
                try {
                    const users = await apiCall('/users');
                    if (users) {
                        renderUsersTable(users);
                    }
                } catch (error) {
                    console.error('Error loading users:', error);
                    document.getElementById('users-list').innerHTML = `
                        <p style="color: #e74c3c; text-align: center; padding: 20px;">
                            Error al cargar usuarios. Asegúrate de tener permisos de administrador.
                        </p>
                    `;
                }
            }

            function renderUsersTable(users) {
                const container = document.getElementById('users-list');

                if (!users || users.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #95a5a6;">No hay usuarios registrados</p>';
                    return;
                }

                container.innerHTML = `
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: #ecf0f1; border-bottom: 2px solid #3498db;">
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Usuario</th>
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Nombre</th>
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Email</th>
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Rol</th>
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Estado</th>
                                <th style="padding: 12px; text-align: left; color: #2c3e50;">Último Login</th>
                                <th style="padding: 12px; text-align: center; color: #2c3e50;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr style="border-bottom: 1px solid #ecf0f1;">
                                    <td style="padding: 12px; color: #2c3e50;">${user.username}</td>
                                    <td style="padding: 12px; color: #2c3e50;">${user.name || '-'}</td>
                                    <td style="padding: 12px; color: #2c3e50;">${user.email || '-'}</td>
                                    <td style="padding: 12px; color: #2c3e50;">
                                        <span style="padding: 4px 8px; border-radius: 4px; background: ${user.role === 'administrador' ? '#3498db' : user.role === 'recepcionista' ? '#27ae60' : '#95a5a6'}; color: white; font-size: 12px;">
                                            ${user.role}
                                        </span>
                                    </td>
                                    <td style="padding: 12px; color: #2c3e50;">
                                        <span style="color: ${user.is_active ? '#27ae60' : '#e74c3c'};">
                                            ${user.is_active ? '✓ Activo' : '✗ Inactivo'}
                                        </span>
                                    </td>
                                    <td style="padding: 12px; color: #95a5a6; font-size: 12px;">
                                        ${user.last_login ? new Date(user.last_login).toLocaleString('es-CO') : 'Nunca'}
                                    </td>
                                    <td style="padding: 12px; text-align: center;">
                                        <button onclick="editUser(${user.id})" style="padding: 6px 12px; background: #f39c12; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }

            function showAddUserModal() {
                showNotification('Función para crear nuevo usuario - En desarrollo', 'info');
            }

            function editUser(userId) {
                showNotification('Función para editar usuario - En desarrollo', 'info');
            }

            // ============= TOURS FUNCTIONALITY =============
            let tours = [];
            let tourStats = {};

            async function loadTours() {
                try {
                    const [toursResponse, statsResponse] = await Promise.all([
                        apiCall('/tours'),
                        apiCall('/tours/stats')
                    ]);

                    if (toursResponse) {
                        tours = toursResponse;
                        renderToursCatalog(toursResponse);
                    }

                    if (statsResponse) {
                        tourStats = statsResponse;
                        updateToursStats(statsResponse);
                    }
                } catch (error) {
                    console.error('Error loading tours:', error);
                }
            }

            function updateToursStats(stats) {
                document.getElementById('total-tours-count').textContent = stats.total_tours || 0;
                document.getElementById('total-clicks-count').textContent = stats.total_clicks || 0;
                document.getElementById('total-commissions').textContent = `$${stats.total_commissions?.toLocaleString() || 0}`;

                const conversionRate = stats.total_clicks > 0 ? ((stats.total_commissions / stats.total_clicks) * 100).toFixed(1) : 0;
                document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
            }

            function renderToursCatalog(toursList) {
                const container = document.getElementById('all-tours');

                if (!toursList || toursList.length === 0) {
                    container.innerHTML = `
                    <div style="grid-column: 1/-1; background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 40px; text-align: center;">
                        <h3 style="color: #2c3e50; margin: 0 0 10px 0;">🗺️ No hay tours disponibles</h3>
                        <p style="color: #7f8c8d;">Agrega tours para ofrecer a tus huéspedes</p>
                        <button onclick="showAddTourModal()" style="margin-top: 15px; padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-plus"></i> Agregar Tour
                        </button>
                    </div>
                `;
                    return;
                }

                container.innerHTML = toursList.map(tour => {
                    const images = JSON.parse(tour.images || '[]');
                    return `
                    <div style="
                        background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
                        border-radius: 15px;
                        overflow: hidden;
                        border: 2px solid rgba(255,255,255,0.2);
                        transition: all 0.3s ease;
                        position: relative;
                    " onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 12px 35px rgba(0,0,0,0.4)'"
                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">

                        <!-- Tour image placeholder -->
                        <div style="height: 180px; background: linear-gradient(135deg, #667eea, #764ba2); position: relative; display: flex; align-items: center; justify-content: center;">
                            <div style="color: #2c3e50; font-size: 48px;">🏞️</div>
                            <div style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                                ${tour.duration}
                            </div>
                            <div style="position: absolute; bottom: 10px; left: 10px; background: rgba(39, 174, 96, 0.9); color: #2c3e50; padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
                                ${tour.commission_rate}% comisión
                            </div>
                        </div>

                        <div style="padding: 20px;">
                            <h3 style="color: #2c3e50; margin: 0 0 10px 0; font-size: 18px; font-weight: bold;">${tour.name}</h3>
                            <p style="color: #2c3e50; font-size: 14px; margin: 10px 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                                ${tour.description}
                            </p>

                            <div style="display: flex; justify-content: space-between; align-items: center; margin: 15px 0;">
                                <div>
                                    <div style="color: #27ae60; font-size: 20px; font-weight: bold;">$${tour.price.toLocaleString()}</div>
                                    <div style="color: #95a5a6; font-size: 12px;">Por persona</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #2c3e50; font-size: 14px; font-weight: 600; font-weight: bold;">${tour.clicks || 0} clicks</div>
                                    <div style="color: #95a5a6; font-size: 12px;">Proveedor: ${tour.provider}</div>
                                </div>
                            </div>

                            <div style="display: flex; gap: 8px; margin-top: 15px;">
                                <button onclick="trackTourClick(${tour.id})" style="flex: 1; padding: 10px; background: linear-gradient(135deg, #3498db, #2980b9); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: bold;">
                                    🔗 Reservar Tour
                                </button>
                                <button onclick="showEditTourModal(${tour.id})" style="padding: 10px 12px; background: linear-gradient(135deg, #f39c12, #e67e22); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
                                    ✏️
                                </button>
                                <button onclick="deleteTour(${tour.id})" style="padding: 10px 12px; background: linear-gradient(135deg, #e74c3c, #c0392b); color: #2c3e50; border: none; border-radius: 8px; cursor: pointer; font-size: 12px;">
                                    🗑️
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            }

            async function trackTourClick(tourId) {
                try {
                    const tour = tours.find(t => t.id === tourId);
                    if (!tour) return;

                    // Track the click
                    await apiCall(`/tours/${tourId}/click`, 'POST', {
                        guest_id: null // Could be enhanced to track which guest clicked
                    });

                    // Open the booking URL in a new window
                    if (tour.booking_url) {
                        window.open(tour.booking_url, '_blank');
                        showNotification(`Click registrado - ${tour.name} (${tour.commission_rate}% comisión)`, 'success');
                        loadTours();
                    } else {
                        showNotification('URL de reserva no configurada para este tour', 'warning');
                    }
                } catch (error) {
                    console.error('Error tracking tour click:', error);
                    showNotification('Error al registrar el click', 'error');
                }
            }

            function showAddTourModal() {
                document.getElementById('tour-modal-title').textContent = 'Nuevo Tour';
                document.getElementById('tour-form').reset();
                document.getElementById('tour-form').removeAttribute('data-tour-id');
                document.getElementById('tour-modal').style.display = 'flex';
            }

            function showEditTourModal(tourId) {
                const tour = tours.find(t => t.id === tourId);
                if (!tour) return;

                document.getElementById('tour-modal-title').textContent = 'Editar Tour';
                document.getElementById('tour-form').setAttribute('data-tour-id', tourId);

                document.getElementById('tour-name').value = tour.name;
                document.getElementById('tour-description').value = tour.description;
                document.getElementById('tour-price').value = tour.price;
                document.getElementById('tour-duration').value = tour.duration;
                document.getElementById('tour-provider').value = tour.provider;
                document.getElementById('tour-commission').value = tour.commission_rate;
                document.getElementById('tour-url').value = tour.booking_url;

                document.getElementById('tour-modal').style.display = 'flex';
            }

            function closeTourModal() {
                document.getElementById('tour-modal').style.display = 'none';
                document.getElementById('tour-form').reset();
            }

            async function deleteTour(tourId) {
                if (confirm('¿Estás seguro de que deseas eliminar este tour?')) {
                    try {
                        await apiCall(`/tours/${tourId}`, 'DELETE');
                        showNotification('Tour eliminado exitosamente', 'success');
                        loadTours();
                    } catch (error) {
                        console.error('Error deleting tour:', error);
                        showNotification('Error al eliminar el tour', 'error');
                    }
                }
            }

            function showCashMovementModal() {
                document.getElementById('cash-modal').style.display = 'flex';
                document.getElementById('cash-form').reset();
            }

            function closeCashModal() {
                document.getElementById('cash-modal').style.display = 'none';
            }

            async function submitCashMovement(event) {
                event.preventDefault();
                try {
                    const data = {
                        type: document.getElementById('cash-type').value,
                        category: document.getElementById('cash-category').value,
                        amount: parseFloat(document.getElementById('cash-amount').value),
                        payment_method: document.getElementById('cash-method').value,
                        description: document.getElementById('cash-description').value || ''
                    };

                    await apiCall('/cashbox/transactions', 'POST', data);
                    closeCashModal();
                    await loadCashData();
                } catch (error) {
                    console.error('Error creating transaction:', error);
                    alert('Error al registrar el movimiento: ' + (error.message || 'Error desconocido'));
                }
            }

            async function loadCashData() {
                try {
                    const [stats, transactions] = await Promise.all([
                        apiCall('/cashbox/stats'),
                        apiCall('/cashbox/transactions?limit=20')
                    ]);

                    // Update summary cards
                    const cashCards = document.querySelectorAll('#cash-view > div:nth-child(2) > div');
                    if (cashCards.length >= 3 && stats) {
                        const todayStats = stats.today || {};
                        cashCards[0].querySelector('div:last-child').textContent = '$' + (todayStats.cash_total || 0).toFixed(2);
                        cashCards[1].querySelector('div:last-child').textContent = '$' + (todayStats.card_total || 0).toFixed(2);
                        cashCards[2].querySelector('div:last-child').textContent = '$' + (todayStats.total || 0).toFixed(2);
                    }

                    // Update movements list
                    const listContainer = document.getElementById('cash-movements-list');
                    if (transactions && transactions.length > 0) {
                        listContainer.innerHTML = transactions.map(t => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #ecf0f1;">
                                <div>
                                    <div style="font-weight: bold; color: #2c3e50;">${t.description || t.category || 'Sin descripción'}</div>
                                    <div style="font-size: 12px; color: #7f8c8d;">${new Date(t.created_at).toLocaleString()} - ${t.payment_method === 'cash' ? '💵 Efectivo' : t.payment_method === 'card' ? '💳 Tarjeta' : '🏦 Transferencia'}</div>
                                </div>
                                <div style="font-weight: bold; color: ${t.type === 'income' ? '#27ae60' : '#e74c3c'}; font-size: 18px;">
                                    ${t.type === 'income' ? '+' : '-'}$${parseFloat(t.amount).toFixed(2)}
                                </div>
                            </div>
                        `).join('');
                    } else {
                        listContainer.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;">No hay movimientos registrados hoy</p>';
                    }
                } catch (error) {
                    console.error('Error loading cash data:', error);
                }
            }

            function startCheckinFromGuestsView(guestId) {
                // Desde la vista de huéspedes: guardar el huésped y ir a camas
                localStorage.setItem('selectedGuestForCheckin', guestId);
                showView('beds');
                // No mostrar alert - la UI indica visualmente qué hacer
            }

            async function startCheckin(bedId, preselectedGuestId = null) {
                console.log('🛏️ startCheckin called with:', bedId, preselectedGuestId);
                try {
                    if (preselectedGuestId) {
                        // Hacer check-in directo con huésped preseleccionado
                        await processCheckin(bedId, preselectedGuestId);
                    } else {
                        // Mostrar modal para seleccionar huésped
                        await showGuestSelectionForCheckin(bedId);
                    }
                } catch (error) {
                    console.error('Error starting checkin:', error);
                    alert('Error al iniciar el check-in');
                }
            }

            async function showGuestSelectionForCheckin(bedId) {
                try {
                    const guests = await apiCall('/guests');
                    // Filtrar solo huéspedes que no estén actualmente hospedados
                    const availableGuests = guests.filter(guest => !guest.current_bed_name);

                    if (availableGuests.length === 0) {
                        alert('No hay huéspedes disponibles para check-in. Primero registra un huésped.');
                        return;
                    }

                    const guestOptions = availableGuests.map(guest =>
                        `${guest.name} (${guest.document})`
                    ).join('\n');

                    const selectedIndex = prompt(`Selecciona un huésped para el check-in en la cama ${bedId}:\n\n${availableGuests.map((guest, index) =>
                        `${index + 1}. ${guest.name} (${guest.document})`
                    ).join('\n')}\n\nIngresa el número del huésped:`);

                    if (selectedIndex && selectedIndex > 0 && selectedIndex <= availableGuests.length) {
                        const selectedGuest = availableGuests[selectedIndex - 1];
                        await processCheckin(bedId, selectedGuest.id);
                    }
                } catch (error) {
                    console.error('Error showing guest selection:', error);
                    alert('Error al cargar los huéspedes disponibles');
                }
            }

            async function processCheckin(bedId, guestId) {
                try {
                    const result = await apiCall(`/beds/${bedId}/checkin`, 'POST', { guestId });
                    if (result) {
                        localStorage.removeItem('selectedGuestForCheckin');
                        await refreshBeds();
                        await refreshGuests();
                    }
                } catch (error) {
                    console.error('Error processing checkin:', error);
                    alert('Error al procesar el check-in: ' + (error.message || 'Error desconocido'));
                }
            }

            async function startCheckout(bedId) {
                console.log('🚪 startCheckout called with:', bedId);
                if (confirm('¿Estás seguro de que deseas hacer check-out de esta cama?')) {
                    try {
                        const result = await apiCall(`/beds/${bedId}/checkout`, 'POST');
                        if (result) {
                            await refreshBeds();
                            await refreshGuests();
                        }
                    } catch (error) {
                        console.error('Error processing checkout:', error);
                        alert('Error al procesar el check-out: ' + (error.message || 'Error desconocido'));
                    }
                }
            }

            // Verificar si hay un huésped preseleccionado para check-in cuando se carga la vista de camas
            function checkPreselectedGuest() {
                const selectedGuestId = localStorage.getItem('selectedGuestForCheckin');
                if (selectedGuestId) {
                    // Mostrar notificación sutil en lugar de alert molesto
                    const notification = document.createElement('div');
                    notification.id = 'preselected-guest-notification';
                    notification.innerHTML = `
                        <div style="background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px 20px; border-radius: 8px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);">
                            <span>👤 Huésped seleccionado. Haz clic en <strong>Check-in</strong> en una cama disponible.</span>
                            <button onclick="cancelPreselectedGuest()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer;">✕ Cancelar</button>
                        </div>
                    `;
                    const container = document.getElementById('rooms-container');
                    if (container && !document.getElementById('preselected-guest-notification')) {
                        container.parentNode.insertBefore(notification, container);
                    }
                }
            }

            function cancelPreselectedGuest() {
                localStorage.removeItem('selectedGuestForCheckin');
                const notification = document.getElementById('preselected-guest-notification');
                if (notification) notification.remove();
                refreshBeds();
            }

            // ============= ANALYTICS & REPORTS FUNCTIONALITY =============
            let currentReportData = null;

            async function refreshReports() {
                console.log('📈 Cargando sistema de reportes y análisis...');
                initializeReportDates();
                await generateAnalyticsReport();
            }

            function initializeReportDates() {
                const today = new Date();
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(today.getDate() - 30);

                document.getElementById('reportEndDate').value = today.toISOString().split('T')[0];
                document.getElementById('reportStartDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            }

            function selectReportPeriod(btn, days) {
                // Remove active class from all buttons
                document.querySelectorAll('.date-btn').forEach(b => b.classList.remove('report-active'));

                // Add active class to clicked button
                btn.classList.add('report-active');

                // Calculate dates
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(endDate.getDate() - days);

                // Update date inputs
                document.getElementById('reportEndDate').value = endDate.toISOString().split('T')[0];
                document.getElementById('reportStartDate').value = startDate.toISOString().split('T')[0];

                // Auto-generate report
                generateAnalyticsReport();
            }

            async function generateAnalyticsReport() {
                const startDate = document.getElementById('reportStartDate').value;
                const endDate = document.getElementById('reportEndDate').value;
                const reportType = document.getElementById('reportType').value;

                if (!startDate || !endDate) {
                    alert('Por favor selecciona fechas de inicio y fin');
                    return;
                }

                try {
                    console.log(`📊 Generando reporte ${reportType} del ${startDate} al ${endDate}`);

                    // Add loading effect
                    const reportContent = document.getElementById('reportContent');
                    reportContent.style.opacity = '0.5';

                    // Fetch comprehensive analytics data
                    const reportData = await apiCall(`/reports?start=${startDate}&end=${endDate}&type=${reportType}`);

                    if (reportData) {
                        currentReportData = reportData;
                        updateReportPeriodBadge(startDate, endDate);
                        updateKPIs(reportData);
                        updateCharts(reportData);
                        updateTopPerformers(reportData);
                        updateAdditionalAnalytics(reportData);
                    }

                    reportContent.style.opacity = '1';

                    // Add animation to KPI cards
                    document.querySelectorAll('[id^="kpi"]').forEach((card, index) => {
                        setTimeout(() => {
                            card.style.transform = 'scale(1.02)';
                            setTimeout(() => {
                                card.style.transform = 'scale(1)';
                            }, 200);
                        }, index * 100);
                    });

                    console.log('📊 Reporte generado exitosamente');

                } catch (error) {
                    console.error('Error generando reporte:', error);
                    showNotification('Error al generar el reporte. Por favor intenta nuevamente.', 'error');
                    document.getElementById('reportContent').style.opacity = '1';
                }
            }

            function updateReportPeriodBadge(startDate, endDate) {
                const start = new Date(startDate).toLocaleDateString('es-ES');
                const end = new Date(endDate).toLocaleDateString('es-ES');
                const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24));

                document.getElementById('reportPeriodBadge').textContent = `${start} al ${end} (${days} días)`;
            }

            function updateKPIs(data) {
                // Update Revenue KPI
                const totalRevenue = (data.totalRevenue?.bookingRevenue || 0) + (data.totalRevenue?.posRevenue || 0);
                const dailyAvg = data.totalBookings?.count > 0 ? totalRevenue / data.totalBookings.count : 0;

                const revenueCard = document.getElementById('kpiRevenue');
                revenueCard.querySelector('div:first-child').textContent = `$${totalRevenue.toLocaleString()}`;
                revenueCard.querySelector('div:last-child').textContent = `Promedio diario: $${dailyAvg.toFixed(0)}`;

                // Update Occupancy KPI
                const occupancyRate = data.occupancyData?.avgOccupancy || 0;
                const totalNights = data.totalBookings?.totalNights || 0;

                const occupancyCard = document.getElementById('kpiOccupancy');
                occupancyCard.querySelector('div:first-child').textContent = `${occupancyRate.toFixed(1)}%`;
                occupancyCard.querySelector('div:last-child').textContent = `${totalNights} noches vendidas`;

                // Update Guests KPI
                const totalGuests = data.totalGuests?.uniqueGuests || 0;
                const returningGuests = data.totalGuests?.returningGuests || 0;

                const guestsCard = document.getElementById('kpiGuests');
                guestsCard.querySelector('div:first-child').textContent = totalGuests;
                guestsCard.querySelector('div:last-child').textContent = `${returningGuests} huéspedes recurrentes`;

                // Update Average Rate KPI
                const avgRate = data.totalBookings?.avgRate || 0;

                const rateCard = document.getElementById('kpiRate');
                rateCard.querySelector('div:first-child').textContent = `$${avgRate.toFixed(0)}`;
            }

            function updateCharts(data) {
                // Update Revenue Chart
                const revenueChart = document.getElementById('revenueChart');
                const weeklyRevenue = data.weeklyRevenue || [];

                revenueChart.innerHTML = '';
                weeklyRevenue.forEach((week, index) => {
                    const height = Math.max(20, (week.revenue / Math.max(...weeklyRevenue.map(w => w.revenue))) * 180);
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar revenue-bar';
                    bar.style.width = '50px';
                    bar.style.height = `${height}px`;
                    bar.textContent = `$${(week.revenue / 1000).toFixed(1)}K`;
                    bar.title = `Semana ${index + 1}: $${week.revenue.toLocaleString()}`;
                    revenueChart.appendChild(bar);
                });

                // Update Occupancy Chart
                const occupancyChart = document.getElementById('occupancyChart');
                const dailyOccupancy = data.dailyOccupancy || [];

                occupancyChart.innerHTML = '';
                dailyOccupancy.slice(-7).forEach((day) => {
                    const height = Math.max(20, (day.occupancy / 100) * 180);
                    const bar = document.createElement('div');
                    bar.className = 'chart-bar occupancy-bar';

                    if (day.occupancy >= 80) {
                        bar.classList.add('occupancy-high');
                    } else if (day.occupancy >= 60) {
                        bar.classList.add('occupancy-medium');
                    } else {
                        bar.classList.add('occupancy-low');
                    }

                    bar.style.height = `${height}px`;
                    bar.title = `${day.date}: ${day.occupancy.toFixed(1)}%`;
                    occupancyChart.appendChild(bar);
                });
            }

            function updateTopPerformers(data) {
                // Top Guests
                const topGuests = data.topGuests || [];
                const topGuestsContainer = document.getElementById('topGuests');

                topGuestsContainer.innerHTML = topGuests.map(guest => `
                <div class="top-list-item">
                    <span class="item-name">${guest.name}</span>
                    <span class="item-value value-nights">${guest.nights} noches</span>
                </div>
            `).join('');

                // Top Products
                const topProducts = data.topProducts || [];
                const topProductsContainer = document.getElementById('topProducts');

                topProductsContainer.innerHTML = topProducts.map(product => `
                <div class="top-list-item">
                    <span class="item-name">${product.name}</span>
                    <span class="item-value value-sales">${product.quantity} vendidos</span>
                </div>
            `).join('');
            }

            function updateAdditionalAnalytics(data) {
                // Weekend Occupancy
                const weekendOccupancy = data.additionalMetrics?.weekendOccupancy || 0;
                const weekendCard = document.getElementById('weekendOccupancy');
                weekendCard.querySelector('div:first-child').textContent = `${weekendOccupancy.toFixed(1)}%`;

                // Average Stay
                const avgStay = data.additionalMetrics?.avgStayDuration || 0;
                const stayCard = document.getElementById('avgStay');
                stayCard.querySelector('div:first-child').textContent = `${avgStay.toFixed(1)} días`;

                // Returning Guests Rate
                const returningRate = data.additionalMetrics?.returningGuestRate || 0;
                const returningCard = document.getElementById('returningGuests');
                returningCard.querySelector('div:first-child').textContent = `${returningRate.toFixed(1)}%`;

                // POS Revenue
                const posRevenue = data.totalRevenue?.posRevenue || 0;
                const totalRevenue = (data.totalRevenue?.bookingRevenue || 0) + posRevenue;
                const posPercentage = totalRevenue > 0 ? (posRevenue / totalRevenue) * 100 : 0;

                const posCard = document.getElementById('posRevenue');
                posCard.querySelector('div:first-child').textContent = `$${posRevenue.toLocaleString()}`;
                posCard.querySelector('div:last-child').textContent = `${posPercentage.toFixed(1)}% del total`;
            }

            async function exportAnalyticsReport() {
                if (!currentReportData) {
                    showNotification('Primero genera un reporte para poder exportar', 'info');
                    return;
                }

                try {
                    const startDate = document.getElementById('reportStartDate').value;
                    const endDate = document.getElementById('reportEndDate').value;
                    const reportType = document.getElementById('reportType').value;

                    const exportData = {
                        period: {
                            start: startDate,
                            end: endDate,
                            type: reportType
                        },
                        data: currentReportData,
                        generated: new Date().toISOString(),
                        generatedBy: 'Hostel PMS'
                    };

                    const dataStr = JSON.stringify(exportData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `almanik-report-${startDate}-to-${endDate}.json`;
                    link.click();

                    console.log('📥 Reporte exportado exitosamente');
                    showNotification('Reporte exportado exitosamente', 'success');

                } catch (error) {
                    console.error('Error exportando reporte:', error);
                    showNotification('Error al exportar el reporte', 'error');
                }
            }

            // ============= PASEOS FUNCTIONALITY (LEGACY - REPLACED BY API) =============
            // NOTE: This function is commented out because it uses hardcoded data
            // The real loadTours() function (line ~3885) loads data from API
            /*
            function loadTours() {
                const todayTours = [
                    { id: 1, name: 'City Walking Tour', time: '09:00', duration: '3h', price: 25, participants: 6, guide: 'Carlos' },
                    { id: 2, name: 'Mercado Central', time: '14:00', duration: '2h', price: 15, participants: 4, guide: 'Ana' },
                    { id: 3, name: 'Sunset Viewpoint', time: '17:30', duration: '2h', price: 20, participants: 8, guide: 'Luis' }
                ];

                const allTours = [
                    { id: 1, name: 'City Walking Tour', duration: '3h', price: 25, description: 'Tour por el centro histórico' },
                    { id: 2, name: 'Mercado Central', duration: '2h', price: 15, description: 'Visita al mercado local' },
                    { id: 3, name: 'Sunset Viewpoint', duration: '2h', price: 20, description: 'Mirador para ver el atardecer' },
                    { id: 4, name: 'Beach Day', duration: '6h', price: 35, description: 'Día completo en la playa' },
                    { id: 5, name: 'Mountain Hike', duration: '4h', price: 30, description: 'Caminata en montaña' }
                ];

                renderTodayTours(todayTours);
                renderAllTours(allTours);
                renderTourBookings();
            }
            */

            function renderTodayTours(tours) {
                const container = document.getElementById('today-tours');
                if (!container) {
                    console.warn('today-tours container not found - skipping render');
                    return;
                }
                container.innerHTML = tours.map(tour => `
                <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 15px; border-left: 4px solid #3498db;">
                    <h3 style="color: #2c3e50; margin: 0 0 10px 0;">🚶 ${tour.name}</h3>
                    <p style="color: #2c3e50; margin: 5px 0;">⏰ ${tour.time} (${tour.duration})</p>
                    <p style="color: #2c3e50; margin: 5px 0;">👥 ${tour.participants} participantes</p>
                    <p style="color: #2c3e50; margin: 5px 0;">🧑‍🏫 Guía: ${tour.guide}</p>
                    <p style="color: #2c3e50; margin: 10px 0;">💰 $${tour.price}/persona</p>
                    <button onclick="manageTour(${tour.id})" style="width: 100%; padding: 8px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Gestionar
                    </button>
                </div>
            `).join('');
            }

            function renderAllTours(tours) {
                const container = document.getElementById('all-tours');
                container.innerHTML = tours.map(tour => `
                <div style="background: rgba(255,255,255,0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border-radius: 10px; padding: 15px;">
                    <h3 style="color: #2c3e50; margin: 0 0 10px 0;">🗺️ ${tour.name}</h3>
                    <p style="color: #2c3e50; margin: 5px 0;">${tour.description}</p>
                    <p style="color: #2c3e50; margin: 5px 0;">⏱️ Duración: ${tour.duration}</p>
                    <p style="color: #2c3e50; margin: 10px 0; font-weight: bold;">💰 $${tour.price}/persona</p>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="bookTour(${tour.id})" style="flex: 1; padding: 8px; background: #9b59b6; color: #2c3e50; border: none; border-radius: 5px; cursor: pointer;">
                            Reservar
                        </button>
                        <button onclick="editTour(${tour.id})" style="flex: 1; padding: 8px; background: #f39c12; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Editar
                        </button>
                    </div>
                </div>
            `).join('');
            }

            function renderTourBookings() {
                const container = document.getElementById('tour-bookings');
                if (!container) return;

                // Show empty state - bookings are tracked via tour clicks
                container.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #7f8c8d;">
                    <p style="font-size: 40px; margin: 0 0 10px 0;">📊</p>
                    <p style="margin: 0;">Las reservas se registran mediante clicks en los tours</p>
                    <p style="margin: 5px 0 0 0; font-size: 12px;">Los clicks quedan registrados para calcular comisiones</p>
                </div>
            `;
            }

            function showAddTourModal() {
                document.getElementById('tour-modal').style.display = 'flex';
                document.getElementById('tour-modal-title').textContent = '🚶 Nuevo Paseo';
                document.getElementById('tour-form').reset();
                document.getElementById('tour-id').value = '';
            }

            function closeTourModal() {
                document.getElementById('tour-modal').style.display = 'none';
            }

            async function submitTour(event) {
                event.preventDefault();
                try {
                    const tourId = document.getElementById('tour-id').value;
                    const data = {
                        name: document.getElementById('tour-name').value,
                        description: document.getElementById('tour-description').value || '',
                        price: parseFloat(document.getElementById('tour-price').value),
                        commission_rate: parseInt(document.getElementById('tour-commission').value) || 15,
                        provider: document.getElementById('tour-provider').value || '',
                        duration: document.getElementById('tour-duration').value || ''
                    };

                    if (tourId) {
                        await apiCall(`/tours/${tourId}`, 'PUT', data);
                        showNotification('Paseo actualizado exitosamente', 'success');
                    } else {
                        await apiCall('/tours', 'POST', data);
                        showNotification('Paseo creado exitosamente', 'success');
                    }
                    closeTourModal();
                    await loadTours();
                } catch (error) {
                    console.error('Error saving tour:', error);
                    showNotification('Error al guardar el paseo', 'error');
                }
            }

            function manageTour(tourId) {
                // Register a click for the tour and redirect
                trackTourClick(tourId);
            }

            async function bookTour(tourId) {
                // Redirect to trackTourClick which handles the booking flow
                trackTourClick(tourId);
            }

            async function editTour(tourId) {
                try {
                    const toursData = await apiCall('/tours');
                    const tour = toursData.find(t => t.id === tourId);
                    if (tour) {
                        document.getElementById('tour-modal').style.display = 'flex';
                        document.getElementById('tour-modal-title').textContent = '✏️ Editar Paseo';
                        document.getElementById('tour-id').value = tour.id;
                        document.getElementById('tour-name').value = tour.name || '';
                        document.getElementById('tour-description').value = tour.description || '';
                        document.getElementById('tour-price').value = tour.price || 0;
                        document.getElementById('tour-commission').value = tour.commission_rate || 15;
                        document.getElementById('tour-provider').value = tour.provider || '';
                        document.getElementById('tour-duration').value = tour.duration || '';
                    }
                } catch (error) {
                    console.error('Error loading tour:', error);
                    showNotification('Error al cargar el paseo', 'error');
                }
            }

            // Load data when switching views
            const originalShowView = showView;
            showView = function (viewName) {
                originalShowView.call(this, viewName);

                // Load specific data based on view
                switch (viewName) {
                    case 'beds':
                        refreshBeds();
                        break;
                    case 'guests':
                        refreshGuests();
                        break;
                    case 'pos':
                        loadProducts();
                        break;
                    case 'reports':
                        refreshReports();
                        break;
                    case 'tours':
                        loadTours();
                        break;
                    case 'cash':
                        loadCashData();
                        break;
                }
            };

            // Auto-refresh data every 30 seconds
            setInterval(() => {
                if (sessionId && !document.getElementById('dashboard-view').classList.contains('hidden')) {
                    loadDashboardData();
                }
            }, 30000);

            // Register Service Worker for PWA functionality
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.log('✅ Service Worker registered successfully:', registration.scope);
                        })
                        .catch(error => {
                            console.error('❌ Service Worker registration failed:', error);
                        });
                });
            }

            // Expose modal functions to global scope for onclick handlers
            window.deleteBedFromModal = deleteBedFromModal;
            window.closeBedModal = closeBedModal;
            window.showEditBedModal = showEditBedModal;
            window.showAddBedModal = showAddBedModal;
            window.refreshBeds = refreshBeds;
            // Guest selector functions
            window.showGuestSelectorModal = showGuestSelectorModal;
            window.closeGuestSelectorModal = closeGuestSelectorModal;
            window.startCheckinFromGuestsView = startCheckinFromGuestsView;
            window.registerNewGuestAndReturn = registerNewGuestAndReturn;
            window.cancelPreselectedGuest = cancelPreselectedGuest;

            // ============================================
            // FRONT DESK PANEL - ACCIONES RÁPIDAS 2AM
            // ============================================

            let frontDeskData = null;

            // Cargar estado del front desk
            async function refreshFrontDeskStatus() {
                try {
                    const response = await fetch('/api/front-desk/status', {
                        headers: { 'session-id': sessionId }
                    });
                    if (!response.ok) throw new Error('Error loading front desk status');

                    frontDeskData = await response.json();

                    // Actualizar contador de disponibles
                    document.getElementById('fd-available-count').textContent = frontDeskData.quick_stats.available_now;
                    document.getElementById('fd-min-price').textContent =
                        frontDeskData.quick_stats.min_price > 0
                            ? `Desde $${frontDeskData.quick_stats.min_price.toLocaleString()}/noche`
                            : 'Sin camas disponibles';

                    // Actualizar llegadas pendientes
                    const arrivalsList = document.getElementById('fd-arrivals-list');
                    const arrivalsCount = document.getElementById('fd-arrivals-count');
                    arrivalsCount.textContent = frontDeskData.pending_arrivals_count;

                    if (frontDeskData.pending_arrivals.length > 0) {
                        arrivalsList.innerHTML = frontDeskData.pending_arrivals.map(arrival => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; border-radius: 8px; margin-bottom: 5px;">
                                <div>
                                    <div style="font-weight: 600;">${arrival.guest_name}</div>
                                    <div style="font-size: 12px; color: #7f8c8d;">${arrival.bed_name} • ${arrival.nights} noche(s)</div>
                                </div>
                                <button onclick="confirmArrival(${arrival.booking_id})"
                                        style="background: #27ae60; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                                    <i class="fas fa-check"></i> Check-in
                                </button>
                            </div>
                        `).join('');
                    } else {
                        arrivalsList.innerHTML = '<p style="color: #7f8c8d; font-size: 14px;">No hay llegadas pendientes</p>';
                    }

                    // Actualizar alertas
                    const alertsList = document.getElementById('fd-alerts-list');
                    const alertsCount = document.getElementById('fd-alerts-count');
                    alertsCount.textContent = frontDeskData.alerts.length;

                    if (frontDeskData.alerts.length > 0) {
                        alertsList.innerHTML = frontDeskData.alerts.map(alert => `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 8px; background: ${alert.type === 'urgent' ? '#ffe6e6' : '#fff'}; border-radius: 8px; margin-bottom: 5px; border-left: 3px solid ${alert.type === 'urgent' ? '#e74c3c' : '#f39c12'};">
                                <span>${alert.icon}</span>
                                <span style="font-size: 13px;">${alert.message}</span>
                            </div>
                        `).join('');
                    } else {
                        alertsList.innerHTML = '<p style="color: #27ae60; font-size: 14px;"><i class="fas fa-check-circle"></i> Todo en orden</p>';
                    }

                    console.log('✅ Front desk status loaded');

                } catch (error) {
                    console.error('Error loading front desk status:', error);
                }
            }

            // MODAL: CHECK-IN RÁPIDO
            let currentGuestLookup = null; // Para guardar datos del huésped encontrado
            let lookupTimeout = null;

            function openQuickCheckinModal() {
                document.getElementById('quick-checkin-modal').classList.add('active');
                document.getElementById('quick-checkin-form').reset();
                document.getElementById('qc-guest-nationality').value = 'Colombia';
                document.getElementById('qc-guest-status').style.display = 'none';
                currentGuestLookup = null;
                document.body.style.overflow = 'hidden';
                loadAvailableBedsForCheckin();
                updateQuickCheckinTotal();
                // Focus en documento primero
                setTimeout(() => document.getElementById('qc-guest-document').focus(), 100);
            }

            function closeQuickCheckinModal() {
                document.getElementById('quick-checkin-modal').classList.remove('active');
                document.body.style.overflow = '';
                currentGuestLookup = null;
            }

            // DEV2-11: Quick Reservation Modal - Navegar a reservaciones
            function openQuickReservationModal() {
                window.location.href = '/reservations.html?action=new';
            }

            // Búsqueda automática de huésped por documento
            async function lookupGuestByDocument(document) {
                if (!document || document.length < 3) {
                    hideGuestStatus();
                    return;
                }

                try {
                    const response = await fetch(`/api/front-desk/guest-lookup?document=${encodeURIComponent(document)}`, {
                        headers: { 'session-id': sessionId }
                    });
                    const result = await response.json();

                    if (result.success && result.found) {
                        currentGuestLookup = result.guest;
                        showGuestFound(result.guest);
                    } else {
                        currentGuestLookup = null;
                        showNewGuest();
                    }
                } catch (error) {
                    console.error('Guest lookup error:', error);
                    hideGuestStatus();
                }
            }

            function showGuestFound(guest) {
                const statusDiv = document.getElementById('qc-guest-status');
                const icon = document.getElementById('qc-status-icon');
                const text = document.getElementById('qc-status-text');
                const history = document.getElementById('qc-guest-history');

                // Check if blacklisted
                if (guest.is_blacklisted) {
                    statusDiv.style.display = 'block';
                    statusDiv.style.background = '#ffe6e6';
                    statusDiv.style.border = '2px solid #e74c3c';
                    icon.className = 'fas fa-ban';
                    icon.style.color = '#e74c3c';
                    text.innerHTML = `<strong style="color: #e74c3c;">⚠️ HUÉSPED EN LISTA NEGRA</strong>`;
                    history.innerHTML = `Razón: ${guest.blacklist_reason || 'No especificada'}`;
                    return;
                }

                statusDiv.style.display = 'block';

                if (guest.is_frequent) {
                    statusDiv.style.background = '#fff3cd';
                    statusDiv.style.border = '2px solid #f39c12';
                    icon.className = 'fas fa-star';
                    icon.style.color = '#f39c12';
                    text.innerHTML = `<strong style="color: #f39c12;">⭐ HUÉSPED FRECUENTE</strong> - ${guest.name}`;
                } else {
                    statusDiv.style.background = '#d4edda';
                    statusDiv.style.border = '2px solid #27ae60';
                    icon.className = 'fas fa-user-check';
                    icon.style.color = '#27ae60';
                    text.innerHTML = `<strong style="color: #27ae60;">✓ HUÉSPED CONOCIDO</strong> - ${guest.name}`;
                }

                history.innerHTML = `${guest.total_stays} estadía(s) anterior(es)` +
                    (guest.total_spent > 0 ? ` • Total gastado: $${guest.total_spent.toLocaleString()}` : '');

                // Autocompletar campos
                document.getElementById('qc-guest-name').value = guest.name || '';
                document.getElementById('qc-guest-phone').value = guest.phone || '';
                document.getElementById('qc-guest-nationality').value = guest.nationality || 'Colombia';
            }

            function showNewGuest() {
                const statusDiv = document.getElementById('qc-guest-status');
                const icon = document.getElementById('qc-status-icon');
                const text = document.getElementById('qc-status-text');
                const history = document.getElementById('qc-guest-history');

                statusDiv.style.display = 'block';
                statusDiv.style.background = '#e3f2fd';
                statusDiv.style.border = '2px solid #3498db';
                icon.className = 'fas fa-user-plus';
                icon.style.color = '#3498db';
                text.innerHTML = `<strong style="color: #3498db;">+ HUÉSPED NUEVO</strong>`;
                history.innerHTML = 'Se creará un nuevo registro';
            }

            function hideGuestStatus() {
                document.getElementById('qc-guest-status').style.display = 'none';
                currentGuestLookup = null;
            }

            // Event listener para búsqueda al escribir documento
            document.getElementById('qc-guest-document')?.addEventListener('input', (e) => {
                clearTimeout(lookupTimeout);
                const doc = e.target.value.trim();

                // Debounce: esperar 500ms después de dejar de escribir
                lookupTimeout = setTimeout(() => {
                    lookupGuestByDocument(doc);
                }, 500);
            });

            // También buscar cuando sale del campo
            document.getElementById('qc-guest-document')?.addEventListener('blur', (e) => {
                clearTimeout(lookupTimeout);
                const doc = e.target.value.trim();
                if (doc.length >= 3) {
                    lookupGuestByDocument(doc);
                }
            });

            async function loadAvailableBedsForCheckin() {
                const select = document.getElementById('qc-bed-select');
                select.innerHTML = '<option value="">Cargando...</option>';

                try {
                    if (frontDeskData && frontDeskData.available_beds) {
                        select.innerHTML = '<option value="">Seleccionar cama...</option>' +
                            frontDeskData.available_beds.map(bed =>
                                `<option value="${bed.id}" data-price="${bed.price}">${bed.name} (${bed.room}) - $${bed.price.toLocaleString()}/noche</option>`
                            ).join('');
                    } else {
                        await refreshFrontDeskStatus();
                        loadAvailableBedsForCheckin();
                    }
                } catch (error) {
                    select.innerHTML = '<option value="">Error cargando camas</option>';
                }
            }

            function updateQuickCheckinTotal() {
                const select = document.getElementById('qc-bed-select');
                const nights = parseInt(document.getElementById('qc-nights').value) || 1;
                const selectedOption = select.options[select.selectedIndex];
                const price = selectedOption ? parseFloat(selectedOption.dataset.price) || 0 : 0;

                const total = price * nights;
                document.getElementById('qc-total').textContent = `$${total.toLocaleString()}`;

                // Actualizar fecha de checkout usando fecha local (evita problemas de timezone)
                const checkout = new Date();
                checkout.setDate(checkout.getDate() + nights);
                document.getElementById('qc-checkout-date').value = formatDateToInput(checkout);
            }

            // Helper para formatear fecha a formato input (YYYY-MM-DD) sin problemas de timezone
            function formatDateToInput(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // Event listener para cambio de cama
            document.getElementById('qc-bed-select')?.addEventListener('change', updateQuickCheckinTotal);

            // Submit check-in rápido
            document.getElementById('quick-checkin-form')?.addEventListener('submit', async (e) => {
                e.preventDefault();

                // Validación: huésped en blacklist
                if (currentGuestLookup && currentGuestLookup.is_blacklisted) {
                    if (!confirm('⚠️ ATENCIÓN: Este huésped está en la LISTA NEGRA.\n\n¿Desea continuar de todas formas?')) {
                        return;
                    }
                }

                const btn = document.getElementById('qc-submit-btn');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';

                try {
                    const select = document.getElementById('qc-bed-select');

                    // Validar que se seleccionó una cama
                    if (!select.value) {
                        alert('❌ Por favor selecciona una cama');
                        return;
                    }

                    const nights = parseInt(document.getElementById('qc-nights').value) || 1;
                    const price = parseFloat(select.options[select.selectedIndex].dataset.price) || 0;
                    const paymentMethod = document.querySelector('input[name="qc-payment"]:checked').value;

                    const data = {
                        guest_name: document.getElementById('qc-guest-name').value.trim(),
                        guest_document: document.getElementById('qc-guest-document').value.trim(),
                        guest_phone: document.getElementById('qc-guest-phone').value.trim() || null,
                        guest_nationality: document.getElementById('qc-guest-nationality').value.trim(),
                        bed_id: parseInt(select.value),
                        nights: nights,
                        payment_method: paymentMethod,
                        payment_amount: paymentMethod !== 'pending' ? (price * nights) : 0
                    };

                    // Validaciones básicas
                    if (!data.guest_name || !data.guest_document) {
                        alert('❌ Nombre y documento son requeridos');
                        return;
                    }

                    const response = await fetch('/api/quick-checkin', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify(data)
                    });

                    const result = await response.json();

                    if (result.success) {
                        // Calcular fecha checkout para mostrar
                        const checkoutDate = new Date(result.booking.check_out);
                        const checkoutStr = checkoutDate.toLocaleDateString('es-CO', {
                            weekday: 'short', day: 'numeric', month: 'short'
                        });

                        const isNewGuest = result.guest.is_new ? '(NUEVO)' : '(conocido)';
                        const paymentInfo = result.payment
                            ? `Pagado: $${result.payment.amount.toLocaleString()} (${result.payment.method})`
                            : 'Pago: PENDIENTE';

                        const balanceInfo = result.booking.balance_due > 0
                            ? `\n⚠️ Saldo pendiente: $${result.booking.balance_due.toLocaleString()}`
                            : '\n✓ Pagado completo';

                        alert(`✅ CHECK-IN EXITOSO\n` +
                            `━━━━━━━━━━━━━━━━━━━━━\n` +
                            `👤 ${result.guest.name} ${isNewGuest}\n` +
                            `🛏️ ${result.bed.name} (${result.bed.room || 'Hab.'})\n` +
                            `📅 Checkout: ${checkoutStr}\n` +
                            `🌙 ${result.booking.nights} noche(s)\n` +
                            `━━━━━━━━━━━━━━━━━━━━━\n` +
                            `💰 Total: $${result.booking.total.toLocaleString()}\n` +
                            `${paymentInfo}${balanceInfo}\n` +
                            `━━━━━━━━━━━━━━━━━━━━━\n` +
                            `🔖 Código: ${result.booking.confirmation_code}`);

                        closeQuickCheckinModal();
                        refreshFrontDeskStatus();
                        loadDashboardData();
                    } else {
                        alert('❌ Error: ' + result.error);
                    }
                } catch (error) {
                    alert('❌ Error: ' + error.message);
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-check-circle"></i> CONFIRMAR CHECK-IN';
                }
            });

            // MODAL: COBRAR PAGO
            function openQuickPaymentModal() {
                document.getElementById('quick-payment-modal').classList.add('active');
                document.getElementById('quick-payment-form').reset();
                document.getElementById('qp-guest-info').style.display = 'none';
                document.body.style.overflow = 'hidden';
                loadOccupiedBedsForPayment();
            }

            function closeQuickPaymentModal() {
                document.getElementById('quick-payment-modal').classList.remove('active');
                document.body.style.overflow = '';
            }

            async function loadOccupiedBedsForPayment() {
                const select = document.getElementById('qp-bed-select');
                select.innerHTML = '<option value="">Cargando...</option>';

                try {
                    if (frontDeskData && frontDeskData.current_guests) {
                        select.innerHTML = '<option value="">Seleccionar cama...</option>' +
                            frontDeskData.current_guests.map(g =>
                                `<option value="${g.booking_id}" data-guest="${g.guest_name}" data-balance="${g.balance_due}">${g.bed_name} - ${g.guest_name}</option>`
                            ).join('');
                    }
                } catch (error) {
                    select.innerHTML = '<option value="">Error</option>';
                }
            }

            function loadGuestAccountForPayment() {
                const select = document.getElementById('qp-bed-select');
                const option = select.options[select.selectedIndex];

                if (option && option.value) {
                    document.getElementById('qp-guest-info').style.display = 'block';
                    document.getElementById('qp-guest-name').textContent = option.dataset.guest;
                    document.getElementById('qp-guest-balance').textContent = `Saldo pendiente: $${parseFloat(option.dataset.balance).toLocaleString()}`;
                    document.getElementById('qp-amount').value = option.dataset.balance;
                } else {
                    document.getElementById('qp-guest-info').style.display = 'none';
                }
            }

            document.getElementById('quick-payment-form')?.addEventListener('submit', async (e) => {
                e.preventDefault();

                const bookingId = document.getElementById('qp-bed-select').value;
                const amount = parseFloat(document.getElementById('qp-amount').value);
                const method = document.querySelector('input[name="qp-method"]:checked').value;

                if (!bookingId || !amount) {
                    alert('Selecciona una cama y monto');
                    return;
                }

                try {
                    const response = await fetch('/api/quick-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify({ booking_id: bookingId, amount, method })
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(`✅ Pago registrado!\n\nMonto: $${amount.toLocaleString()}\nSaldo restante: $${result.booking.balance_due.toLocaleString()}`);
                        closeQuickPaymentModal();
                        refreshFrontDeskStatus();
                    } else {
                        alert('❌ Error: ' + result.error);
                    }
                } catch (error) {
                    alert('❌ Error: ' + error.message);
                }
            });

            // MODAL: CHECK-OUT RÁPIDO
            function openQuickCheckoutModal() {
                document.getElementById('quick-checkout-modal').classList.add('active');
                document.getElementById('quick-checkout-form').reset();
                document.getElementById('qco-guest-info').style.display = 'none';
                document.getElementById('qco-payment-section').style.display = 'none';
                document.body.style.overflow = 'hidden';
                loadOccupiedBedsForCheckout();
            }

            function closeQuickCheckoutModal() {
                document.getElementById('quick-checkout-modal').classList.remove('active');
                document.body.style.overflow = '';
            }

            async function loadOccupiedBedsForCheckout() {
                const select = document.getElementById('qco-bed-select');
                select.innerHTML = '<option value="">Cargando...</option>';

                try {
                    if (frontDeskData && frontDeskData.current_guests) {
                        select.innerHTML = '<option value="">Seleccionar cama...</option>' +
                            frontDeskData.current_guests.map(g =>
                                `<option value="${g.bed_id}" data-booking="${g.booking_id}" data-guest="${g.guest_name}" data-total="${g.total}" data-paid="${g.total_paid}" data-balance="${g.balance_due}">${g.bed_name} - ${g.guest_name}</option>`
                            ).join('');
                    }
                } catch (error) {
                    select.innerHTML = '<option value="">Error</option>';
                }
            }

            function loadGuestForCheckout() {
                const select = document.getElementById('qco-bed-select');
                const option = select.options[select.selectedIndex];

                if (option && option.value) {
                    const balance = parseFloat(option.dataset.balance);
                    document.getElementById('qco-guest-info').style.display = 'block';
                    document.getElementById('qco-guest-name').textContent = option.dataset.guest;
                    document.getElementById('qco-total').textContent = `$${parseFloat(option.dataset.total).toLocaleString()}`;
                    document.getElementById('qco-paid').textContent = `$${parseFloat(option.dataset.paid).toLocaleString()}`;
                    document.getElementById('qco-balance').textContent = `$${balance.toLocaleString()}`;
                    document.getElementById('qco-balance').style.color = balance > 0 ? '#e74c3c' : '#27ae60';

                    if (balance > 0) {
                        document.getElementById('qco-payment-section').style.display = 'block';
                        document.getElementById('qco-payment-amount').value = balance;
                    } else {
                        document.getElementById('qco-payment-section').style.display = 'none';
                    }
                } else {
                    document.getElementById('qco-guest-info').style.display = 'none';
                    document.getElementById('qco-payment-section').style.display = 'none';
                }
            }

            document.getElementById('quick-checkout-form')?.addEventListener('submit', async (e) => {
                e.preventDefault();

                const select = document.getElementById('qco-bed-select');
                const option = select.options[select.selectedIndex];
                const bedId = select.value;
                const bookingId = option.dataset.booking;
                const paymentAmount = parseFloat(document.getElementById('qco-payment-amount').value) || 0;
                const paymentMethod = document.querySelector('input[name="qco-method"]:checked')?.value || 'cash';
                const markClean = document.getElementById('qco-mark-clean').checked;

                if (!bedId) {
                    alert('Selecciona una cama');
                    return;
                }

                try {
                    const response = await fetch('/api/quick-checkout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify({
                            bed_id: bedId,
                            booking_id: bookingId,
                            payment_amount: paymentAmount,
                            payment_method: paymentMethod,
                            mark_clean: markClean
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        let msg = `✅ Check-out exitoso!\n\n${result.booking.guest_name}`;
                        if (result.payment_warning) msg += `\n\n⚠️ ${result.payment_warning}`;
                        alert(msg);
                        closeQuickCheckoutModal();
                        refreshFrontDeskStatus();
                        loadDashboardData();
                    } else {
                        alert('❌ Error: ' + result.error);
                    }
                } catch (error) {
                    alert('❌ Error: ' + error.message);
                }
            });

            // Confirmar llegada de reserva existente
            async function confirmArrival(bookingId) {
                if (!confirm('¿Confirmar check-in de esta reserva?')) return;

                try {
                    const response = await fetch('/api/front-desk/confirm-arrival', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'session-id': sessionId
                        },
                        body: JSON.stringify({ booking_id: bookingId })
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(`✅ Check-in confirmado!\n\n${result.booking.guest_name} → ${result.booking.bed_name}`);
                        refreshFrontDeskStatus();
                        loadDashboardData();
                    } else {
                        alert('❌ Error: ' + result.error);
                    }
                } catch (error) {
                    alert('❌ Error: ' + error.message);
                }
            }

            // Búsqueda rápida
            document.getElementById('fd-search')?.addEventListener('keypress', async (e) => {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim();
                    if (query.length < 2) return;

                    try {
                        const response = await fetch(`/api/front-desk/search?q=${encodeURIComponent(query)}`, {
                            headers: { 'session-id': sessionId }
                        });
                        const result = await response.json();

                        if (result.success && result.results.length > 0) {
                            const first = result.results[0];
                            alert(`Encontrado: ${first.type}\n\n${JSON.stringify(first, null, 2)}`);
                        } else {
                            alert('No se encontraron resultados');
                        }
                    } catch (error) {
                        console.error('Search error:', error);
                    }
                }
            });

            // Cerrar modales al hacer click fuera
            document.querySelectorAll('.fd-modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });

            // ============================================
            // KEYBOARD SHORTCUTS - DEV2-11
            // ============================================
            document.addEventListener('keydown', (e) => {
                // Escape - Cerrar modales
                if (e.key === 'Escape') {
                    document.querySelectorAll('.fd-modal-overlay.active').forEach(modal => {
                        modal.classList.remove('active');
                        document.body.style.overflow = '';
                    });
                }

                // Solo activar shortcuts si no estamos en un input/textarea
                const activeElement = document.activeElement;
                const isInput = activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA' || activeElement.isContentEditable;

                if (isInput && e.key !== 'Escape') return;

                // Ctrl+1: Check-in rápido
                if (e.ctrlKey && e.key === '1') {
                    e.preventDefault();
                    openQuickCheckinModal();
                }
                // Ctrl+2: Cobrar pago
                if (e.ctrlKey && e.key === '2') {
                    e.preventDefault();
                    openQuickPaymentModal();
                }
                // Ctrl+3: Check-out
                if (e.ctrlKey && e.key === '3') {
                    e.preventDefault();
                    openQuickCheckoutModal();
                }
                // Ctrl+4: Nueva reserva
                if (e.ctrlKey && e.key === '4') {
                    e.preventDefault();
                    openQuickReservationModal();
                }
                // Ctrl+5: Venta POS
                if (e.ctrlKey && e.key === '5') {
                    e.preventDefault();
                    showView('pos');
                }
                // F5: Actualizar (custom, prevent browser refresh)
                if (e.key === 'F5' && !e.ctrlKey) {
                    e.preventDefault();
                    refreshFrontDeskStatus();
                    loadDashboardData();
                }
            });

            // Cargar front desk al inicio
            if (sessionId) {
                refreshFrontDeskStatus();
            }

            // Exponer funciones al scope global
            window.openQuickCheckinModal = openQuickCheckinModal;
            window.closeQuickCheckinModal = closeQuickCheckinModal;
            window.openQuickPaymentModal = openQuickPaymentModal;
            window.closeQuickPaymentModal = closeQuickPaymentModal;
            window.openQuickCheckoutModal = openQuickCheckoutModal;
            window.closeQuickCheckoutModal = closeQuickCheckoutModal;
            window.refreshFrontDeskStatus = refreshFrontDeskStatus;
            window.confirmArrival = confirmArrival;
            window.updateQuickCheckinTotal = updateQuickCheckinTotal;
            window.loadGuestAccountForPayment = loadGuestAccountForPayment;
            window.loadGuestForCheckout = loadGuestForCheckout;
        </script>
</body>

</html>